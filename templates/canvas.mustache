{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @package moodle-mod_gcanvas
    @copyright 9-10-2018 MoodleFreak.nl
    @author    Luuk Verhoeven
}}
<div class="d-flex flex-row">
    <div class="p-2" id="toolbar">
        <div class="circle" title="{{# str}} btn:circle, mod_gcanvas {{/ str}}">
            <i class="fa fa-circle"></i>
        </div>
    </div>
    <div class="p-0">
        <canvas id="sketch" height="500" style="border:1px solid #aaa"></canvas>
    </div>
</div>
<script>
        {{#js}}
        require(['jquery'], function ($) {
            jQuery(document).ready(function ($) {

                var canvas = this.__canvas = new fabric.Canvas('sketch');
                canvas.setHeight(500);
                canvas.setWidth(800);

                canvas.on('mouse:over', function(e) {
                    e.target.set('fill', 'red');
                    canvas.renderAll();
                });

                canvas.on('mouse:out', function(e) {
                    e.target.set('fill', 'green');
                    canvas.renderAll();
                });

                fabric.Object.prototype.transparentCorners = false;

                var rect1 = new fabric.Rect();

                var rect2 = new fabric.Rect({
                    width : 100,
                    height: 100,
                    left  : 350,
                    top   : 250,
                    angle : -10,
                    fill  : 'rgba(0,200,0,0.5)'
                });

                var rect3 = new fabric.Rect({
                    width      : 50,
                    height     : 100,
                    left       : 275,
                    top        : 350,
                    angle      : 45,
                    stroke     : '#eee',
                    strokeWidth: 10,
                    fill       : 'rgba(0,0,200,0.5)'
                });

                var circle = new fabric.Circle({
                    radius: 50,
                    left  : 275,
                    top   : 75,
                    fill  : '#aac'
                });

                var triangle = new fabric.Triangle({
                    width : 100,
                    height: 100,
                    left  : 50,
                    top   : 300,
                    fill  : '#cca'
                });

                canvas.add(rect1, rect2, rect3, circle, triangle);
                canvas.on({
                    'object:moving'  : onChange,
                    'object:scaling' : onChange,
                    'object:rotating': onChange,
                });

                function onChange(options) {
                    options.target.setCoords();
                    canvas.forEachObject(function (obj) {
                        if (obj === options.target) {
                            return;
                        }
                        obj.set('opacity', options.target.intersectsWithObject(obj) ? 0.5 : 1);
                    });
                }

                $('#toolbar .circle').click(function () {
                    var circle = new fabric.Circle({
                        radius: 50,
                        left  : 275,
                        top   : 50,
                        fill  : '#aac'
                    });

                    console.log('Add circle');
                    canvas.discardActiveObject();
                    canvas.add(circle);
                    canvas.setActiveObject(circle);
                    canvas.requestRenderAll();
                });
            });
        });
        {{/js}}
</script>