function resizeCanvasIfNeeded(a){var b=a.targetCanvas,c=b.width,d=b.height,e=a.destinationWidth,f=a.destinationHeight;(c!==e||d!==f)&&(b.width=e,b.height=f)}function copyGLTo2DDrawImage(a,b){var c=a.canvas,d=b.targetCanvas,e=d.getContext("2d");e.translate(0,d.height),e.scale(1,-1);var f=c.height-d.height;e.drawImage(c,0,f,d.width,d.height,0,0,d.width,d.height)}function copyGLTo2DPutImageData(a,b){var c=b.targetCanvas,d=c.getContext("2d"),e=b.destinationWidth,f=b.destinationHeight,g=e*f*4,h=new Uint8Array(this.imageBuffer,0,g),i=new Uint8ClampedArray(this.imageBuffer,0,g);a.readPixels(0,0,e,f,a.RGBA,a.UNSIGNED_BYTE,h);var j=new ImageData(i,e,f);d.putImageData(j,0,0)}var fabric=fabric||{version:"2.4.2"};"undefined"!=typeof exports?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=fabric.document.defaultView,DOMParser=require("xmldom").DOMParser),fabric.isTouchSupported="ontouchstart"in fabric.window,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","instantiated_by_use","clip-path"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.arcToSegmentsCache={},fabric.boundsOfCurveCache={},fabric.cachesBoundsOfCurve=!0,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),!function(){function a(a,b){if(this.__eventListeners[a]){var c=this.__eventListeners[a];b?c[c.indexOf(b)]=!1:fabric.util.array.fill(c,!1)}}function b(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(b,c){if(this.__eventListeners){if(0===arguments.length)for(b in this.__eventListeners)a.call(this,b);else if(1===arguments.length&&"object"==typeof arguments[0])for(var d in b)a.call(this,d,b[d]);else a.call(this,b,c);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;e>d;d++)c[d]&&c[d].call(this,b||{});return this.__eventListeners[a]=c.filter(function(a){return a!==!1}),this}}}fabric.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,b=arguments.length;b>a;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,b,c){var d=this._objects;return c?d[b]=a:d.splice(b,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a,b=this._objects,c=!1,d=0,e=arguments.length;e>d;d++)a=b.indexOf(arguments[d]),-1!==a&&(c=!0,b.splice(a,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&c&&this.requestRenderAll(),this},forEachObject:function(a,b){for(var c=this.getObjects(),d=0,e=c.length;e>d;d++)a.call(b,c[d],d,c);return this},getObjects:function(a){return"undefined"==typeof a?this._objects.concat():this._objects.filter(function(b){return b.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(a){return this._objects.indexOf(a)>-1},complexity:function(){return this._objects.reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},fabric.CommonMethods={_setOptions:function(a){for(var b in a)this.set(b,a[b])},_initGradient:function(a,b){!a||!a.colorStops||a instanceof fabric.Gradient||this.set(b,new fabric.Gradient(a))},_initPattern:function(a,b,c){!a||!a.source||a instanceof fabric.Pattern?c&&c():this.set(b,new fabric.Pattern(a,c))},_initClipping:function(a){if(a.clipTo&&"string"==typeof a.clipTo){var b=fabric.util.getFunctionBody(a.clipTo);"undefined"!=typeof b&&(this.clipTo=new Function("ctx",b))}},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,b){this[a]=b},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},get:function(a){return this[a]}},!function(a){var b=Math.sqrt,c=Math.atan2,d=Math.pow,e=Math.abs,f=Math.PI/180,g=Math.PI/2;fabric.util={cos:function(a){if(0===a)return 1;0>a&&(a=-a);var b=a/g;switch(b){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(0===a)return 0;var b=a/g,c=1;switch(0>a&&(c=-1),b){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(a)},removeFromArray:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(a,b,c){a.subtractEquals(b);var d=fabric.util.rotateVector(a,c);return new fabric.Point(d.x,d.y).addEquals(b)},rotateVector:function(a,b){var c=fabric.util.sin(b),d=fabric.util.cos(b),e=a.x*d-a.y*c,f=a.x*c+a.y*d;return{x:e,y:f}},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},makeBoundingBoxFromPoints:function(a){var b=[a[0].x,a[1].x,a[2].x,a[3].x],c=fabric.util.array.min(b),d=fabric.util.array.max(b),e=d-c,f=[a[0].y,a[1].y,a[2].y,a[3].y],g=fabric.util.array.min(f),h=fabric.util.array.max(f),i=h-g;return{left:c,top:g,width:e,height:i}},invertTransform:function(a){var b=1/(a[0]*a[3]-a[1]*a[2]),c=[b*a[3],-b*a[1],-b*a[2],b*a[0]],d=fabric.util.transformPoint({x:a[4],y:a[5]},c,!0);return c[4]=-d.x,c[5]=-d.y,c},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);switch(b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return d*fabric.DPI/25.4;case"cm":return d*fabric.DPI/2.54;case"in":return d*fabric.DPI;case"pt":return d*fabric.DPI/72;case"pc":return d*fabric.DPI/72*12;case"em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){return a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),fabric.util.resolveNamespace(b)[a]},getSvgAttributes:function(a){var b=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":b=b.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":b=b.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":b=b.concat(["offset","stop-color","stop-opacity"])}return b},resolveNamespace:function(b){if(!b)return fabric;var c,d=b.split("."),e=d.length,f=a||fabric.window;for(c=0;e>c;++c)f=f[d[c]];return f},loadImage:function(a,b,c,d){if(!a)return void(b&&b.call(c,a));var e=fabric.util.createImage(),f=function(){b&&b.call(c,e),e=e.onload=e.onerror=null};e.onload=f,e.onerror=function(){fabric.log("Error loading "+e.src),b&&b.call(c,null,!0),e=e.onload=e.onerror=null},0!==a.indexOf("data")&&d&&(e.crossOrigin=d),"data:image/svg"===a.substring(0,14)&&(e.onload=null,fabric.util.loadImageInDom(e,f)),e.src=a},loadImageInDom:function(a,b){var c=fabric.document.createElement("div");c.style.width=c.style.height="1px",c.style.left=c.style.top="-100%",c.style.position="absolute",c.appendChild(a),fabric.document.querySelector("body").appendChild(c),a.onload=function(){b(),c.parentNode.removeChild(c),c=null}},enlivenObjects:function(a,b,c,d){function e(){++g===h&&b&&b(f)}a=a||[];var f=[],g=0,h=a.length;return h?void a.forEach(function(a,b){if(!a||!a.type)return void e();var g=fabric.util.getKlass(a.type,c);g.fromObject(a,function(c,g){g||(f[b]=c),d&&d(a,c,g),e()})}):void(b&&b(f))},enlivenPatterns:function(a,b){function c(){++e===f&&b&&b(d)}a=a||[];var d=[],e=0,f=a.length;return f?void a.forEach(function(a,b){a&&a.source?new fabric.Pattern(a,function(a){d[b]=a,c()}):(d[b]=a,c())}):void(b&&b(d))},groupSVGElements:function(a,b,c){var d;return a&&1===a.length?a[0]:(b&&(b.width&&b.height?b.centerPoint={x:b.width/2,y:b.height/2}:(delete b.width,delete b.height)),d=new fabric.Group(a,b),"undefined"!=typeof c&&(d.sourcePath=c),d)},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;e>d;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,d,e,f,g,h){var i=f-d,j=g-e,k=b(i*i+j*j),l=c(j,i),m=h.length,n=0,o=!0;for(a.save(),a.translate(d,e),a.moveTo(0,0),a.rotate(l),d=0;k>d;)d+=h[n++%m],d>k&&(d=k),a[o?"lineTo":"moveTo"](d,0),o=!o;a.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(a){var b=fabric.document.createElement("canvas");return b.width=a.width,b.height=a.height,b.getContext("2d").drawImage(a,0,0),b},createImage:function(){return fabric.document.createElement("img")},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},multiplyTransformMatrices:function(a,b,c){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],c?0:a[0]*b[4]+a[2]*b[5]+a[4],c?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var e=c(a[1],a[0]),g=d(a[0],2)+d(a[1],2),h=b(g),i=(a[0]*a[3]-a[2]*a[1])/h,j=c(a[0]*a[2]+a[1]*a[3],g);return{angle:e/f,scaleX:h,scaleY:i,skewX:j/f,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(a,b,c){var d=[1,0,e(Math.tan(c*f)),1],g=[e(a),0,0,e(b)];return fabric.util.multiplyTransformMatrices(g,d,!0)},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);var e,f,g=!0,h=a.getImageData(b,c,2*d||1,2*d||1),i=h.data.length;for(e=3;i>e&&(f=h.data[e],g=0>=f,g!==!1);e+=4);return h=null,g},parsePreserveAspectRatioAttribute:function(a){var b,c="meet",d="Mid",e="Mid",f=a.split(" ");return f&&f.length&&(c=f.pop(),"meet"!==c&&"slice"!==c?(b=c,c="meet"):f.length&&(b=f.pop())),d="none"!==b?b.slice(1,4):"none",e="none"!==b?b.slice(5,8):"none",{meetOrSlice:c,alignX:d,alignY:e}},clearFabricFontCache:function(a){a=(a||"").toLowerCase(),a?fabric.charWidthsCache[a]&&delete fabric.charWidthsCache[a]:fabric.charWidthsCache={}},limitDimsByArea:function(a,b){var c=Math.sqrt(b*a),d=Math.floor(b/c);return{x:Math.floor(c),y:d}},capValue:function(a,b,c){return Math.max(a,Math.min(b,c))},findScaleToFit:function(a,b){return Math.min(b.width/a.width,b.height/a.height)},findScaleToCover:function(a,b){return Math.max(b.width/a.width,b.height/a.height)}}}("undefined"!=typeof exports?exports:this),!function(){function a(a,d,f,g,h,i,j){var k=e.call(arguments);if(fabric.arcToSegmentsCache[k])return fabric.arcToSegmentsCache[k];var l=Math.PI,m=j*l/180,n=fabric.util.sin(m),o=fabric.util.cos(m),p=0,q=0;f=Math.abs(f),g=Math.abs(g);var r=-o*a*.5-n*d*.5,s=-o*d*.5+n*a*.5,t=f*f,u=g*g,v=s*s,w=r*r,x=t*u-t*v-u*w,y=0;if(0>x){var z=Math.sqrt(1-x/(t*u));f*=z,g*=z}else y=(h===i?-1:1)*Math.sqrt(x/(t*v+u*w));var A=y*f*s/g,B=-y*g*r/f,C=o*A-n*B+.5*a,D=n*A+o*B+.5*d,E=c(1,0,(r-A)/f,(s-B)/g),F=c((r-A)/f,(s-B)/g,(-r-A)/f,(-s-B)/g);0===i&&F>0?F-=2*l:1===i&&0>F&&(F+=2*l);for(var G=Math.ceil(Math.abs(F/l*2)),H=[],I=F/G,J=8/3*Math.sin(I/4)*Math.sin(I/4)/Math.sin(I/2),K=E+I,L=0;G>L;L++)H[L]=b(E,K,o,n,f,g,C,D,J,p,q),p=H[L][4],q=H[L][5],E=K,K+=I;return fabric.arcToSegmentsCache[k]=H,H}function b(a,b,c,d,e,f,g,h,i,j,k){var l=fabric.util.cos(a),m=fabric.util.sin(a),n=fabric.util.cos(b),o=fabric.util.sin(b),p=c*e*n-d*f*o+g,q=d*e*n+c*f*o+h,r=j+i*(-c*e*m-d*f*l),s=k+i*(-d*e*m+c*f*l),t=p+i*(c*e*o+d*f*n),u=q+i*(d*e*o-c*f*n);return[r,s,t,u,p,q]}function c(a,b,c,d){var e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)}function d(a,b,c,d,f,g,h,i){var j;if(fabric.cachesBoundsOfCurve&&(j=e.call(arguments),fabric.boundsOfCurveCache[j]))return fabric.boundsOfCurveCache[j];var k,l,m,n,o,p,q,r,s=Math.sqrt,t=Math.min,u=Math.max,v=Math.abs,w=[],x=[[],[]];l=6*a-12*c+6*f,k=-3*a+9*c-9*f+3*h,m=3*c-3*a;for(var y=0;2>y;++y)if(y>0&&(l=6*b-12*d+6*g,k=-3*b+9*d-9*g+3*i,m=3*d-3*b),v(k)<1e-12){if(v(l)<1e-12)continue;n=-m/l,n>0&&1>n&&w.push(n)}else q=l*l-4*m*k,0>q||(r=s(q),o=(-l+r)/(2*k),o>0&&1>o&&w.push(o),p=(-l-r)/(2*k),p>0&&1>p&&w.push(p));for(var z,A,B,C=w.length,D=C;C--;)n=w[C],B=1-n,z=B*B*B*a+3*B*B*n*c+3*B*n*n*f+n*n*n*h,x[0][C]=z,A=B*B*B*b+3*B*B*n*d+3*B*n*n*g+n*n*n*i,x[1][C]=A;x[0][D]=a,x[1][D]=b,x[0][D+1]=h,x[1][D+1]=i;var E=[{x:t.apply(null,x[0]),y:t.apply(null,x[1])},{x:u.apply(null,x[0]),y:u.apply(null,x[1])}];return fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[j]=E),E}var e=Array.prototype.join;fabric.util.drawArc=function(b,c,d,e){for(var f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=[[],[],[],[]],n=a(k-c,l-d,f,g,i,j,h),o=0,p=n.length;p>o;o++)m[o][0]=n[o][0]+c,m[o][1]=n[o][1]+d,m[o][2]=n[o][2]+c,m[o][3]=n[o][3]+d,m[o][4]=n[o][4]+c,m[o][5]=n[o][5]+d,b.bezierCurveTo.apply(b,m[o])},fabric.util.getBoundsOfArc=function(b,c,e,f,g,h,i,j,k){for(var l,m=0,n=0,o=[],p=a(j-b,k-c,e,f,h,i,g),q=0,r=p.length;r>q;q++)l=d(m,n,p[q][0],p[q][1],p[q][2],p[q][3],p[q][4],p[q][5]),o.push({x:l[0].x+b,y:l[0].y+c}),o.push({x:l[1].x+b,y:l[1].y+c}),m=p[q][4],n=p[q][5];return o},fabric.util.getBoundsOfCurve=d}(),!function(){function a(a,b){for(var c=f.call(arguments,2),d=[],e=0,g=a.length;g>e;e++)d[e]=c.length?a[e][b].apply(a[e],c):a[e][b].call(a[e]);return d}function b(a,b){return e(a,b,function(a,b){return a>=b})}function c(a,b){return e(a,b,function(a,b){return b>a})}function d(a,b){for(var c=a.length;c--;)a[c]=b;return a}function e(a,b,c){if(a&&0!==a.length){var d=a.length-1,e=b?a[d][b]:a[d];if(b)for(;d--;)c(a[d][b],e)&&(e=a[d][b]);else for(;d--;)c(a[d],e)&&(e=a[d]);return e}}var f=Array.prototype.slice;fabric.util.array={fill:d,invoke:a,min:c,max:b}}(),!function(){function a(b,c,d){if(d)if(!fabric.isLikelyNode&&c instanceof Element)b=c;else if(c instanceof Array){b=[];for(var e=0,f=c.length;f>e;e++)b[e]=a({},c[e],d)}else if(c&&"object"==typeof c)for(var g in c)c.hasOwnProperty(g)&&(b[g]=a({},c[g],d));else b=c;else for(var g in c)b[g]=c[g];return b}function b(b,c){return a({},b,c)}fabric.util.object={extend:a,clone:b},fabric.util.object.extend(fabric.util,fabric.Observable)}(),!function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function d(a){var b,c=0,d=[];for(c=0,b;c<a.length;c++)(b=e(a,c))!==!1&&d.push(b);return d}function e(a,b){var c=a.charCodeAt(b);if(isNaN(c))return"";if(55296>c||c>57343)return a.charAt(b);if(c>=55296&&56319>=c){if(a.length<=b+1)throw"High surrogate without following low surrogate";var d=a.charCodeAt(b+1);if(56320>d||d>57343)throw"High surrogate without following low surrogate";return a.charAt(b)+a.charAt(b+1)}if(0===b)throw"Low surrogate without preceding high surrogate";var e=a.charCodeAt(b-1);if(55296>e||e>56319)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:a,capitalize:b,escapeXml:c,graphemeSplit:d}}(),!function(){function a(){}function b(a){for(var b=null,c=this;c.constructor.superclass;){var e=c.constructor.superclass.prototype[a];if(c[a]!==e){b=e;break}c=c.constructor.superclass.prototype}return b?arguments.length>1?b.apply(this,d.call(arguments,1)):b.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function c(){function c(){this.initialize.apply(this,arguments)}var f=null,h=d.call(arguments,0);"function"==typeof h[0]&&(f=h.shift()),c.superclass=f,c.subclasses=[],f&&(a.prototype=f.prototype,c.prototype=new a,f.subclasses.push(c));for(var i=0,j=h.length;j>i;i++)g(c,h[i],f);return c.prototype.initialize||(c.prototype.initialize=e),c.prototype.constructor=c,c.prototype.callSuper=b,c}var d=Array.prototype.slice,e=function(){},f=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var d in b)a.prototype[d]=d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);return this.constructor.superclass=d,"initialize"!==a?e:void 0}}(d):b[d],f&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=c}(),!function(){function a(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c++)if(b=typeof a[d[c]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,b){return{handler:b,wrappedHandler:c(a,b)}}function c(a,b){return function(c){b.call(g(a),c||fabric.window.event)}}function d(a,b){return function(c){if(p[a]&&p[a][b])for(var d=p[a][b],e=0,f=d.length;f>e;e++)d[e].call(this,c||fabric.window.event)}}function e(a){a||(a=fabric.window.event);var b=a.target||(typeof a.srcElement!==i?a.srcElement:null),c=fabric.util.getScrollLeftTop(b);return{x:q(a)+c.left,y:r(a)+c.top}}function f(a,b,c){var d,e="touchend"===a.type?"changedTouches":"touches",f=a[e];return f&&f[0]&&(d=f[0][c]),"undefined"==typeof d&&(d=a[c]),d}var g,h,i="unknown",j=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};g=function(b){return a[b]},h=function(b,c){a[b]=c}}();var k,l,m=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),n=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),o={},p={};m?(k=function(a,b,c,d){a&&a.addEventListener(b,c,!n&&d)},l=function(a,b,c,d){a&&a.removeEventListener(b,c,!n&&d)}):n?(k=function(a,c,d){if(a){var e=j(a);h(e,a),o[e]||(o[e]={}),o[e][c]||(o[e][c]=[]);var f=b(e,d);o[e][c].push(f),a.attachEvent("on"+c,f.wrappedHandler)}},l=function(a,b,c){if(a){var d,e=j(a);if(o[e]&&o[e][b])for(var f=0,g=o[e][b].length;g>f;f++)d=o[e][b][f],d&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),o[e][b][f]=null)}}):(k=function(a,b,c){if(a){var e=j(a);if(p[e]||(p[e]={}),!p[e][b]){p[e][b]=[];var f=a["on"+b];f&&p[e][b].push(f),a["on"+b]=d(e,b)}p[e][b].push(c)}},l=function(a,b,c){if(a){var d=j(a);if(p[d]&&p[d][b])for(var e=p[d][b],f=0,g=e.length;g>f;f++)e[f]===c&&e.splice(f,1)}}),fabric.util.addListener=k,fabric.util.removeListener=l;var q=function(a){return a.clientX},r=function(a){return a.clientY};fabric.isTouchSupported&&(q=function(a){return f(a,"pageX","clientX")},r=function(a){return f(a,"pageY","clientY")}),fabric.util.getPointer=e}(),!function(){function a(a,b){var c=a.style;if(!c)return a;if("string"==typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)f(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"==typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=fabric.document.createElement("div"),c="string"==typeof b.style.opacity,d="string"==typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};c?f=function(a,b){return a.style.opacity=b,a}:d&&(f=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),fabric.util.setStyle=a}(),!function(){function a(a){return"string"==typeof a?fabric.document.getElementById(a):a}function b(a,b){var c=fabric.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function c(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)}function d(a,c,d){return"string"==typeof c&&(c=b(c,d)),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),c}function e(a){for(var b=0,c=0,d=fabric.document.documentElement,e=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(b=e.scrollLeft||d.scrollLeft||0,c=e.scrollTop||d.scrollTop||0):(b+=a.scrollLeft||0,c+=a.scrollTop||0),1!==a.nodeType||"fixed"!==a.style.position););return{left:b,top:c}}function f(a){var b,c,d=a&&a.ownerDocument,f={left:0,top:0},g={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return g;for(var i in h)g[h[i]]+=parseInt(m(a,i),10)||0;return b=d.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(f=a.getBoundingClientRect()),c=e(a),{left:f.left+c.left-(b.clientLeft||0)+g.left,top:f.top+c.top-(b.clientTop||0)+g.top}}function g(a){var b=fabric.jsdomImplForWrapper(a);return b._canvas||b._image}function h(a){if(fabric.isLikelyNode){var b=fabric.jsdomImplForWrapper(a);b&&(b._image=null,b._canvas=null,b._currentSrc=null,b._attributes=null,b._classList=null)}}var i,j=Array.prototype.slice,k=function(a){return j.call(a,0)};try{i=k(fabric.document.childNodes)instanceof Array}catch(l){}i||(k=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var m;m=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){var c=fabric.document.defaultView.getComputedStyle(a,null);return c?c[b]:void 0}:function(a,b){var c=a.style[b];return!c&&a.currentStyle&&(c=a.currentStyle[b]),c},function(){function a(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),d?a.style[d]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a}function b(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=null),d?a.style[d]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}var c=fabric.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=a,fabric.util.makeElementSelectable=b}(),function(){function a(a,b){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=function(a){if(e){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||fabric.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}fabric.util.getScript=a}(),fabric.util.getById=a,fabric.util.toArray=k,fabric.util.makeElement=b,fabric.util.addClass=c,fabric.util.wrapElement=d,fabric.util.getScrollLeftTop=e,fabric.util.getElementOffset=f,fabric.util.getElementStyle=m,fabric.util.getNodeCanvas=g,fabric.util.cleanUpJsdomNode=h}(),!function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function b(){}function c(c,d){d||(d={});var e=d.method?d.method.toUpperCase():"GET",f=d.onComplete||function(){},g=new fabric.window.XMLHttpRequest,h=d.body||d.parameters;return g.onreadystatechange=function(){4===g.readyState&&(f(g),g.onreadystatechange=b)},"GET"===e&&(h=null,"string"==typeof d.parameters&&(c=a(c,d.parameters))),g.open(e,c,!0),("POST"===e||"PUT"===e)&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(h),g}fabric.util.request=c}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(a){"undefined"!=typeof console[a]&&"function"==typeof console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),!function(){function a(){return!1}function b(b){c(function(d){b||(b={});var e,f=d||+new Date,g=b.duration||500,h=f+g,i=b.onChange||a,j=b.abort||a,k=b.onComplete||a,l=b.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},m="startValue"in b?b.startValue:0,n="endValue"in b?b.endValue:100,o=b.byValue||n-m;b.onStart&&b.onStart(),function p(a){if(j())return void k(n,1,1);e=a||+new Date;var d=e>h?g:e-f,q=d/g,r=l(d,m,o,g),s=Math.abs((r-m)/o);return i(r,s,q),e>h?void(b.onComplete&&b.onComplete()):void c(p)}(f)})}function c(){return e.apply(fabric.window,arguments)}function d(){return f.apply(fabric.window,arguments)}var e=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){return fabric.window.setTimeout(a,1e3/60)},f=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=b,fabric.util.requestAnimFrame=c,fabric.util.cancelAnimFrame=d}(),!function(){function a(a,b,c){var d="rgba("+parseInt(a[0]+c*(b[0]-a[0]),10)+","+parseInt(a[1]+c*(b[1]-a[1]),10)+","+parseInt(a[2]+c*(b[2]-a[2]),10);return d+=","+(a&&b?parseFloat(a[3]+c*(b[3]-a[3])):1),d+=")"}function b(b,c,d,e){var f=new fabric.Color(b).getSource(),g=new fabric.Color(c).getSource();e=e||{},fabric.util.animate(fabric.util.object.extend(e,{duration:d||500,startValue:f,endValue:g,byValue:g,easing:function(b,c,d,f){var g=e.colorEasing?e.colorEasing(b,f):1-Math.cos(b/f*(Math.PI/2));return a(c,d,g)}}))}fabric.util.animateColor=b}(),!function(){function a(a,b,c,d){return a<Math.abs(b)?(a=b,d=c/4):d=0===b&&0===a?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:c,s:d}}function b(a,b,c){return a.a*Math.pow(2,10*(b-=1))*Math.sin(2*(b*c-a.s)*Math.PI/a.p)}function c(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function d(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}function e(a,b,c,d){return c*(a/=d)*a*a*a+b}function f(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b}function g(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}function h(a,b,c,d){return c*(a/=d)*a*a*a*a+b}function i(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b}function j(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}function k(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b}function l(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}function m(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function n(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b}function o(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b}function p(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}function q(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b}function r(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}function s(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}function t(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f,1===c)return d+e;h||(h=.3*f);var j=a(i,e,h,g);return-b(j,c,f)+d}function u(b,c,d,e){var f=1.70158,g=0,h=d;if(0===b)return c;if(b/=e,1===b)return c+d;g||(g=.3*e);var i=a(h,d,g,f);return i.a*Math.pow(2,-10*b)*Math.sin(2*(b*e-i.s)*Math.PI/i.p)+i.c+c}function v(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f/2,2===c)return d+e;h||(h=.3*f*1.5);var j=a(i,e,h,g);return 1>c?-.5*b(j,c,f)+d:j.a*Math.pow(2,-10*(c-=1))*Math.sin(2*(c*f-j.s)*Math.PI/j.p)*.5+j.c+d}function w(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b}function x(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b}function y(a,b,c,d,e){return void 0===e&&(e=1.70158),a/=d/2,1>a?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}function z(a,b,c,d){return c-A(d-a,0,c,d)+b}function A(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}function B(a,b,c,d){return d/2>a?.5*z(2*a,0,c,d)+b:.5*A(2*a-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:c,easeInOutCubic:d,easeInQuart:e,easeOutQuart:f,easeInOutQuart:g,easeInQuint:h,easeOutQuint:i,easeInOutQuint:j,easeInSine:k,easeOutSine:l,easeInOutSine:m,easeInExpo:n,easeOutExpo:o,easeInOutExpo:p,easeInCirc:q,easeOutCirc:r,easeInOutCirc:s,easeInElastic:t,easeOutElastic:u,easeInOutElastic:v,easeInBack:w,easeOutBack:x,easeInOutBack:y,easeInBounce:z,easeOutBounce:A,easeInOutBounce:B}}(),!function(a){"use strict";function b(a){return a in A?A[a]:a}function c(a,b,c,d){var e,f="[object Array]"===Object.prototype.toString.call(b);if("fill"!==a&&"stroke"!==a||"none"!==b)if("strokeDashArray"===a)b="none"===b?null:b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)});else if("transformMatrix"===a)b=c&&c.transformMatrix?v(c.transformMatrix,q.parseTransformAttribute(b)):q.parseTransformAttribute(b);else if("visible"===a)b="none"!==b&&"hidden"!==b,c&&c.visible===!1&&(b=!1);else if("opacity"===a)b=parseFloat(b),c&&"undefined"!=typeof c.opacity&&(b*=c.opacity);else if("textAnchor"===a)b="start"===b?"left":"end"===b?"right":"center";else if("charSpacing"===a)e=u(b,d)/d*1e3;else if("paintFirst"===a){var g=b.indexOf("fill"),h=b.indexOf("stroke"),b="fill";g>-1&&h>-1&&g>h?b="stroke":-1===g&&h>-1&&(b="stroke")}else e=f?b.map(u):u(b,d);else b="";return!f&&isNaN(e)?b:e}function d(a){return new RegExp("^("+a.join("|")+")\\b","i")}function e(a){for(var b in B)if("undefined"!=typeof a[B[b]]&&""!==a[b]){if("undefined"==typeof a[b]){if(!q.Object.prototype[b])continue;a[b]=q.Object.prototype[b]}if(0!==a[b].indexOf("url(")){var c=new q.Color(a[b]);a[b]=c.setAlpha(t(c.getAlpha()*a[B[b]],2)).toRgba()}}return a}function f(a,b){var c,d,e,f,g=[];for(e=0,f=b.length;f>e;e++)c=b[e],d=a.getElementsByTagName(c),g=g.concat(Array.prototype.slice.call(d));return g}function g(a,b){var c,d;a.replace(/;\s*$/,"").split(";").forEach(function(a){var e=a.split(":");c=e[0].trim().toLowerCase(),d=e[1].trim(),b[c]=d})}function h(a,b){var c,d;for(var e in a)"undefined"!=typeof a[e]&&(c=e.toLowerCase(),d=a[e],b[c]=d)}function i(a,b){var c={};for(var d in q.cssRules[b])if(j(a,d.split(" ")))for(var e in q.cssRules[b][d])c[e]=q.cssRules[b][d][e];return c}function j(a,b){var c,d=!0;return c=l(a,b.pop()),c&&b.length&&(d=k(a,b)),c&&d&&0===b.length}function k(a,b){for(var c,d=!0;a.parentNode&&1===a.parentNode.nodeType&&b.length;)d&&(c=b.pop()),a=a.parentNode,d=l(a,c);return 0===b.length;
}function l(a,b){var c,d,e=a.nodeName,f=a.getAttribute("class"),g=a.getAttribute("id");if(c=new RegExp("^"+e,"i"),b=b.replace(c,""),g&&b.length&&(c=new RegExp("#"+g+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")),f&&b.length)for(f=f.split(" "),d=f.length;d--;)c=new RegExp("\\."+f[d]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"");return 0===b.length}function m(a,b){var c;if(a.getElementById&&(c=a.getElementById(b)),c)return c;var d,e,f,g=a.getElementsByTagName("*");for(e=0,f=g.length;f>e;e++)if(d=g[e],b===d.getAttribute("id"))return d}function n(a){for(var b=f(a,["use","svg:use"]),c=0;b.length&&c<b.length;){var d,e,g,h,i,j=b[c],k=(j.getAttribute("xlink:href")||j.getAttribute("href")).substr(1),l=j.getAttribute("x")||0,n=j.getAttribute("y")||0,p=m(a,k).cloneNode(!0),q=(p.getAttribute("transform")||"")+" translate("+l+", "+n+")",r=b.length;if(o(p),/^svg$/i.test(p.nodeName)){var s=p.ownerDocument.createElement("g");for(g=0,h=p.attributes,i=h.length;i>g;g++)e=h.item(g),s.setAttribute(e.nodeName,e.nodeValue);for(;p.firstChild;)s.appendChild(p.firstChild);p=s}for(g=0,h=j.attributes,i=h.length;i>g;g++)e=h.item(g),"x"!==e.nodeName&&"y"!==e.nodeName&&"xlink:href"!==e.nodeName&&"href"!==e.nodeName&&("transform"===e.nodeName?q=e.nodeValue+" "+q:p.setAttribute(e.nodeName,e.nodeValue));p.setAttribute("transform",q),p.setAttribute("instantiated_by_use","1"),p.removeAttribute("id"),d=j.parentNode,d.replaceChild(p,j),b.length===r&&c++}}function o(a){var b,c,d,e,f=a.getAttribute("viewBox"),g=1,h=1,i=0,j=0,k=a.getAttribute("width"),l=a.getAttribute("height"),m=a.getAttribute("x")||0,n=a.getAttribute("y")||0,o=a.getAttribute("preserveAspectRatio")||"",p=!f||!q.svgViewBoxElementsRegEx.test(a.nodeName)||!(f=f.match(C)),r=!k||!l||"100%"===k||"100%"===l,s=p&&r,t={},v="",w=0,x=0;if(t.width=0,t.height=0,t.toBeParsed=s,s)return t;if(p)return t.width=u(k),t.height=u(l),t;if(i=-parseFloat(f[1]),j=-parseFloat(f[2]),b=parseFloat(f[3]),c=parseFloat(f[4]),r?(t.width=b,t.height=c):(t.width=u(k),t.height=u(l),g=t.width/b,h=t.height/c),o=q.util.parsePreserveAspectRatioAttribute(o),"none"!==o.alignX&&("meet"===o.meetOrSlice&&(h=g=g>h?h:g),"slice"===o.meetOrSlice&&(h=g=g>h?g:h),w=t.width-b*g,x=t.height-c*g,"Mid"===o.alignX&&(w/=2),"Mid"===o.alignY&&(x/=2),"Min"===o.alignX&&(w=0),"Min"===o.alignY&&(x=0)),1===g&&1===h&&0===i&&0===j&&0===m&&0===n)return t;if((m||n)&&(v=" translate("+u(m)+" "+u(n)+") "),d=v+" matrix("+g+" 0 0 "+h+" "+(i*g+w)+" "+(j*h+x)+") ",t.viewboxTransform=q.parseTransformAttribute(d),"svg"===a.nodeName){for(e=a.ownerDocument.createElement("g");a.firstChild;)e.appendChild(a.firstChild);a.appendChild(e)}else e=a,d=e.getAttribute("transform")+d;return e.setAttribute("transform",d),t}function p(a,b){for(;a&&(a=a.parentNode);)if(a.nodeName&&b.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use"))return!0;return!1}var q=a.fabric||(a.fabric={}),r=q.util.object.extend,s=q.util.object.clone,t=q.util.toFixed,u=q.util.parseUnit,v=q.util.multiplyTransformMatrices,w=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],x=["symbol","image","marker","pattern","view","svg"],y=["pattern","defs","symbol","metadata","clipPath","mask","desc"],z=["symbol","g","a","svg","clipPath","defs"],A={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule"},B={stroke:"strokeOpacity",fill:"fillOpacity"};q.svgValidTagNamesRegEx=d(w),q.svgViewBoxElementsRegEx=d(x),q.svgInvalidAncestorsRegEx=d(y),q.svgValidParentsRegEx=d(z),q.cssRules={},q.gradientDefs={},q.clipPaths={},q.parseTransformAttribute=function(){function a(a,b){var c=q.util.cos(b[0]),d=q.util.sin(b[0]),e=0,f=0;3===b.length&&(e=b[1],f=b[2]),a[0]=c,a[1]=d,a[2]=-d,a[3]=c,a[4]=e-(c*e-d*f),a[5]=f-(d*e+c*f)}function b(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function c(a,b,c){a[c]=Math.tan(q.util.degreesToRadians(b[0]))}function d(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var e=[1,0,0,1,0,0],f=q.reNum,g="(?:\\s+,?\\s*|,\\s*)",h="(?:(skewX)\\s*\\(\\s*("+f+")\\s*\\))",i="(?:(skewY)\\s*\\(\\s*("+f+")\\s*\\))",j="(?:(rotate)\\s*\\(\\s*("+f+")(?:"+g+"("+f+")"+g+"("+f+"))?\\s*\\))",k="(?:(scale)\\s*\\(\\s*("+f+")(?:"+g+"("+f+"))?\\s*\\))",l="(?:(translate)\\s*\\(\\s*("+f+")(?:"+g+"("+f+"))?\\s*\\))",m="(?:(matrix)\\s*\\(\\s*("+f+")"+g+"("+f+")"+g+"("+f+")"+g+"("+f+")"+g+"("+f+")"+g+"("+f+")\\s*\\))",n="(?:"+m+"|"+l+"|"+k+"|"+j+"|"+h+"|"+i+")",o="(?:"+n+"(?:"+g+"*"+n+")*)",p="^\\s*(?:"+o+"?)\\s*$",r=new RegExp(p),s=new RegExp(n,"g");return function(f){var g=e.concat(),h=[];if(!f||f&&!r.test(f))return g;f.replace(s,function(f){var i=new RegExp(n).exec(f).filter(function(a){return!!a}),j=i[1],k=i.slice(2).map(parseFloat);switch(j){case"translate":d(g,k);break;case"rotate":k[0]=q.util.degreesToRadians(k[0]),a(g,k);break;case"scale":b(g,k);break;case"skewX":c(g,k,2);break;case"skewY":c(g,k,1);break;case"matrix":g=k}h.push(g.concat()),g=e.concat()});for(var i=h[0];h.length>1;)h.shift(),i=q.util.multiplyTransformMatrices(i,h[0]);return i}}();var C=new RegExp("^\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*$");q.parseSVGDocument=function(a,b,c,d){if(a){n(a);var e,f,g=q.Object.__uid++,h=o(a),i=q.util.toArray(a.getElementsByTagName("*"));if(h.crossOrigin=d&&d.crossOrigin,h.svgUid=g,0===i.length&&q.isLikelyNode){i=a.selectNodes('//*[name(.)!="svg"]');var j=[];for(e=0,f=i.length;f>e;e++)j[e]=i[e];i=j}var k=i.filter(function(a){return o(a),q.svgValidTagNamesRegEx.test(a.nodeName.replace("svg:",""))&&!p(a,q.svgInvalidAncestorsRegEx)});if(!k||k&&!k.length)return void(b&&b([],{}));var l={};i.filter(function(a){return"clipPath"===a.nodeName.replace("svg:","")}).forEach(function(a){var b=a.getAttribute("id");l[b]=q.util.toArray(a.getElementsByTagName("*")).filter(function(a){return q.svgValidTagNamesRegEx.test(a.nodeName.replace("svg:",""))})}),q.gradientDefs[g]=q.getGradientDefs(a),q.cssRules[g]=q.getCSSRules(a),q.clipPaths[g]=l,q.parseElements(k,function(a,c){b&&(b(a,h,c,i),delete q.gradientDefs[g],delete q.cssRules[g],delete q.clipPaths[g])},s(h),c,d)}};var D=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+q.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+q.reNum+"))?\\s+(.*)");r(q,{parseFontDeclaration:function(a,b){var c=a.match(D);if(c){var d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=u(f)),h&&(b.fontFamily=h),g&&(b.lineHeight="normal"===g?1:g)}},getGradientDefs:function(a){var b,c,d,e=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],g=f(a,e),h=0,i={},j={};for(h=g.length;h--;)b=g[h],d=b.getAttribute("xlink:href"),c=b.getAttribute("id"),d&&(j[c]=d.substr(1)),i[c]=b;for(c in j){var k=i[j[c]].cloneNode(!0);for(b=i[c];k.firstChild;)b.appendChild(k.firstChild)}return i},parseAttributes:function(a,d,f){if(a){var g,h,j={};"undefined"==typeof f&&(f=a.getAttribute("svgUid")),a.parentNode&&q.svgValidParentsRegEx.test(a.parentNode.nodeName)&&(j=q.parseAttributes(a.parentNode,d,f));var k=d.reduce(function(b,c){return g=a.getAttribute(c),g&&(b[c]=g),b},{});k=r(k,r(i(a,f),q.parseStyleAttribute(a))),h=j&&j.fontSize||k["font-size"]||q.Text.DEFAULT_SVG_FONT_SIZE;var l,m,n={};for(var o in k)l=b(o),m=c(l,k[o],j,h),n[l]=m;n&&n.font&&q.parseFontDeclaration(n.font,n);var p=r(j,n);return q.svgValidParentsRegEx.test(a.nodeName)?p:e(p)}},parseElements:function(a,b,c,d,e){new q.ElementsParser(a,b,c,d,e).parse()},parseStyleAttribute:function(a){var b={},c=a.getAttribute("style");return c?("string"==typeof c?g(c,b):h(c,b),b):b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);var b,c,d=[];for(b=0,c=a.length;c>b;b+=2)d.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return d},getCSSRules:function(a){var b,c,d,e=a.getElementsByTagName("style"),f={};for(b=0,c=e.length;c>b;b++){var g=e[b].textContent||e[b].text;g=g.replace(/\/\*[\s\S]*?\*\//g,""),""!==g.trim()&&(d=g.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){var d=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),e={},g=d[2].trim(),h=g.replace(/;$/,"").split(/\s*;\s*/);for(b=0,c=h.length;c>b;b++){var i=h[b].split(/\s*:\s*/),j=i[0],k=i[1];e[j]=k}a=d[1],a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim(),""!==a&&(f[a]?q.util.object.extend(f[a],e):f[a]=q.util.object.clone(e))})}))}return f},loadSVGFromURL:function(a,b,c,d){function e(a){var e=a.responseXML;return e&&!e.documentElement&&q.window.ActiveXObject&&a.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(a.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement?void q.parseSVGDocument(e.documentElement,function(a,c,d,e){b&&b(a,c,d,e)},c,d):(b&&b(null),!1)}a=a.replace(/^\n\s*/,"").trim(),new q.util.request(a,{method:"get",onComplete:e})},loadSVGFromString:function(a,b,c,d){a=a.trim();var e;if("undefined"!=typeof DOMParser){var f=new DOMParser;f&&f.parseFromString&&(e=f.parseFromString(a,"text/xml"))}else q.window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));q.parseSVGDocument(e.documentElement,function(a,c,d,e){b(a,c,d,e)},c,d)}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(a,b,c,d,e){this.elements=a,this.callback=b,this.options=c,this.reviver=d,this.svgUid=c&&c.svgUid||0,this.parsingOptions=e,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g},function(a){a.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},a.createObjects=function(){var a=this;this.elements.forEach(function(b,c){b.setAttribute("svgUid",a.svgUid),a.createObject(b,c)})},a.findTag=function(a){return fabric[fabric.util.string.capitalize(a.tagName.replace("svg:",""))]},a.createObject=function(a,b){var c=this.findTag(a);if(c&&c.fromElement)try{c.fromElement(a,this.createCallback(b,a),this.options)}catch(d){fabric.log(d)}else this.checkIfDone()},a.createCallback=function(a,b){var c=this;return function(d){var e;c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),d instanceof fabric.Image&&(e=d.parsePreserveAspectRatioAttribute(b)),d._removeTransformMatrix(e),c.resolveClipPath(d),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},a.extractPropertyDefinition=function(a,b,c){var d=a[b];if(/^url\(/.test(d)){var e=this.regexUrl.exec(d)[1];return this.regexUrl.lastIndex=0,fabric[c][this.svgUid][e]}},a.resolveGradient=function(a,b){var c=this.extractPropertyDefinition(a,b,"gradientDefs");c&&a.set(b,fabric.Gradient.fromElement(c,a))},a.createClipPathCallback=function(a,b){return function(a){a._removeTransformMatrix(),a.fillRule=a.clipRule,b.push(a)}},a.resolveClipPath=function(a){var b,c,d,e,f,g,h=this.extractPropertyDefinition(a,"clipPath","clipPaths");if(h){e=[],d=fabric.util.invertTransform(a.calcTransformMatrix());for(var i=0;i<h.length;i++)b=h[i],c=this.findTag(b),c.fromElement(b,this.createClipPathCallback(a,e),this.options);h=1===e.length?e[0]:new fabric.Group(e),f=fabric.util.multiplyTransformMatrices(d,h.calcTransformMatrix());var g=fabric.util.qrDecompose(f);h.flipX=!1,h.flipY=!1,h.set("scaleX",g.scaleX),h.set("scaleY",g.scaleY),h.angle=g.angle,h.skewX=g.skewX,h.skewY=0,h.setPositionByOrigin({x:g.translateX,y:g.translateY},"center","center"),a.clipPath=h}},a.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances,this.elements))}}(fabric.ElementsParser.prototype),!function(a){"use strict";function b(a,b){this.x=a,this.y=b}var c=a.fabric||(a.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=b,void(b.prototype={type:"point",constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,c){return"undefined"==typeof c&&(c=.5),c=Math.max(Math.min(1,c),0),new b(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return this.lerp(a)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setFromPoint:function(a){return this.x=a.x,this.y=a.y,this},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c},clone:function(){return new b(this.x,this.y)}}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";function b(a){this.status=a,this.points=[]}var c=a.fabric||(a.fabric={});return c.Intersection?void c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={constructor:b,appendPoint:function(a){return this.points.push(a),this},appendPoints:function(a){return this.points=this.points.concat(a),this}},c.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;k>=0&&1>=k&&l>=0&&1>=l?(g=new b("Intersection"),g.appendPoint(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new b}else g=new b(0===h||0===i?"Coincident":"Parallel");return g},c.Intersection.intersectLinePolygon=function(a,c,d){var e,f,g,h,i=new b,j=d.length;for(h=0;j>h;h++)e=d[h],f=d[(h+1)%j],g=b.intersectLineLine(a,c,e,f),i.appendPoints(g.points);return i.points.length>0&&(i.status="Intersection"),i},c.Intersection.intersectPolygonPolygon=function(a,c){var d,e=new b,f=a.length;for(d=0;f>d;d++){var g=a[d],h=a[(d+1)%f],i=b.intersectLinePolygon(g,h,c);e.appendPoints(i.points)}return e.points.length>0&&(e.status="Intersection"),e},void(c.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new c.Point(g.x,f.y),i=new c.Point(f.x,g.y),j=b.intersectLinePolygon(f,h,a),k=b.intersectLinePolygon(h,g,a),l=b.intersectLinePolygon(g,i,a),m=b.intersectLinePolygon(i,f,a),n=new b;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var d=a.fabric||(a.fabric={});return d.Color?void d.warn("fabric.Color is already defined."):(d.Color=b,d.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]),"transparent"===a&&(c=[255,255,255,0]),c||(c=b.sourceFromHex(a)),c||(c=b.sourceFromRgb(a)),c||(c=b.sourceFromHsl(a)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(a,b,c){a/=255,b/=255,c/=255;var e,f,g,h=d.util.array.max([a,b,c]),i=d.util.array.min([a,b,c]);if(g=(h+i)/2,h===i)e=f=0;else{var j=h-i;switch(f=g>.5?j/(2-h-i):j/(h+i),h){case a:e=(b-c)/j+(c>b?6:0);break;case b:e=(c-a)/j+2;break;case c:e=(a-b)/j+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,c,d=this.getSource();return a=d[0].toString(16),a=1===a.length?"0"+a:a,b=d[1].toString(16),b=1===b.length?"0"+b:b,c=d[2].toString(16),c=1===c.length?"0"+c:c,a.toUpperCase()+b.toUpperCase()+c.toUpperCase()},toHexa:function(){var a,b=this.getSource();return a=Math.round(255*b[3]),a=a.toString(16),a=1===a.length?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof b||(a=new b(a));var c,d=[],e=this.getAlpha(),f=.5,g=this.getSource(),h=a.getSource();for(c=0;3>c;c++)d.push(Math.round(g[c]*(1-f)+h[c]*f));return d[3]=e,this.setSource(d),this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,d.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,d.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},d.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},d.Color.sourceFromRgb=function(a){var c=a.match(b.reRGBa);if(c){var d=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),e=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),f=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(d,10),parseInt(e,10),parseInt(f,10),c[4]?parseFloat(c[4]):1]}},d.Color.fromRgba=b.fromRgb,d.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){var d=a.match(b.reHSLa);if(d){var e,f,g,h=(parseFloat(d[1])%360+360)%360/360,i=parseFloat(d[2])/(/%$/.test(d[2])?100:1),j=parseFloat(d[3])/(/%$/.test(d[3])?100:1);if(0===i)e=f=g=j;else{var k=.5>=j?j*(i+1):j+i-j*i,l=2*j-k;e=c(l,k,h+1/3),f=c(l,k,h),g=c(l,k,h-1/3)}return[Math.round(255*e),Math.round(255*f),Math.round(255*g),d[4]?parseFloat(d[4]):1]}},d.Color.fromHsla=b.fromHsl,d.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length||4===c.length,e=8===c.length||4===c.length,f=d?c.charAt(0)+c.charAt(0):c.substring(0,2),g=d?c.charAt(1)+c.charAt(1):c.substring(2,4),h=d?c.charAt(2)+c.charAt(2):c.substring(4,6),i=e?d?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(f,16),parseInt(g,16),parseInt(h,16),parseFloat((parseInt(i,16)/255).toFixed(2))]}},void(d.Color.fromSource=function(a){var c=new b;return c.setSource(a),c}))}("undefined"!=typeof exports?exports:this),!function(){function a(a){var b,c,d,e,f=a.getAttribute("style"),g=a.getAttribute("offset")||0;if(g=parseFloat(g)/(/%$/.test(g)?100:1),g=0>g?0:g>1?1:g,f){var h=f.split(/\s*;\s*/);for(""===h[h.length-1]&&h.pop(),e=h.length;e--;){var i=h[e].split(/\s*:\s*/),j=i[0].trim(),k=i[1].trim();"stop-color"===j?b=k:"stop-opacity"===j&&(d=k)}}return b||(b=a.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=a.getAttribute("stop-opacity")),b=new fabric.Color(b),c=b.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=c,{offset:g,color:b.toRgb(),opacity:d}}function b(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function c(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}function d(a,b,c){var d,e=0,f=1,g="";for(var h in b)"Infinity"===b[h]?b[h]=1:"-Infinity"===b[h]&&(b[h]=0),d=parseFloat(b[h],10),f="string"==typeof b[h]&&/^(\d+\.\d+)%|(\d+)%$/.test(b[h])?.01:1,"x1"===h||"x2"===h||"r2"===h?(f*="objectBoundingBox"===c?a.width:1,e="objectBoundingBox"===c?a.left||0:0):("y1"===h||"y2"===h)&&(f*="objectBoundingBox"===c?a.height:1,e="objectBoundingBox"===c?a.top||0:0),b[h]=d*f+e;if("ellipse"===a.type&&null!==b.r2&&"objectBoundingBox"===c&&a.rx!==a.ry){var i=a.ry/a.rx;g=" scale(1, "+i+")",b.y1&&(b.y1/=i),b.y2&&(b.y2/=i)}return g}var e=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var b={};this.id=fabric.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.colorStops=a.colorStops.slice(),a.gradientTransform&&(this.gradientTransform=a.gradientTransform),this.offsetX=a.offsetX||this.offsetX,this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var b in a){var c=new fabric.Color(a[b]);this.colorStops.push({offset:parseFloat(b),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(a){var b={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,b,a),b},toSVG:function(a){var b,c,d,f,g=e(this.coords,!0),h=e(this.colorStops,!0),i=g.r1>g.r2,j=a.width/2,k=a.height/2;h.sort(function(a,b){return a.offset-b.offset}),"path"===a.type&&(j-=a.pathOffset.x,k-=a.pathOffset.y);for(var l in g)"x1"===l||"x2"===l?g[l]+=this.offsetX-j:("y1"===l||"y2"===l)&&(g[l]+=this.offsetY-k);if(f='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(f+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?d=["<linearGradient ",f,' x1="',g.x1,'" y1="',g.y1,'" x2="',g.x2,'" y2="',g.y2,'">\n']:"radial"===this.type&&(d=["<radialGradient ",f,' cx="',i?g.x1:g.x2,'" cy="',i?g.y1:g.y2,'" r="',i?g.r1:g.r2,'" fx="',i?g.x2:g.x1,'" fy="',i?g.y2:g.y1,'">\n']),"radial"===this.type){if(i)for(h=h.concat(),h.reverse(),b=0,c=h.length;c>b;b++)h[b].offset=1-h[b].offset;var m=Math.min(g.r1,g.r2);if(m>0){var n=Math.max(g.r1,g.r2),o=m/n;for(b=0,c=h.length;c>b;b++)h[b].offset+=o*(1-h[b].offset)}}for(b=0,c=h.length;c>b;b++){var p=h[b];d.push("<stop ",'offset="',100*p.offset+"%",'" style="stop-color:',p.color,"undefined"!=typeof p.opacity?";stop-opacity: "+p.opacity:";",'"/>\n')}return d.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),d.join("")},toLive:function(a){var b,c,d,e=fabric.util.object.clone(this.coords);if(this.type){for("linear"===this.type?b=a.createLinearGradient(e.x1,e.y1,e.x2,e.y2):"radial"===this.type&&(b=a.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2)),c=0,d=this.colorStops.length;d>c;c++){var f=this.colorStops[c].color,g=this.colorStops[c].opacity,h=this.colorStops[c].offset;"undefined"!=typeof g&&(f=new fabric.Color(f).setAlpha(g).toRgba()),b.addColorStop(h,f)}return b}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,f){var g,h,i,j,k=e.getElementsByTagName("stop"),l=e.getAttribute("gradientUnits")||"objectBoundingBox",m=e.getAttribute("gradientTransform"),n=[];for(g="linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?"linear":"radial","linear"===g?h=b(e):"radial"===g&&(h=c(e)),j=k.length;j--;)n.push(a(k[j]));i=d(f,h,l);var o=new fabric.Gradient({type:g,coords:h,colorStops:n,offsetX:-f.left,offsetY:-f.top});return(m||""!==i)&&(o.gradientTransform=fabric.parseTransformAttribute((m||"")+i)),o},forObject:function(a,b){return b||(b={}),d(a,b.coords,"userSpaceOnUse"),new fabric.Gradient(b)}})}(),!function(){"use strict";var a=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(a,b){if(a||(a={}),this.id=fabric.Object.__uid++,this.setOptions(a),!a.source||a.source&&"string"!=typeof a.source)return void(b&&b(this));if("undefined"!=typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source)),b&&b(this);else{var c=this;this.source=fabric.util.createImage(),fabric.util.loadImage(a.source,function(a){c.source=a,b&&b(c)},null,this.crossOrigin)}},toObject:function(b){var c,d,e=fabric.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?c=String(this.source):"string"==typeof this.source.src?c=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(c=this.source.toDataURL()),d={type:"pattern",source:c,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:a(this.offsetX,e),offsetY:a(this.offsetY,e),patternTransform:this.patternTransform?this.patternTransform.concat():null},fabric.util.populateWithProperties(this,d,b),d},toSVG:function(a){var b="function"==typeof this.source?this.source():this.source,c=b.width/a.width,d=b.height/a.height,e=this.offsetX/a.width,f=this.offsetY/a.height,g="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(d=1,f&&(d+=Math.abs(f))),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(c=1,e&&(c+=Math.abs(e))),b.src?g=b.src:b.toDataURL&&(g=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+f+'" width="'+c+'" height="'+d+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},setOptions:function(a){for(var b in a)this[b]=a[b]},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!=typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}})}(),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Shadow?void b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){var c=a.trim(),d=b.Shadow.reOffsetsAndBlur.exec(c)||[],e=c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var d=40,e=40,f=b.Object.NUM_FRACTION_DIGITS,g=b.util.rotateVector({x:this.offsetX,y:this.offsetY},b.util.degreesToRadians(-a.angle)),h=20,i=new b.Color(this.color);return a.width&&a.height&&(d=100*c((Math.abs(g.x)+this.blur)/a.width,f)+h,e=100*c((Math.abs(g.y)+this.blur)/a.height,f)+h),a.flipX&&(g.x*=-1),a.flipY&&(g.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+c(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+c(g.x,f)+'" dy="'+c(g.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+i.toRgb()+'" flood-opacity="'+i.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},c=b.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(b){this[b]!==c[b]&&(a[b]=this[b])},this),a}}),void(b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),!function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");
var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=fabric.util.toFixed,e=fabric.util.transformPoint,f=fabric.util.invertTransform,g=fabric.util.getNodeCanvas,h=fabric.util.createCanvasElement,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(a,b){b||(b={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(a,b){var c=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(a),this._initOptions(b),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),b.overlayImage&&this.setOverlayImage(b.overlayImage,c),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,c),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,c),b.overlayColor&&this.setOverlayColor(b.overlayColor,c),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled||a.oImageSmoothingEnabled,a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){return"string"==typeof b?fabric.util.loadImage(b,function(b){if(b){var e=new fabric.Image(b,d);this[a]=e,e.canvas=this}c&&c(b)},this,d&&d.crossOrigin):(d&&b.setOptions(d),this[a]=b,b&&(b.canvas=this),c&&c(b)),this},__setBgOverlayColor:function(a,b,c){return this[a]=b,this._initGradient(b,a),this._initPattern(b,a,c),this},_createCanvasElement:function(){var a=h();if(!a)throw i;if(a.style||(a.style={}),"undefined"==typeof a.getContext)throw i;return a},_initOptions:function(a){var b=this.lowerCanvasEl;this._setOptions(a),this.width=this.width||parseInt(b.width,10)||0,this.height=this.height||parseInt(b.height,10)||0,this.lowerCanvasEl.style&&(b.width=this.width,b.height=this.height,b.style.width=this.width+"px",b.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=a&&a.getContext?a:fabric.util.getById(a)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px",this.hasLostContext=!0),b.backstoreOnly||this._setCssDimension(d,c);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),b.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var b,c,d,e=this._activeObject,f=!1,g=!0;for(this.viewportTransform=a,c=0,d=this._objects.length;d>c;c++)b=this._objects[c],b.group||b.setCoords(f,g);return e&&"activeSelection"===e.type&&e.setCoords(f,g),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(a,b){var c=a,d=this.viewportTransform.slice(0);a=e(a,f(this.viewportTransform)),d[0]=b,d[3]=b;var g=e(a,d);return d[4]+=c.x-g.x,d[5]+=c.y-g.y,this.setViewportTransform(d)},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){var b=this.viewportTransform.slice(0);return b[4]=-a.x,b[5]=-a.y,this.setViewportTransform(b)},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState(),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a}),a.fire("removed"),delete a.canvas},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var a=this.contextContainer;return this.renderCanvas(a,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var a={},b=this.width,c=this.height,d=f(this.viewportTransform);return a.tl=e({x:0,y:0},d),a.br=e({x:b,y:c},d),a.tr=new fabric.Point(a.br.x,a.tl.y),a.bl=new fabric.Point(a.tl.x,a.br.y),this.vptCoords=a,a},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(a,b){var c=this.viewportTransform,d=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(a),this.fire("before:render",{ctx:a}),this.clipTo&&fabric.util.clipContext(this,a),this._renderBackground(a),a.save(),a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._renderObjects(a,b),a.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.clipTo&&a.restore(),d&&(d.canvas=this,d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(a)),this._renderOverlay(a),this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.fire("after:render",{ctx:a})},drawClipPathOnCanvas:function(a){var b=this.viewportTransform,c=this.clipPath;a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),a.globalCompositeOperation="destination-in",c.transform(a),a.scale(1/c.zoomX,1/c.zoomY),a.drawImage(c._cacheCanvas,-c.cacheTranslationX,-c.cacheTranslationY),a.restore()},_renderObjects:function(a,b){var c,d;for(c=0,d=b.length;d>c;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,b){var c,d=this[b+"Color"];d&&(a.fillStyle=d.toLive?d.toLive(a,this):d,a.fillRect(d.offsetX||0,d.offsetY||0,this.width,this.height)),d=this[b+"Image"],d&&(this[b+"Vpt"]&&(c=this.viewportTransform,a.save(),a.transform(c[0],c[1],c[2],c[3],c[4],c[5])),d.render(a),this[b+"Vpt"]&&a.restore())},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top))},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top))},viewportCenterObject:function(a){var b=this.getVpCenter();return this._centerObject(a,b)},viewportCenterObjectH:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(b.x,a.getCenterPoint().y)),this},viewportCenterObjectV:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,b.y))},getVpCenter:function(){var a=this.getCenter(),b=f(this.viewportTransform);return e({x:a.left,y:a.top},b)},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center","center"),a.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,c){var d=this.clipPath,e={version:fabric.version,objects:this._toObjects(b,c)};return d&&(d=d.toObject(c)),a(e,this.__serializeBgOverlay(b,c)),fabric.util.populateWithProperties(this,e,c),e},_toObjects:function(a,b){return this._objects.filter(function(a){return!a.excludeFromExport}).map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);var e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=d),e},__serializeBgOverlay:function(a,b){var c={},d=this.backgroundImage,e=this.overlayImage;return this.backgroundColor&&(c.background=this.backgroundColor.toObject?this.backgroundColor.toObject(b):this.backgroundColor),this.overlayColor&&(c.overlay=this.overlayColor.toObject?this.overlayColor.toObject(b):this.overlayColor),d&&!d.excludeFromExport&&(c.backgroundImage=this._toObject(d,a,b)),e&&!e.excludeFromExport&&(c.overlayImage=this._toObject(e,a,b)),c},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={}),a.reviver=b;var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage",b),this.clipPath&&c.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGObjects(c,b),this.clipPath&&c.push("</g>\n"),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage",b),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var c,e=b.width||this.width,f=b.height||this.height,g='viewBox="0 0 '+this.width+" "+this.height+'" ',h=fabric.Object.NUM_FRACTION_DIGITS;b.viewBox?g='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(c=this.viewportTransform,g='viewBox="'+d(-c[4]/c[0],h)+" "+d(-c[5]/c[3],h)+" "+d(this.width/c[0],h)+" "+d(this.height/c[3],h)+'" '),a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e,'" ','height="',f,'" ',g,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(b),"</defs>\n")},createSVGClipPathMarkup:function(a){var b=this.clipPath;return b?(b.clipPathId="CLIPPATH_"+fabric.Object.__uid++,'<clipPath id="'+b.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(a.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var a=this,b=["backgroundColor","overlayColor"].map(function(b){var c=a[b];return c&&c.toLive?c.toSVG(a,!1):void 0});return b.join("")},createSVGFontFacesMarkup:function(){var a,b,c,d,e,f,g,h,i,j="",k={},l=fabric.fontPaths,m=this._objects;for(h=0,i=m.length;i>h;h++)if(a=m[h],b=a.fontFamily,-1!==a.type.indexOf("text")&&!k[b]&&l[b]&&(k[b]=!0,a.styles)){c=a.styles;for(e in c){d=c[e];for(g in d)f=d[g],b=f.fontFamily,!k[b]&&l[b]&&(k[b]=!0)}}for(var n in k)j+=["\t\t@font-face {\n","\t\t\tfont-family: '",n,"';\n","\t\t\tsrc: url('",l[n],"');\n","\t\t}\n"].join("");return j&&(j=['\t<style type="text/css">',"<![CDATA[\n",j,"]]>","</style>\n"].join("")),j},_setSVGObjects:function(a,b){var c,d,e,f=this._objects;for(d=0,e=f.length;e>d;d++)c=f[d],c.excludeFromExport||this._setSVGObject(a,c,b)},_setSVGObject:function(a,b,c){a.push(b.toSVG(c))},_setSVGBgOverlayImage:function(a,b,c){this[b]&&!this[b].excludeFromExport&&this[b].toSVG&&a.push(this[b].toSVG(c))},_setSVGBgOverlayColor:function(a,b){var c=this[b],d=this.viewportTransform,e=this.width/d[0],f=this.height/d[3];if(c)if(c.toLive){var g=c.repeat;a.push('<rect transform="translate(',e/2,",",f/2,')"',' x="',c.offsetX-e/2,'" y="',c.offsetY-f/2,'" ','width="',"repeat-y"===g||"no-repeat"===g?c.source.width:e,'" height="',"repeat-x"===g||"no-repeat"===g?c.source.height:f,'" fill="url(#SVGID_'+c.id+')"',"></rect>\n")}else a.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){if(!a)return this;var b,d,e,f=this._activeObject;if(a===f&&"activeSelection"===a.type)for(e=f._objects,b=e.length;b--;)d=e[b],c(this._objects,d),this._objects.unshift(d);else c(this._objects,a),this._objects.unshift(a);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(a){if(!a)return this;var b,d,e,f=this._activeObject;if(a===f&&"activeSelection"===a.type)for(e=f._objects,b=0;b<e.length;b++)d=e[b],c(this._objects,d),this._objects.push(d);else c(this._objects,a),this._objects.push(a);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(a,b){if(!a)return this;var d,e,f,g,h,i=this._activeObject,j=0;if(a===i&&"activeSelection"===a.type)for(h=i._objects,d=0;d<h.length;d++)e=h[d],f=this._objects.indexOf(e),f>0+j&&(g=f-1,c(this._objects,e),this._objects.splice(g,0,e)),j++;else f=this._objects.indexOf(a),0!==f&&(g=this._findNewLowerIndex(a,f,b),c(this._objects,a),this._objects.splice(g,0,a));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(a,b,c){var d,e;if(c)for(d=b,e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}else d=b-1;return d},bringForward:function(a,b){if(!a)return this;var d,e,f,g,h,i=this._activeObject,j=0;if(a===i&&"activeSelection"===a.type)for(h=i._objects,d=h.length;d--;)e=h[d],f=this._objects.indexOf(e),f<this._objects.length-1-j&&(g=f+1,c(this._objects,e),this._objects.splice(g,0,e)),j++;else f=this._objects.indexOf(a),f!==this._objects.length-1&&(g=this._findNewUpperIndex(a,f,b),c(this._objects,a),this._objects.splice(g,0,a));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(a,b,c){var d,e,f;if(c)for(d=b,e=b+1,f=this._objects.length;f>e;++e){var g=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(g){d=e;break}}else d=b+1;return d},moveTo:function(a,b){return c(this._objects,a),this._objects.splice(b,0,a),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(a){a.dispose&&a.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),a(fabric.StaticCanvas.prototype,fabric.Observable),a(fabric.StaticCanvas.prototype,fabric.Collection),a(fabric.StaticCanvas.prototype,fabric.DataURLExporter),a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=h();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!=typeof c.getImageData;case"setLineDash":return"undefined"!=typeof c.setLineDash;case"toDataURL":return"undefined"!=typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var a=g(this.lowerCanvasEl);return a&&a.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){var b=g(this.lowerCanvasEl);return b&&b.createJPEGStream(a)})}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.miterLimit=this.strokeMiterLimit,a.lineJoin=this.strokeLineJoin,fabric.StaticCanvas.supports("setLineDash")&&a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var b=this.canvas.viewportTransform;a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5])},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop,b=this.canvas.getZoom();a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*b,a.shadowOffsetX=this.shadow.offsetX*b,a.shadowOffsetY=this.shadow.offsetY*b}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),!function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},_drawSegment:function(a,b,c){var d=b.midPointFrom(c);return a.quadraticCurveTo(b.x,b.y,d.x,d.y),d},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){if(this._captureDrawingPath(a)&&this._points.length>1)if(this.needsFullRender)this.canvas.clearContext(this.canvas.contextTop),this._render();else{var b=this._points,c=b.length,d=this.canvas.contextTop;this._saveAndTransform(d),this.oldEnd&&(d.beginPath(),d.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(d,b[c-2],b[c-1],!0),d.stroke(),d.restore()}},onMouseUp:function(){this.oldEnd=void 0,this._finalizeAndAddPath()},_prepareForDrawing:function(a){var b=new fabric.Point(a.x,a.y);this._reset(),this._addPoint(b),this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(a){return!(this._points.length>1&&a.eq(this._points[this._points.length-1]))&&(this._points.push(a),!0)},_reset:function(){this._points.length=0,this._setBrushStyles();var a=new fabric.Color(this.color);this.needsFullRender=a.getAlpha()<1,this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);return this._addPoint(b)},_render:function(){var a,b,c=this.canvas.contextTop,d=this._points[0],e=this._points[1];if(this._saveAndTransform(c),c.beginPath(),2===this._points.length&&d.x===e.x&&d.y===e.y){var f=this.width/1e3;d=new fabric.Point(d.x,d.y),e=new fabric.Point(e.x,e.y),d.x-=f,e.x+=f}for(c.moveTo(d.x,d.y),a=1,b=this._points.length;b>a;a++)this._drawSegment(c,d,e),d=this._points[a],e=this._points[a+1];c.lineTo(d.x,d.y),c.stroke(),c.restore()},convertPointsToSVGPath:function(a){var b,c=[],d=this.width/1e3,e=new fabric.Point(a[0].x,a[0].y),f=new fabric.Point(a[1].x,a[1].y),g=a.length,h=1,i=1,j=g>2;for(j&&(h=a[2].x<f.x?-1:a[2].x===f.x?0:1,i=a[2].y<f.y?-1:a[2].y===f.y?0:1),c.push("M ",e.x-h*d," ",e.y-i*d," "),b=1;g>b;b++){if(!e.eq(f)){var k=e.midPointFrom(f);c.push("Q ",e.x," ",e.y," ",k.x," ",k.y," ")}e=a[b],b+1<a.length&&(f=a[b+1])}return j&&(h=e.x>a[b-2].x?1:e.x===a[b-2].x?0:-1,i=e.y>a[b-2].y?1:e.y===a[b-2].y?0:-1),c.push("L ",e.x+h*d," ",e.y+i*d),c},createPath:function(a){var b=new fabric.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),c=new fabric.Point(b.left+b.width/2,b.top+b.height/2);return c=b.translateToGivenOrigin(c,"center","center",b.originX,b.originY),b.top=c.y,b.left=c.x,this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var b=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.requestRenderAll();var c=this.createPath(b);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(c),this.canvas.renderAll(),c.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:c})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var b=this.addPoint(a),c=this.canvas.contextTop;this._saveAndTransform(c),c.fillStyle=b.fill,c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},_render:function(){var a,b,c,d=this.canvas.contextTop,e=this.points;for(this._saveAndTransform(d),a=0,b=e.length;b>a;a++)c=e[a],d.fillStyle=c.fill,d.beginPath(),d.arc(c.x,c.y,c.radius,0,2*Math.PI,!1),d.closePath(),d.fill();d.restore()},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var a,b,c=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var d=[];for(a=0,b=this.points.length;b>a;a++){var e=this.points[a],f=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&f.setShadow(this.shadow),d.push(f)}var g=new fabric.Group(d);g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},addPoint:function(a){var b=new fabric.Point(a.x,a.y),c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return b.radius=c,b.fill=d,this.points.push(b),b}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.sprayChunks.length;d>c;c++)for(var e=this.sprayChunks[c],f=0,g=e.length;g>f;f++){var h=new fabric.Rect({width:e[f].width,height:e[f].width,left:e[f].x+1,top:e[f].y+1,originX:"center",originY:"center",fill:this.color});b.push(h)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));var i=new fabric.Group(b);this.shadow&&i.setShadow(this.shadow),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var b,c,d,e={};for(c=0,d=a.length;d>c;c++)b=a[c].left+""+a[c].top,e[b]||(e[b]=a[c]);var f=[];for(b in e)f.push(e[b]);return f},render:function(a){var b,c,d=this.canvas.contextTop;for(d.fillStyle=this.color,this._saveAndTransform(d),b=0,c=a.length;c>b;b++){var e=a[b];"undefined"!=typeof e.opacity&&(d.globalAlpha=e.opacity),d.fillRect(e.x,e.y,e.width,e.width)}d.restore()},_render:function(){var a,b,c=this.canvas.contextTop;for(c.fillStyle=this.color,this._saveAndTransform(c),a=0,b=this.sprayChunks.length;b>a;a++)this.render(this.sprayChunks[a]);c.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var b,c,d,e,f=this.width/2;for(e=0;e<this.density;e++){b=fabric.util.getRandomInt(a.x-f,a.x+f),c=fabric.util.getRandomInt(a.y-f,a.y+f),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var g=new fabric.Point(b,c);g.width=d,this.randomOpacity&&(g.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(g)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var a=20,b=5,c=fabric.util.createCanvasElement(),d=c.getContext("2d");return c.width=c.height=a+b,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,2*Math.PI,!1),d.closePath(),d.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){var b=this.callSuper("createPath",a),c=b._getLeftTopCoords().scalarAdd(b.strokeWidth/2);return b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),b}}),!function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,d=Math.atan2,e=Math.abs,f=fabric.StaticCanvas.supports("setLineDash"),g=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a,b,c,d=this.getActiveObjects();if(d.length>0&&!this.preserveObjectStacking){b=[],c=[];for(var e=0,f=this._objects.length;f>e;e++)a=this._objects[e],-1===d.indexOf(a)?b.push(a):c.push(a);d.length>1&&(this._activeObject._objects=c),b.push.apply(b,c)}else b=this._objects;return b},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var a=this.contextContainer;return this.renderCanvas(a,this._chooseObjectsToRender()),this},renderTopLayer:function(a){this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0)},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.renderTopLayer(a),this.fire("after:render"),this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top}),this._shouldCenterTransform(a.target)?("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b,c){var d,e=!0,f=c||this.getPointer(a,e);return d=b.group&&b.group===this._activeObject&&"activeSelection"===b.group.type?this._normalizePointer(b.group,f):{x:f.x,y:f.y},b.containsPoint(d)||b._findTargetCorner(f)},_normalizePointer:function(a,b){var c=a.calcTransformMatrix(),d=fabric.util.invertTransform(c),e=this.restorePointerVpt(b);return fabric.util.transformPoint(e,d)},isTargetTransparent:function(a,b,c){if(a.shouldCache()&&a._cacheCanvas){var d=this._normalizePointer(a,{x:b,y:c}),e=a.cacheTranslationX+d.x*a.zoomX,f=a.cacheTranslationY+d.y*a.zoomY,g=fabric.util.isTransparent(a._cacheContext,e,f,this.targetFindTolerance);return g}var h=this.contextCache,i=a.selectionBackgroundColor,j=this.viewportTransform;a.selectionBackgroundColor="",this.clearContext(h),h.save(),h.transform(j[0],j[1],j[2],j[3],j[4],j[5]),a.render(h),h.restore(),a===this._activeObject&&a._renderControls(h,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),a.selectionBackgroundColor=i;var g=fabric.util.isTransparent(h,b,c,this.targetFindTolerance);return g},_isSelectionKeyPressed:function(a){var b=!1;return b="[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(b){return a[b]===!0}):a[this.selectionKey]},_shouldClearSelection:function(a,b){var c=this.getActiveObjects(),d=this._activeObject;return!b||b&&d&&c.length>1&&-1===c.indexOf(b)&&d!==b&&!this._isSelectionKeyPressed(a)||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a){if(a){var b,c=this._currentTransform;return"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation),b?!c.altKey:c.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,b,c){if(!b)return"drag";switch(b){case"mtr":return"rotate";case"ml":case"mr":return c[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return c[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,c){if(c){var d=this.getPointer(a),e=c._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(c,e,a),g=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,corner:e,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:d.x-c.left,offsetY:d.y-c.top,
originX:g.x,originY:g.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey],original:fabric.util.saveObjectTransform(c)},this._currentTransform.original.originX=g.x,this._currentTransform.original.originY=g.y,this._resetCurrentTransform(),this._beforeTransform(a)}},_translateObject:function(a,b){var c=this._currentTransform,d=c.target,e=a-c.offsetX,f=b-c.offsetY,g=!d.get("lockMovementX")&&d.left!==e,h=!d.get("lockMovementY")&&d.top!==f;return g&&d.set("left",e),h&&d.set("top",f),g||h},_changeSkewTransformOrigin:function(a,b,c){var d="originX",e={0:"center"},f=b.target.skewX,g="left",h="right",i="mt"===b.corner||"ml"===b.corner?1:-1,j=1;a=a>0?1:-1,"y"===c&&(f=b.target.skewY,g="top",h="bottom",d="originY"),e[-1]=g,e[1]=h,b.target.flipX&&(j*=-1),b.target.flipY&&(j*=-1),0===f?(b.skewSign=-i*a*j,b[d]=e[-a]):(f=f>0?1:-1,b.skewSign=f,b[d]=e[f*i*j])},_skewObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=!1,g=e.get("lockSkewingX"),h=e.get("lockSkewingY");if(g&&"x"===c||h&&"y"===c)return!1;var i,j,k=e.getCenterPoint(),l=e.toLocalPoint(new fabric.Point(a,b),"center","center")[c],m=e.toLocalPoint(new fabric.Point(d.lastX,d.lastY),"center","center")[c],n=e._getTransformedDimensions();return this._changeSkewTransformOrigin(l-m,d,c),i=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY)[c],j=e.translateToOriginPoint(k,d.originX,d.originY),f=this._setObjectSkew(i,d,c,n),d.lastX=a,d.lastY=b,e.setPositionByOrigin(j,d.originX,d.originY),f},_setObjectSkew:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n=b.target,o=!1,p=b.skewSign;return"x"===c?(h="y",i="Y",j="X",l=0,m=n.skewY):(h="x",i="X",j="Y",l=n.skewX,m=0),g=n._getTransformedDimensions(l,m),k=2*Math.abs(a)-g[c],2>=k?e=0:(e=p*Math.atan(k/n["scale"+j]/(g[h]/n["scale"+i])),e=fabric.util.radiansToDegrees(e)),o=n["skew"+j]!==e,n.set("skew"+j,e),0!==n["skew"+i]&&(f=n._getTransformedDimensions(),e=d[h]/f[h]*n["scale"+i],n.set("scale"+i,e)),o},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=e.lockScalingX,g=e.lockScalingY,h=e.lockScalingFlip;if(f&&g)return!1;var i=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),j=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY),k=e._getTransformedDimensions(),l=!1;return this._setLocalMouse(j,d),l=this._setObjectScale(j,d,f,g,c,h,k),e.setPositionByOrigin(i,d.originX,d.originY),l},_setObjectScale:function(a,b,c,d,e,f,g){var h,i,j,k,l=b.target,m=!1,n=!1,o=!1;return j=a.x*l.scaleX/g.x,k=a.y*l.scaleY/g.y,h=l.scaleX!==j,i=l.scaleY!==k,f&&0>=j&&j<l.scaleX&&(m=!0,a.x=0),f&&0>=k&&k<l.scaleY&&(n=!0,a.y=0),"equally"!==e||c||d?e?"x"!==e||l.get("lockUniScaling")?"y"!==e||l.get("lockUniScaling")||n||d||l.set("scaleY",k)&&(o=o||i):m||c||l.set("scaleX",j)&&(o=o||h):(m||c||l.set("scaleX",j)&&(o=o||h),n||d||l.set("scaleY",k)&&(o=o||i)):o=this._scaleObjectEqually(a,l,b,g),b.newScaleX=j,b.newScaleY=k,m||n||this._flipObject(b,e),o},_scaleObjectEqually:function(a,b,c,d){var e,f=a.y+a.x,g=d.y*c.original.scaleY/b.scaleY+d.x*c.original.scaleX/b.scaleX,h=a.x<0?-1:1,i=a.y<0?-1:1;return c.newScaleX=h*Math.abs(c.original.scaleX*f/g),c.newScaleY=i*Math.abs(c.original.scaleY*f/g),e=c.newScaleX!==b.scaleX||c.newScaleY!==b.scaleY,b.set("scaleX",c.newScaleX),b.set("scaleY",c.newScaleY),e},_flipObject:function(a,b){a.newScaleX<0&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left")),a.newScaleY<0&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target,d=this.getZoom(),f=c.padding/d;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x*=2*b.mouseXSign,a.x<0&&(b.mouseXSign=-b.mouseXSign)),"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y*=2*b.mouseYSign,a.y<0&&(b.mouseYSign=-b.mouseYSign)),e(a.x)>f?a.x<0?a.x+=f:a.x-=f:a.x=0,e(a.y)>f?a.y<0?a.y+=f:a.y-=f:a.y=0},_rotateObject:function(a,b){var e,f=this._currentTransform,g=f.target,e=g.translateToOriginPoint(g.getCenterPoint(),f.originX,f.originY);if(g.lockRotation)return!1;var h=d(f.ey-e.y,f.ex-e.x),i=d(b-e.y,a-e.x),j=c(i-h+f.theta),k=!0;if(g.snapAngle>0){var l=g.snapAngle,m=g.snapThreshold||l,n=Math.ceil(j/l)*l,o=Math.floor(j/l)*l;Math.abs(j-o)<m?j=o:Math.abs(j-n)<m&&(j=n)}return 0>j&&(j=360+j),j%=360,g.angle===j?k=!1:(g.angle=j,g.setPositionByOrigin(e,f.originX,f.originY)),k},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_drawSelection:function(a){var b=this._groupSelector,c=b.left,d=b.top,h=e(c),i=e(d);if(this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),h,i)),this.selectionLineWidth&&this.selectionBorderColor)if(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!f){var j=b.ex+g-(c>0?0:h),k=b.ey+g-(d>0?0:i);a.beginPath(),fabric.util.drawDashedLine(a,j,k,j+h,k,this.selectionDashArray),fabric.util.drawDashedLine(a,j,k+i-1,j+h,k+i-1,this.selectionDashArray),fabric.util.drawDashedLine(a,j,k,j,k+i,this.selectionDashArray),fabric.util.drawDashedLine(a,j+h-1,k,j+h-1,k+i,this.selectionDashArray),a.closePath(),a.stroke()}else fabric.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(b.ex+g-(c>0?0:h),b.ey+g-(d>0?0:i),h,i)},findTarget:function(a,b){if(!this.skipTargetFind){var c,d,e=!0,f=this.getPointer(a,e),g=this._activeObject,h=this.getActiveObjects();if(this.targets=[],h.length>1&&!b&&g===this._searchPossibleTargets([g],f))return g;if(1===h.length&&g._findTargetCorner(f))return g;if(1===h.length&&g===this._searchPossibleTargets([g],f)){if(!this.preserveObjectStacking)return g;c=g,d=this.targets,this.targets=[]}var i=this._searchPossibleTargets(this._objects,f);return a[this.altSelectionKey]&&i&&c&&i!==c&&(i=c,this.targets=d),i}},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(null,b,a)){if(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing)return!0;var d=this.isTargetTransparent(b,c.x,c.y);if(!d)return!0}},_searchPossibleTargets:function(a,b){for(var c,d,e=a.length;e--;){var f=a[e];if(this._checkTarget(f.group&&"activeSelection"!==f.group.type?this._normalizePointer(f.group,b):b,f,b)){c=a[e],c.subTargetCheck&&c instanceof fabric.Group&&(d=this._searchPossibleTargets(c._objects,b),d&&this.targets.push(d));break}}return c},restorePointerVpt:function(a){return fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(b,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var d,e=a(b),f=this.upperCanvasEl,g=f.getBoundingClientRect(),h=g.width||0,i=g.height||0;return h&&i||("top"in g&&"bottom"in g&&(i=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(h=Math.abs(g.right-g.left))),this.calcOffset(),e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,c||(e=this.restorePointerVpt(e)),d=0===h||0===i?{width:1,height:1}:{width:f.width/h,height:f.height/i},{x:e.x*d.width,y:e.y*d.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.width||a.width,c=this.height||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"}),a.width=b,a.height=c,fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?"activeSelection"===a.type&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),this._hoveredTarget===a&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,b){var c=!1,d=this.getActiveObjects(),e=[],f=[],g={e:b};a.forEach(function(a){-1===d.indexOf(a)&&(c=!0,a.fire("deselected",g),f.push(a))}),d.forEach(function(b){-1===a.indexOf(b)&&(c=!0,b.fire("selected",g),e.push(b))}),a.length>0&&d.length>0?(g.selected=e,g.deselected=f,g.updated=e[0]||f[0],g.target=this._activeObject,c&&this.fire("selection:updated",g)):d.length>0?(1===d.length&&(g.target=e[0],this.fire("object:selected",g)),g.selected=e,g.target=this._activeObject,this.fire("selection:created",g)):a.length>0&&(g.deselected=f,this.fire("selection:cleared",g))},setActiveObject:function(a,b){var c=this.getActiveObjects();return this._setActiveObject(a,b),this._fireSelectionEvents(c,b),this},_setActiveObject:function(a,b){return this._activeObject!==a&&(!!this._discardActiveObject(b,a)&&(!a.onSelect({e:b})&&(this._activeObject=a,!0)))},_discardActiveObject:function(a,b){var c=this._activeObject;if(c){if(c.onDeselect({e:a,object:b}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var b=this.getActiveObjects();return b.length&&this.fire("before:selection:cleared",{target:b[0],e:a}),this._discardActiveObject(a),this._fireSelectionEvents(b,a),this},dispose:function(){var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(a){fabric.util.cleanUpJsdomNode(this[a]),this[a]=void 0}.bind(this)),a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var b=this._activeObject;b&&b._renderControls(a)},_toObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(a),e=this.callSuper("_toObject",a,b,c);return this._unwindGroupTransformOnObject(a,d),e},_realizeGroupTransformOnObject:function(a){if(a.group&&"activeSelection"===a.group.type&&this._activeObject===a.group){var b=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return b.forEach(function(b){c[b]=a[b]}),this._activeObject.realizeTransform(a),c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},_setSVGObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(b);this.callSuper("_setSVGObject",a,b,c),this._unwindGroupTransformOnObject(b,d)},setViewportTransform:function(a){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,a)}});for(var h in fabric.StaticCanvas)"prototype"!==h&&(fabric.Canvas[h]=fabric.StaticCanvas[h]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}(),!function(){function a(a,b){return"which"in a?a.which===b:a.button===b-1}var b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,d=fabric.util.removeListener,e=3,f=2,g=1,h={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(c,"add")},addOrRemove:function(a,b){a(fabric.window,"resize",this._onResize),a(this.upperCanvasEl,"mousedown",this._onMouseDown),a(this.upperCanvasEl,"mousemove",this._onMouseMove,h),a(this.upperCanvasEl,"mouseout",this._onMouseOut),a(this.upperCanvasEl,"mouseenter",this._onMouseEnter),a(this.upperCanvasEl,"wheel",this._onMouseWheel),a(this.upperCanvasEl,"contextmenu",this._onContextMenu),a(this.upperCanvasEl,"dblclick",this._onDoubleClick),a(this.upperCanvasEl,"touchstart",this._onMouseDown,h),a(this.upperCanvasEl,"touchmove",this._onMouseMove,h),a(this.upperCanvasEl,"dragover",this._onDragOver),a(this.upperCanvasEl,"dragenter",this._onDragEnter),a(this.upperCanvasEl,"dragleave",this._onDragLeave),a(this.upperCanvasEl,"drop",this._onDrop),"undefined"!=typeof eventjs&&b in eventjs&&(eventjs[b](this.upperCanvasEl,"gesture",this._onGesture),eventjs[b](this.upperCanvasEl,"drag",this._onDrag),eventjs[b](this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs[b](this.upperCanvasEl,"shake",this._onShake),eventjs[b](this.upperCanvasEl,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(d,"remove"),d(fabric.document,"mouseup",this._onMouseUp),d(fabric.document,"touchend",this._onMouseUp,h),d(fabric.document,"mousemove",this._onMouseMove,h),d(fabric.document,"touchmove",this._onMouseMove,h)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var b=this._hoveredTarget;this.fire("mouse:out",{target:b,e:a}),this._hoveredTarget=null,b&&b.fire("mouseout",{e:a}),this._iTextInstances&&this._iTextInstances.forEach(function(a){a.isEditing&&a.hiddenTextarea.focus()})},_onMouseEnter:function(a){this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onDragOver:function(a){a.preventDefault();var b=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(b,a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData(),c(fabric.document,"touchend",this._onMouseUp,h),c(fabric.document,"touchmove",this._onMouseMove,h),d(this.upperCanvasEl,"mousemove",this._onMouseMove,h),d(this.upperCanvasEl,"touchmove",this._onMouseMove,h),"touchstart"===a.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove,h))},_onMouseUp:function(a){if(this.__onMouseUp(a),this._resetTransformEventData(),d(fabric.document,"mouseup",this._onMouseUp),d(fabric.document,"touchend",this._onMouseUp,h),d(fabric.document,"mousemove",this._onMouseMove,h),d(fabric.document,"touchmove",this._onMouseMove,h),c(this.upperCanvasEl,"mousemove",this._onMouseMove,h),c(this.upperCanvasEl,"touchmove",this._onMouseMove,h),"touchend"===a.type){var b=this;setTimeout(function(){c(b.upperCanvasEl,"mousedown",b._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var b=this._activeObject;return!!(!!b!=!!a||b&&a&&b!==a)||(b&&b.isEditing,!1)},__onMouseUp:function(b){var c,d=this._currentTransform,h=this._groupSelector,i=!1,j=!h||0===h.left&&0===h.top;return this._cacheTransformEventData(b),c=this._target,this._handleEvent(b,"up:before"),a(b,e)?void(this.fireRightClick&&this._handleEvent(b,"up",e,j)):a(b,f)?(this.fireMiddleClick&&this._handleEvent(b,"up",f,j),void this._resetTransformEventData()):this.isDrawingMode&&this._isCurrentlyDrawing?void this._onMouseUpInDrawingMode(b):(d&&(this._finalizeCurrentTransform(b),i=d.actionPerformed),j||(this._maybeGroupObjects(b),i||(i=this._shouldRender(c))),c&&(c.isMoving=!1),this._setCursorFromEvent(b,c),this._handleEvent(b,"up",g,j),this._groupSelector=null,this._currentTransform=null,c&&(c.__corner=0),void(i?this.requestRenderAll():j||this.renderTop()))},_simpleEventHandler:function(a,b){var c=this.findTarget(b),d=this.targets,e={e:b,target:c,subTargets:d};if(this.fire(a,e),c&&c.fire(a,e),!d)return c;for(var f=0;f<d.length;f++)d[f].fire(a,e);return c},_handleEvent:function(a,b,c,d){var e=this._target,f=this.targets||[],h={e:a,target:e,subTargets:f,button:c||g,isClick:d||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+b,h),e&&e.fire("mouse"+b,h);for(var i=0;i<f.length;i++)f[i].fire("mouse"+b,h)},_finalizeCurrentTransform:function(a){var b,c=this._currentTransform,d=c.target,e={e:a,target:d,transform:c};d._scaling&&(d._scaling=!1),d.setCoords(),(c.actionPerformed||this.stateful&&d.hasStateChanged())&&(c.actionPerformed&&(b=this._addEventOptions(e,c),this._fire(b,e)),this._fire("modified",e))},_addEventOptions:function(a,b){var c,d;switch(b.action){case"scaleX":c="scaled",d="x";break;case"scaleY":c="scaled",d="y";break;case"skewX":c="skewed",d="x";break;case"skewY":c="skewed",d="y";break;case"scale":c="scaled",d="equally";break;case"rotate":c="rotated";break;case"drag":c="moved"}return a.by=d,c},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=this.getPointer(a);this.freeDrawingBrush.onMouseDown(b),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(a,"up")},__onMouseDown:function(b){this._cacheTransformEventData(b),this._handleEvent(b,"down:before");var c=this._target;if(a(b,e))return void(this.fireRightClick&&this._handleEvent(b,"down",e));if(a(b,f))return void(this.fireMiddleClick&&this._handleEvent(b,"down",f));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(b);if(!this._currentTransform){var d=this._pointer;this._previousPointer=d;var g=this._shouldRender(c),h=this._shouldGroup(b,c);this._shouldClearSelection(b,c)?this.discardActiveObject(b):h&&(this._handleGrouping(b,c),c=this._activeObject),!this.selection||c&&(c.selectable||c.isEditing||c===this._activeObject)||(this._groupSelector={ex:d.x,ey:d.y,top:0,left:0}),c&&(c.selectable&&this.setActiveObject(c,b),c!==this._activeObject||!c.__corner&&h||this._setupCurrentTransform(b,c)),this._handleEvent(b,"down"),(g||h)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var b=this._currentTransform;this.stateful&&b.target.saveState(),this.fire("before:transform",{e:a,transform:b}),b.corner&&this.onBeforeScaleRotate(b.target)},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!("undefined"!=typeof a.touches&&a.touches.length>1)){var d=this._groupSelector;d?(c=this._pointer,d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a)||null,this._setCursorFromEvent(a,b),this._fireOverOutEvents(b,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,b){this.fireSynteticInOutEvents(a,b,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(a,b){this.fireSynteticInOutEvents(a,b,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(a,b,c){var d,e,f,g,h=this[c.targetName],i=h!==a,j=c.canvasEvtIn,k=c.canvasEvtOut;i&&(d={e:b,target:a,previousTarget:h},e={e:b,target:h,nextTarget:a},this[c.targetName]=a),g=a&&i,f=h&&i,f&&(k&&this.fire(k,e),h.fire(c.evtOut,e)),g&&(j&&this.fire(j,d),a.fire(c.evtIn,d))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,c.shiftKey=a.shiftKey,c.altKey=a[this.centeredKey],this._beforeScaleTransform(a,c),this._performTransformAction(a,c,b),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y,f=b.action,g=!1,h={target:b.target,e:a,transform:b,pointer:c};"rotate"===f?(g=this._rotateObject(d,e))&&this._fire("rotating",h):"scale"===f?(g=this._onScale(a,b,d,e))&&this._fire("scaling",h):"scaleX"===f?(g=this._scaleObject(d,e,"x"))&&this._fire("scaling",h):"scaleY"===f?(g=this._scaleObject(d,e,"y"))&&this._fire("scaling",h):"skewX"===f?(g=this._skewObject(d,e,"x"))&&this._fire("skewing",h):"skewY"===f?(g=this._skewObject(d,e,"y"))&&this._fire("skewing",h):(g=this._translateObject(d,e),g&&(this._fire("moving",h),this.setCursor(h.target.moveCursor||this.moveCursor))),b.actionPerformed=b.actionPerformed||g},_fire:function(a,b){this.fire("object:"+a,b),b.target.fire(a,b)},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(),b.reset=!0)}},_onScale:function(a,b,c,d){return this._isUniscalePossible(a,b.target)?(b.currentAction="scale",this._scaleObject(c,d)):(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally"))},_isUniscalePossible:function(a,b){return(a[this.uniScaleKey]||this.uniScaleTransform)&&!b.get("lockUniScaling")},_setCursorFromEvent:function(a,b){if(!b)return this.setCursor(this.defaultCursor),!1;var c=b.hoverCursor||this.hoverCursor,d=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,e=(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));this.setCursor(e?this.getCornerCursor(e,b,a):c)},getCornerCursor:function(a,c,d){return this.actionIsDisabled(a,c,d)?this.notAllowedCursor:a in b?this._getRotatedCornerCursor(a,c,d):"mtr"===a&&c.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(a,b,c){return"mt"===a||"mb"===a?c[this.altActionKey]?b.lockSkewingX:b.lockScalingY:"ml"===a||"mr"===a?c[this.altActionKey]?b.lockSkewingY:b.lockScalingX:"mtr"===a?b.lockRotation:this._isUniscalePossible(c,b)?b.lockScalingX&&b.lockScalingY:b.lockScalingX||b.lockScalingY},_getRotatedCornerCursor:function(a,c,d){var e=Math.round(c.angle%360/45);return 0>e&&(e+=8),e+=b[a],d[this.altActionKey]&&b[a]%2===0&&(e+=2),e%=8,this.cursorMap[e]}})}(),!function(){var a=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var c=this._activeObject;return c&&this._isSelectionKeyPressed(a)&&b&&b.selectable&&this.selection&&(c!==b||"activeSelection"===c.type)},_handleGrouping:function(a,b){var c=this._activeObject;c.__corner||(b!==c||(b=this.findTarget(a,!0)))&&(c&&"activeSelection"===c.type?this._updateActiveSelection(b,a):this._createActiveSelection(b,a))},_updateActiveSelection:function(a,b){var c=this._activeObject,d=c._objects.slice(0);c.contains(a)?(c.removeWithUpdate(a),this._hoveredTarget=a,1===c.size()&&this._setActiveObject(c.item(0),b)):(c.addWithUpdate(a),this._hoveredTarget=c),this._fireSelectionEvents(d,b)},_createActiveSelection:function(a,b){var c=this.getActiveObjects(),d=this._createGroup(a);this._hoveredTarget=d,this._setActiveObject(d,b),this._fireSelectionEvents(c,b)},_createGroup:function(a){var b=this._objects,c=b.indexOf(this._activeObject)<b.indexOf(a),d=c?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(d,{canvas:this})},_groupSelectedObjects:function(a){var b,c=this._collectObjects();1===c.length?this.setActiveObject(c[0],a):c.length>1&&(b=new fabric.ActiveSelection(c.reverse(),{canvas:this}),this.setActiveObject(b,a))},_collectObjects:function(){for(var c,d=[],e=this._groupSelector.ex,f=this._groupSelector.ey,g=e+this._groupSelector.left,h=f+this._groupSelector.top,i=new fabric.Point(a(e,g),a(f,h)),j=new fabric.Point(b(e,g),b(f,h)),k=!this.selectionFullyContained,l=e===g&&f===h,m=this._objects.length;m--&&(c=this._objects[m],!(c&&c.selectable&&c.visible&&(k&&c.intersectsWithRect(i,j)||c.isContainedWithinRect(i,j)||k&&c.containsPoint(i)||k&&c.containsPoint(j))&&(d.push(c),l))););return d},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),!function(){var a=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=(a.multiplier||1)*(a.enableRetinaScaling?1:1/this.getRetinaScaling()),e={left:a.left||0,top:a.top||0,width:a.width||0,height:a.height||0};return this.__toDataURLWithMultiplier(b,c,e,d)},__toDataURLWithMultiplier:function(a,b,c,d){var e=this.width,f=this.height,g=(c.width||this.width)*d,h=(c.height||this.height)*d,i=this.getZoom(),j=i*d,k=this.viewportTransform,l=(k[4]-c.left)*d,m=(k[5]-c.top)*d,n=[j,0,0,j,l,m],o=this.interactive,p=this.skipOffscreen,q=e!==g||f!==h;this.viewportTransform=n,this.skipOffscreen=!1,this.interactive=!1,q&&this.setDimensions({width:g,height:h},{backstoreOnly:!0}),this.renderAll();var r=this.__toDataURL(a,b,c);return this.interactive=o,this.skipOffscreen=p,this.viewportTransform=k,q&&this.setDimensions({width:e,height:f},{backstoreOnly:!0}),this.renderAll(),r},__toDataURL:function(b,c){var d=this.contextContainer.canvas,e=a?d.toDataURL("image/"+b,c):d.toDataURL("image/"+b);return e}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,c){return this.loadFromJSON(a,b,c)},loadFromJSON:function(a,b,c){if(a){var d="string"==typeof a?JSON.parse(a):fabric.util.object.clone(a),e=this,f=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(d.objects,function(a){e.clear(),e._setBgOverlay(d,function(){a.forEach(function(a,b){e.insertAt(a,b)}),e.renderOnAddRemove=f,delete d.objects,delete d.backgroundImage,delete d.overlayImage,delete d.background,delete d.overlay,e._setOptions(d),e.renderAll(),b&&b()})},c),this}},_setBgOverlay:function(a,b){var c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(a.backgroundImage||a.overlayImage||a.background||a.overlay))return void(b&&b());var d=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&b&&b()};this.__setBgOverlay("backgroundImage",a.backgroundImage,c,d),this.__setBgOverlay("overlayImage",a.overlayImage,c,d),this.__setBgOverlay("backgroundColor",a.background,c,d),this.__setBgOverlay("overlayColor",a.overlay,c,d)},__setBgOverlay:function(a,b,c,d){var e=this;return b?void("backgroundImage"===a||"overlayImage"===a?fabric.util.enlivenObjects([b],function(b){e[a]=b[0],c[a]=!0,d&&d()}):this["set"+fabric.util.string.capitalize(a,!0)](b,function(){c[a]=!0,d&&d()})):(c[a]=!0,void(d&&d()))},_enlivenObjects:function(a,b,c){return a&&0!==a.length?void fabric.util.enlivenObjects(a,function(a){b&&b(a)},null,c):void(b&&b([]))},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=fabric.util.createCanvasElement();b.width=this.width,b.height=this.height;var c=new fabric.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed,f=b.util.string.capitalize,g=b.util.degreesToRadians,h=b.StaticCanvas.supports("setLineDash"),i=!b.isLikelyNode,j=2;b.Object||(b.Object=b.util.createClass(b.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:i,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),
clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(a){a&&this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=b.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(a){var c=b.perfLimitSizeTotal,d=a.width,e=a.height,f=b.maxCacheSideLimit,g=b.minCacheSideLimit;if(f>=d&&f>=e&&c>=d*e)return g>d&&(a.width=g),g>e&&(a.height=g),a;var h=d/e,i=b.util.limitDimsByArea(h,c),j=b.util.capValue,k=j(g,i.x,f),l=j(g,i.y,f);return d>k&&(a.zoomX/=d/k,a.width=k,a.capped=!0),e>l&&(a.zoomY/=e/l,a.height=l,a.capped=!0),a},_getCacheCanvasDimensions:function(){var a=this.getTotalObjectScaling(),b=this._getNonTransformedDimensions(),c=a.scaleX,d=a.scaleY,e=b.x*c,f=b.y*d;return{width:e+j,height:f+j,zoomX:c,zoomY:d,x:b.x,y:b.y}},_updateCacheCanvas:function(){var a=this.canvas;if(this.noScaleCache&&a&&a._currentTransform){var c=a._currentTransform.target,d=a._currentTransform.action;if(this===c&&d.slice&&"scale"===d.slice(0,5))return!1}var e,f,g=this._cacheCanvas,h=this._limitCacheSize(this._getCacheCanvasDimensions()),i=b.minCacheSideLimit,j=h.width,k=h.height,l=h.zoomX,m=h.zoomY,n=j!==this.cacheWidth||k!==this.cacheHeight,o=this.zoomX!==l||this.zoomY!==m,p=n||o,q=0,r=0,s=!1;if(n){var t=this._cacheCanvas.width,u=this._cacheCanvas.height,v=j>t||k>u,w=(.9*t>j||.9*u>k)&&t>i&&u>i;s=v||w,v&&!h.capped&&(j>i||k>i)&&(q=.1*j,r=.1*k)}return!!p&&(s?(g.width=Math.ceil(j+q),g.height=Math.ceil(k+r)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,g.width,g.height)),e=h.x*l/2,f=h.y*m/2,this.cacheTranslationX=Math.round(g.width/2-e)+e,this.cacheTranslationY=Math.round(g.height/2-f)+f,this.cacheWidth=j,this.cacheHeight=k,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(l,m),this.zoomX=l,this.zoomY=m,!0)},setOptions:function(a){this._setOptions(a),this._initGradient(a.fill,"fill"),this._initGradient(a.stroke,"stroke"),this._initClipping(a),this._initPattern(a.fill,"fill"),this._initPattern(a.stroke,"stroke")},transform:function(a){var b;b=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5])},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,d={type:this.type,version:b.version,originX:this.originX,originY:this.originY,left:e(this.left,c),top:e(this.top,c),width:e(this.width,c),height:e(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:e(this.strokeMiterLimit,c),scaleX:e(this.scaleX,c),scaleY:e(this.scaleY,c),angle:e(this.angle,c),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:e(this.skewX,c),skewY:e(this.skewY,c)};return this.clipPath&&(d.clipPath=this.clipPath.toObject(a),d.clipPath.inverted=this.clipPath.inverted,d.clipPath.absolutePositioned=this.clipPath.absolutePositioned),b.util.populateWithProperties(this,d,a),this.includeDefaultValues||(d=this._removeDefaultValues(d)),d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype,d=c.stateProperties;return d.forEach(function(b){a[b]===c[b]&&delete a[b];var d="[object Array]"===Object.prototype.toString.call(a[b])&&"[object Array]"===Object.prototype.toString.call(c[b]);d&&0===a[b].length&&0===c[b].length&&delete a[b]}),a},toString:function(){return"#<fabric."+f(this.type)+">"},getObjectScaling:function(){var a=this.scaleX,b=this.scaleY;if(this.group){var c=this.group.getObjectScaling();a*=c.scaleX,b*=c.scaleY}return{scaleX:a,scaleY:b}},getTotalObjectScaling:function(){var a=this.getObjectScaling(),b=a.scaleX,c=a.scaleY;if(this.canvas){var d=this.canvas.getZoom(),e=this.canvas.getRetinaScaling();b*=d*e,c*=d*e}return{scaleX:b,scaleY:c}},getObjectOpacity:function(){var a=this.opacity;return this.group&&(a*=this.group.getObjectOpacity()),a},_set:function(a,c){var d="scaleX"===a||"scaleY"===a,e=this[a]!==c,f=!1;return d&&(c=this._constrainScale(c)),"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"shadow"!==a||!c||c instanceof b.Shadow?"dirty"===a&&this.group&&this.group.set("dirty",c):c=new b.Shadow(c),this[a]=c,e&&(f=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(a)>-1?(this.dirty=!0,f&&this.group.set("dirty",!0)):f&&this.stateProperties.indexOf(a)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:b.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(a){this.isNotVisible()||(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),this.transform(a),this._setOpacity(a),this._setShadow(a,this),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.clipTo&&b.util.clipContext(this,a),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(a),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&a.restore(),a.restore())},renderCache:function(a){a=a||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,a.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(a){var c=this.clipPath;if(a.save(),a.globalCompositeOperation=c.inverted?"destination-out":"destination-in",c.absolutePositioned){var d=b.util.invertTransform(this.calcTransformMatrix());a.transform(d[0],d[1],d[2],d[3],d[4],d[5])}c.transform(a),a.scale(1/c.zoomX,1/c.zoomY),a.drawImage(c._cacheCanvas,-c.cacheTranslationX,-c.cacheTranslationY),a.restore()},drawObject:function(a,b){b?this._setClippingProperties(a):(this._renderBackground(a),this._setStrokeStyles(a,this),this._setFillStyles(a,this)),this._render(a),this._drawClipPath(a)},_drawClipPath:function(a){var b=this.clipPath;b&&(b.canvas=this.canvas,b.shouldCache(),b._transformDone=!0,b.renderCache({forClipping:!0}),this.drawClipPathOnCache(a))},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(a){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!a){var b=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-b/2,-c/2,b,c)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-b.x/2,-b.y/2,b.x,b.y),this._removeShadow(a)}},_setOpacity:function(a){this.group&&!this.group._transformDone?a.globalAlpha=this.getObjectOpacity():a.globalAlpha*=this.opacity},_setStrokeStyles:function(a,b){b.stroke&&(a.lineWidth=b.strokeWidth,a.lineCap=b.strokeLineCap,a.lineJoin=b.strokeLineJoin,a.miterLimit=b.strokeMiterLimit,a.strokeStyle=b.stroke.toLive?b.stroke.toLive(a,this):b.stroke)},_setFillStyles:function(a,b){b.fill&&(a.fillStyle=b.fill.toLive?b.fill.toLive(a,this):b.fill)},_setClippingProperties:function(a){a.globalAlpha=1,a.strokeStyle="transparent",a.fillStyle="#000000"},_setLineDash:function(a,b,c){b&&(1&b.length&&b.push.apply(b,b),h?a.setLineDash(b):c&&c(a))},_renderControls:function(a,c){var d,e,f,h=this.getViewportTransform(),i=this.calcTransformMatrix();c=c||{},e="undefined"!=typeof c.hasBorders?c.hasBorders:this.hasBorders,f="undefined"!=typeof c.hasControls?c.hasControls:this.hasControls,i=b.util.multiplyTransformMatrices(h,i),d=b.util.qrDecompose(i),a.save(),a.translate(d.translateX,d.translateY),a.lineWidth=1*this.borderScaleFactor,this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),c.forActiveSelection?(a.rotate(g(d.angle)),e&&this.drawBordersInGroup(a,d,c)):(a.rotate(g(this.angle)),e&&this.drawBorders(a,c)),f&&this.drawControls(a,c),a.restore()},_setShadow:function(a){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,d=this.canvas&&this.canvas.viewportTransform[3]||1,e=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(c*=b.devicePixelRatio,d*=b.devicePixelRatio),a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*b.browserShadowBlurConstant*(c+d)*(e.scaleX+e.scaleY)/4,a.shadowOffsetX=this.shadow.offsetX*c*e.scaleX,a.shadowOffsetY=this.shadow.offsetY*d*e.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,b){if(!b||!b.toLive)return{offsetX:0,offsetY:0};var c=b.gradientTransform||b.patternTransform,d=-this.width/2+b.offsetX||0,e=-this.height/2+b.offsetY||0;return a.translate(d,e),c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),{offsetX:d,offsetY:e}},_renderPaintInOrder:function(a){"stroke"===this.paintFirst?(this._renderStroke(a),this._renderFill(a)):(this._renderFill(a),this._renderStroke(a))},_renderFill:function(a){this.fill&&(a.save(),this._applyPatternGradientTransform(a,this.fill),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(a,this.stroke),a.stroke(),a.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var a=b.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",a.scaleX),this.set("scaleY",a.scaleY),this.angle=a.angle,this.skewX=a.skewX,this.skewY=0}},_removeTransformMatrix:function(a){var c=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),c=b.util.transformPoint(c,this.transformMatrix)),this.transformMatrix=null,a&&(this.scaleX*=a.scaleX,this.scaleY*=a.scaleY,this.cropX=a.cropX,this.cropY=a.cropY,c.x+=a.offsetLeft,c.y+=a.offsetTop,this.width=a.width,this.height=a.height),this.setPositionByOrigin(c,"center","center")},clone:function(a,c){var d=this.toObject(c);this.constructor.fromObject?this.constructor.fromObject(d,a):b.Object._fromObject("Object",d,a)},cloneAsImage:function(a,c){var d=this.toDataURL(c);return b.util.loadImage(d,function(c){a&&a(new b.Image(c))}),this},toDataURL:function(a){a||(a={});var c=b.util,d=c.saveObjectTransform(this),e=this.shadow,f=Math.abs;a.withoutTransform&&c.resetObjectTransform(this),a.withoutShadow&&(this.shadow=null);var g,h,i=b.util.createCanvasElement(),j=this.getBoundingRect(!0,!0),k=this.shadow,l={x:0,y:0};k&&(h=k.blur,g=this.getObjectScaling(),l.x=2*Math.round((f(k.offsetX)+h)*f(g.scaleX)),l.y=2*Math.round((f(k.offsetY)+h)*f(g.scaleY))),i.width=j.width+l.x,i.height=j.height+l.y,i.width+=i.width%2?2-i.width%2:0,i.height+=i.height%2?2-i.height%2:0;var m=new b.StaticCanvas(i,{enableRetinaScaling:a.enableRetinaScaling,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===a.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new b.Point(m.width/2,m.height/2),"center","center");var n=this.canvas;m.add(this);var o=m.toDataURL(a);return this.shadow=e,this.set(d).setCoords(),this.canvas=n,m._objects=[],m.dispose(),m=null,o},isType:function(a){return this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};return d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2),d.gradientTransform=c.gradientTransform,b.Gradient.prototype.addColorStop.call(d,c.colorStops),this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a,c){return this.set("fill",new b.Pattern(a,c))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},rotate:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);var d=new b.Point(c.x,c.y),e=this._getLeftTopCoords();return this.angle&&(d=b.util.rotatePoint(d,e,g(-this.angle))),{x:d.x-e.x,y:d.y-e.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),b.util.createAccessors&&b.util.createAccessors(b.Object),c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object._fromObject=function(a,c,e,f){var g=b[a];c=d(c,!0),b.util.enlivenPatterns([c.fill,c.stroke],function(a){"undefined"!=typeof a[0]&&(c.fill=a[0]),"undefined"!=typeof a[1]&&(c.stroke=a[1]),b.util.enlivenObjects([c.clipPath],function(a){c.clipPath=a[0];var b=f?new g(c[f],c):new g(c);e&&e(b)})})},b.Object.__uid=0)}("undefined"!=typeof exports?exports:this),!function(){var a=fabric.util.degreesToRadians,b={left:-.5,center:0,right:.5},c={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(a,d,e,f,g){var h,i,j,k=a.x,l=a.y;return"string"==typeof d?d=b[d]:d-=.5,"string"==typeof f?f=b[f]:f-=.5,h=f-d,"string"==typeof e?e=c[e]:e-=.5,"string"==typeof g?g=c[g]:g-=.5,i=g-e,(h||i)&&(j=this._getTransformedDimensions(),k=a.x+h*j.x,l=a.y+i*j.y),new fabric.Point(k,l)},translateToCenterPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,c,d,"center","center");return this.angle?fabric.util.rotatePoint(e,b,a(this.angle)):e},translateToOriginPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,"center","center",c,d);return this.angle?fabric.util.rotatePoint(e,b,a(this.angle)):e},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(b,c,d){var e,f,g=this.getCenterPoint();return e="undefined"!=typeof c&&"undefined"!=typeof d?this.translateToGivenOrigin(g,"center","center",c,d):new fabric.Point(this.left,this.top),f=new fabric.Point(b.x,b.y),this.angle&&(f=fabric.util.rotatePoint(f,g,-a(this.angle))),f.subtractEquals(e)},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(c){var d,e,f=a(this.angle),g=this.getScaledWidth(),h=fabric.util.cos(f)*g,i=fabric.util.sin(f)*g;d="string"==typeof this.originX?b[this.originX]:this.originX-.5,e="string"==typeof c?b[c]:c-.5,this.left+=h*(e-d),this.top+=i*(e-d),this.setCoords(),this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),!function(){function a(a){return[new fabric.Point(a.tl.x,a.tl.y),new fabric.Point(a.tr.x,a.tr.y),new fabric.Point(a.br.x,a.br.y),new fabric.Point(a.bl.x,a.bl.y)]}var b=fabric.util.degreesToRadians,c=fabric.util.multiplyTransformMatrices,d=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(b,c){this.oCoords||this.setCoords();var d=b?this.aCoords:this.oCoords;return a(c?this.calcCoords(b):d)},intersectsWithRect:function(a,b,c,d){var e=this.getCoords(c,d),f=fabric.Intersection.intersectPolygonRectangle(e,a,b);return"Intersection"===f.status},intersectsWithObject:function(a,b,c){var d=fabric.Intersection.intersectPolygonPolygon(this.getCoords(b,c),a.getCoords(b,c));return"Intersection"===d.status||a.isContainedWithinObject(this,b,c)||this.isContainedWithinObject(a,b,c)},isContainedWithinObject:function(a,b,c){for(var d=this.getCoords(b,c),e=0,f=a._getImageLines(c?a.calcCoords(b):b?a.aCoords:a.oCoords);4>e;e++)if(!a.containsPoint(d[e],f))return!1;return!0},isContainedWithinRect:function(a,b,c,d){var e=this.getBoundingRect(c,d);return e.left>=a.x&&e.left+e.width<=b.x&&e.top>=a.y&&e.top+e.height<=b.y},containsPoint:function(a,b,c,d){var b=b||this._getImageLines(d?this.calcCoords(c):c?this.aCoords:this.oCoords),e=this._findCrossPoints(a,b);return 0!==e&&e%2===1},isOnScreen:function(a){if(!this.canvas)return!1;for(var b,c=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br,e=this.getCoords(!0,a),f=0;4>f;f++)if(b=e[f],b.x<=d.x&&b.x>=c.x&&b.y<=d.y&&b.y>=c.y)return!0;return!!this.intersectsWithRect(c,d,!0,a)||this._containsCenterOfCanvas(c,d,a)},_containsCenterOfCanvas:function(a,b,c){var d={x:(a.x+b.x)/2,y:(a.y+b.y)/2};return!!this.containsPoint(d,null,!0,c)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var b=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.intersectsWithRect(b,c,!0,a)||this._containsCenterOfCanvas(b,c,a)},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,e,f,g,h,i=0;for(var j in b)if(h=b[j],!(h.o.y<a.y&&h.d.y<a.y||h.o.y>=a.y&&h.d.y>=a.y||(h.o.x===h.d.x&&h.o.x>=a.x?g=h.o.x:(c=0,d=(h.d.y-h.o.y)/(h.d.x-h.o.x),e=a.y-c*a.x,f=h.o.y-d*h.o.x,g=-(e-f)/(c-d)),g>=a.x&&(i+=1),2!==i)))break;return i},getBoundingRect:function(a,b){var c=this.getCoords(a,b);return fabric.util.makeBoundingBoxFromPoints(c)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:0===a?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,b){var c=this.getBoundingRect(b).width/this.getScaledWidth();return this.scale(a/this.width/c)},scaleToHeight:function(a,b){var c=this.getBoundingRect(b).height/this.getScaledHeight();return this.scale(a/this.height/c)},calcCoords:function(a){var e=this._calcRotateMatrix(),f=this._calcTranslateMatrix(),g=c(f,e),h=this.getViewportTransform(),i=a?g:c(h,g),j=this._getTransformedDimensions(),k=j.x/2,l=j.y/2,m=d({x:-k,y:-l},i),n=d({x:k,y:-l},i),o=d({x:-k,y:l},i),p=d({x:k,y:l},i);if(!a){var q=this.padding,r=b(this.angle),s=fabric.util.cos(r),t=fabric.util.sin(r),u=s*q,v=t*q,w=u+v,x=u-v;q&&(m.x-=x,m.y-=w,n.x+=w,n.y-=x,o.x-=w,o.y+=x,p.x+=x,p.y+=w);var y=new fabric.Point((m.x+o.x)/2,(m.y+o.y)/2),z=new fabric.Point((n.x+m.x)/2,(n.y+m.y)/2),A=new fabric.Point((p.x+n.x)/2,(p.y+n.y)/2),B=new fabric.Point((p.x+o.x)/2,(p.y+o.y)/2),C=new fabric.Point(z.x+t*this.rotatingPointOffset,z.y-s*this.rotatingPointOffset)}var D={tl:m,tr:n,br:p,bl:o};return a||(D.ml=y,D.mt=z,D.mr=A,D.mb=B,D.mtr=C),D},setCoords:function(a,b){return this.oCoords=this.calcCoords(a),b||(this.aCoords=this.calcCoords(!0)),a||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var a=b(this.angle),c=fabric.util.cos(a),d=fabric.util.sin(a);return[c,d,-d,c,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var b="_",c="";return!a&&this.group&&(c=this.group.transformMatrixKey(a)+b),c+this.top+b+this.left+b+this.scaleX+b+this.scaleY+b+this.skewX+b+this.skewY+b+this.angle+b+this.originX+b+this.originY+b+this.width+b+this.height+b+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){if(a)return this.calcOwnMatrix();var b=this.transformMatrixKey(),d=this.matrixCache||(this.matrixCache={});if(d.key===b)return d.value;var e=this.calcOwnMatrix();return this.group&&(e=c(this.group.calcTransformMatrix(),e)),d.key=b,d.value=e,e},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),b=this.ownMatrixCache||(this.ownMatrixCache={});if(b.key===a)return b.value;var d,e=this._calcTranslateMatrix(),f=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(d=this._calcRotateMatrix(),e=c(e,d)),e=c(e,f),b.key=a,b.value=e,e},_calcDimensionsTransformMatrix:function(a,d,e){var f,g=this.scaleX*(e&&this.flipX?-1:1),h=this.scaleY*(e&&this.flipY?-1:1),i=[g,0,0,h,0,0];return a&&(f=[1,0,Math.tan(b(a)),1],i=c(i,f,!0)),d&&(f=[1,Math.tan(b(d)),0,1],i=c(i,f,!0)),i},_getNonTransformedDimensions:function(){var a=this.strokeWidth,b=this.width+a,c=this.height+a;return{x:b,y:c}},_getTransformedDimensions:function(a,b){"undefined"==typeof a&&(a=this.skewX),"undefined"==typeof b&&(b=this.skewY);var c=this._getNonTransformedDimensions();if(0===a&&0===b)return{x:c.x*this.scaleX,y:c.y*this.scaleY};var d,e,f=c.x/2,g=c.y/2,h=[{x:-f,y:-g},{x:f,y:-g},{x:-f,y:g},{x:f,y:g}],i=this._calcDimensionsTransformMatrix(a,b,!1);for(d=0;d<h.length;d++)h[d]=fabric.util.transformPoint(h[d],i);return e=fabric.util.makeBoundingBoxFromPoints(h),{x:e.width,y:e.height}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),b=this._getTransformedDimensions(),c=fabric.util.transformPoint(b,a,!0);return c.scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),!function(){function a(a,b){if(b){if(b.toLive)return a+": url(#SVGID_"+b.id+"); ";var c=new fabric.Color(b),d=a+": "+c.toRgb()+"; ",e=c.getAlpha();return 1!==e&&(d+=a+"-opacity: "+e.toString()+"; "),d}return a+": none; "}var b=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(b){var c=this.fillRule?this.fillRule:"nonzero",d=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i="undefined"!=typeof this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=b?"":this.getSvgFilter(),l=a("fill",this.fill),m=a("stroke",this.stroke);return[m,"stroke-width: ",d,"; ","stroke-dasharray: ",e,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ",l,"fill-rule: ",c,"; ","opacity: ",i,";",k,j].join("")},getSvgSpanStyles:function(b,c){var d="; ",e=b.fontFamily?"font-family: "+(-1===b.fontFamily.indexOf("'")&&-1===b.fontFamily.indexOf('"')?"'"+b.fontFamily+"'":b.fontFamily)+d:"",f=b.strokeWidth?"stroke-width: "+b.strokeWidth+d:"",e=e,g=b.fontSize?"font-size: "+b.fontSize+"px"+d:"",h=b.fontStyle?"font-style: "+b.fontStyle+d:"",i=b.fontWeight?"font-weight: "+b.fontWeight+d:"",j=b.fill?a("fill",b.fill):"",k=b.stroke?a("stroke",b.stroke):"",l=this.getSvgTextDecoration(b),m=b.deltaY?"baseline-shift: "+-b.deltaY+"; ":"";return l&&(l="text-decoration: "+l+d),[k,f,e,g,h,i,l,j,m,c?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(a){return"overline"in a||"underline"in a||"linethrough"in a?(a.overline?"overline ":"")+(a.underline?"underline ":"")+(a.linethrough?"line-through ":""):""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(a,c){var d=a?this.calcTransformMatrix():this.calcOwnMatrix(),e=d.map(function(a){return b(a,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ");return'transform="matrix('+e+")"+(c||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_setSVGBg:function(a){if(this.backgroundColor){var c=fabric.Object.NUM_FRACTION_DIGITS;a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',b(-this.width/2,c),'" y="',b(-this.height/2,c),'" width="',b(this.width,c),'" height="',b(this.height,c),'"></rect>\n')}},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(),{reviver:a})},toClipPathSVG:function(a){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a})},_createBaseClipPathSVGMarkup:function(a,b){b=b||{};var c=b.reviver,d=b.additionalTransform||"",e=[this.getSvgTransform(!0,d),this.getSvgCommons()].join(""),f=a.indexOf("COMMON_PARTS");return a[f]=e,c?c(a.join("")):a.join("")},_createBaseSVGMarkup:function(a,b){b=b||{};var c,d,e=b.noStyle,f=b.withShadow,g=b.reviver,h=e?"":'style="'+this.getSvgStyles()+'" ',i=f?'style="'+this.getSvgFilter()+'" ':"",j=this.clipPath,k=this.clipPath&&this.clipPath.absolutePositioned,l=[],m=a.indexOf("COMMON_PARTS");return j&&(j.clipPathId="CLIPPATH_"+fabric.Object.__uid++,d='<clipPath id="'+j.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(g)+"</clipPath>\n"),k&&l.push("<g ",i,this.getSvgCommons()," >\n"),l.push("<g ",this.getSvgTransform(!1),k?"":i+this.getSvgCommons()," >\n"),c=[h,e?"":this.addPaintOrder()," "].join(""),a[m]=c,this.fill&&this.fill.toLive&&l.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&l.push(this.stroke.toSVG(this,!1)),this.shadow&&l.push(this.shadow.toSVG(this)),j&&l.push(d),l.push(a.join("")),l.push("</g>\n"),k&&l.push("</g>\n"),g?g(l.join("")):l.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),!function(){function a(a,b,d){var e={},f=!0;d.forEach(function(b){e[b]=a[b]}),c(a[b],e,f)}function b(a,c,d){if(a===c)return!0;if(Array.isArray(a)){if(!Array.isArray(c)||a.length!==c.length)return!1;for(var e=0,f=a.length;f>e;e++)if(!b(a[e],c[e]))return!1;return!0}if(a&&"object"==typeof a){var g,h=Object.keys(a);if(!c||"object"!=typeof c||!d&&h.length!==Object.keys(c).length)return!1;for(var e=0,f=h.length;f>e;e++)if(g=h[e],!b(a[g],c[g]))return!1;return!0}}var c=fabric.util.object.extend,d="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(a){a=a||d;var c="_"+a;return Object.keys(this[c]).length<this[a].length||!b(this[c],this,!0)},saveState:function(b){var c=b&&b.propertySet||d,e="_"+c;return this[e]?(a(this,e,this[c]),b&&b.stateProperties&&a(this,e,b.stateProperties),this):this.setupState(b)},setupState:function(a){a=a||{};var b=a.propertySet||d;return a.propertySet=b,this["_"+b]={},this.saveState(a),this}})}(),!function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var b,c,d=a.x,e=a.y;this.__corner=0;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(c=this._getImageLines(this.oCoords[f].corner),b=this._findCrossPoints({x:d,y:e},c),0!==b&&b%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var b,c,d=this.oCoords,e=a(45-this.angle),f=.707106*this.cornerSize,g=f*fabric.util.cos(e),h=f*fabric.util.sin(e);for(var i in d)b=d[i].x,c=d[i].y,d[i].corner={tl:{x:b-h,y:c-g},tr:{x:b+g,y:c-h},bl:{x:b-g,y:c+h},br:{x:b+h,y:c+g}}},drawSelectionBackground:function(b){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;b.save();var c=this.getCenterPoint(),d=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;return b.translate(c.x,c.y),b.scale(1/e[0],1/e[3]),b.rotate(a(this.angle)),b.fillStyle=this.selectionBackgroundColor,b.fillRect(-d.x/2,-d.y/2,d.x,d.y),b.restore(),this},drawBorders:function(a,b){b=b||{};var c=this._calculateCurrentDimensions(),d=1/this.borderScaleFactor,e=c.x+d,f=c.y+d,g="undefined"!=typeof b.hasRotatingPoint?b.hasRotatingPoint:this.hasRotatingPoint,h="undefined"!=typeof b.hasControls?b.hasControls:this.hasControls,i="undefined"!=typeof b.rotatingPointOffset?b.rotatingPointOffset:this.rotatingPointOffset;if(a.save(),a.strokeStyle=b.borderColor||this.borderColor,this._setLineDash(a,b.borderDashArray||this.borderDashArray,null),a.strokeRect(-e/2,-f/2,e,f),g&&this.isControlVisible("mtr")&&h){var j=-f/2;a.beginPath(),a.moveTo(0,j),a.lineTo(0,j-i),a.stroke()}return a.restore(),this},drawBordersInGroup:function(a,b,c){c=c||{};var d=this._getNonTransformedDimensions(),e=fabric.util.customTransformMatrix(b.scaleX,b.scaleY,b.skewX),f=fabric.util.transformPoint(d,e),g=1/this.borderScaleFactor,h=f.x+g,i=f.y+g;return a.save(),this._setLineDash(a,c.borderDashArray||this.borderDashArray,null),a.strokeStyle=c.borderColor||this.borderColor,a.strokeRect(-h/2,-i/2,h,i),a.restore(),this},drawControls:function(a,b){b=b||{};var c=this._calculateCurrentDimensions(),d=c.x,e=c.y,f=b.cornerSize||this.cornerSize,g=-(d+f)/2,h=-(e+f)/2,i="undefined"!=typeof b.transparentCorners?b.transparentCorners:this.transparentCorners,j="undefined"!=typeof b.hasRotatingPoint?b.hasRotatingPoint:this.hasRotatingPoint,k=i?"stroke":"fill";return a.save(),a.strokeStyle=a.fillStyle=b.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=b.cornerStrokeColor||this.cornerStrokeColor),
this._setLineDash(a,b.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",a,k,g,h,b),this._drawControl("tr",a,k,g+d,h,b),this._drawControl("bl",a,k,g,h+e,b),this._drawControl("br",a,k,g+d,h+e,b),this.get("lockUniScaling")||(this._drawControl("mt",a,k,g+d/2,h,b),this._drawControl("mb",a,k,g+d/2,h+e,b),this._drawControl("mr",a,k,g+d,h+e/2,b),this._drawControl("ml",a,k,g,h+e/2,b)),j&&this._drawControl("mtr",a,k,g+d/2,h-this.rotatingPointOffset,b),a.restore(),this},_drawControl:function(a,b,c,d,e,f){if(f=f||{},this.isControlVisible(a)){var g=this.cornerSize,h=!this.transparentCorners&&this.cornerStrokeColor;switch(f.cornerStyle||this.cornerStyle){case"circle":b.beginPath(),b.arc(d+g/2,e+g/2,g/2,0,2*Math.PI,!1),b[c](),h&&b.stroke();break;default:this.transparentCorners||b.clearRect(d,e,g,g),b[c+"Rect"](d,e,g,g),h&&b.strokeRect(d,e,g,g)}}},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){return this._getControlsVisibility()[a]=b,this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),f.requestRenderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),f.requestRenderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(b){a.set("opacity",b),f.requestRenderAll(),e()},onComplete:function(){f.remove(a),d()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var a,b,c=[];for(a in arguments[0])c.push(a);for(var d=0,e=c.length;e>d;d++)a=c[d],b=d!==e-1,this._animate(a,arguments[0][a],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(a,b,c,d){var e,f=this;b=b.toString(),c=c?fabric.util.object.clone(c):{},~a.indexOf(".")&&(e=a.split("."));var g=e?this.get(e[0])[e[1]]:this.get(a);"from"in c||(c.from=g),b=~b.indexOf("=")?g+parseFloat(b.replace("=","")):parseFloat(b),fabric.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(b,g,h){e?f[e[0]][e[1]]=b:f.set(a,b),d||c.onChange&&c.onChange(b,g,h)},onComplete:function(a,b,e){d||(f.setCoords(),c.onComplete&&c.onComplete(a,b,e))}})}}),!function(a){"use strict";function b(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,i=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case i:return Math.max(this.get(d),this.get(e))}}}var c=a.fabric||(a.fabric={}),d=c.util.object.extend,e=c.util.object.clone,f={x1:1,x2:1,y1:1,y2:1},g=c.StaticCanvas.supports("setLineDash");return c.Line?void c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,b){a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!=typeof f[a]&&this._setWidthHeight(),this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){if(a.beginPath(),!this.strokeDashArray||this.strokeDashArray&&g){var b=this.calcLinePoints();a.moveTo(b.x1,b.y1),a.lineTo(b.x2,b.y2)}a.lineWidth=this.strokeWidth;var c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath(),c.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray),a.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(a){return d(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1,c=a*this.width*.5,d=b*this.height*.5,e=a*this.width*-.5,f=b*this.height*-.5;return{x1:c,x2:e,y1:d,y2:f}},_toSVG:function(){var a=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'" />\n']}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(a,b,e){e=e||{};var f=c.parseAttributes(a,c.Line.ATTRIBUTE_NAMES),g=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];b(new c.Line(g,d(f,e)))},void(c.Line.fromObject=function(a,b){function d(a){delete a.points,b&&b(a)}var f=e(a,!0);f.points=[a.x1,a.y1,a.x2,a.y2],c.Object._fromObject("Line",f,d,"points")}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";function b(a){return"radius"in a&&a.radius>=0}var c=a.fabric||(a.fabric={}),d=Math.PI;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,cacheProperties:c.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(a){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(a))},_toSVG:function(){var a,b=0,e=0,f=(this.endAngle-this.startAngle)%(2*d);if(0===f)a=["<circle ","COMMON_PARTS",'cx="'+b+'" cy="'+e+'" ','r="',this.radius,'" />\n'];else{var g=c.util.cos(this.startAngle)*this.radius,h=c.util.sin(this.startAngle)*this.radius,i=c.util.cos(this.endAngle)*this.radius,j=c.util.sin(this.endAngle)*this.radius,k=f>d?"1":"0";a=['<path d="M '+g+" "+h," A "+this.radius+" "+this.radius," 0 ",+k+" 1"," "+i+" "+j,'"',"COMMON_PARTS"," />\n"]}return a},_render:function(a){a.beginPath(),a.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",2*a).set("height",2*a)}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(a,d){var e=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!b(e))throw new Error("value of `r` attribute is required and can not be negative");e.left=(e.left||0)-e.radius,e.top=(e.top||0)-e.radius,d(new c.Circle(e))},void(c.Circle.fromObject=function(a,b){return c.Object._fromObject("Circle",a,b)}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",width:100,height:100,_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderPaintInOrder(a)},_renderDashedStroke:function(a){var c=this.width/2,d=this.height/2;a.beginPath(),b.util.drawDashedLine(a,-c,d,0,-d,this.strokeDashArray),b.util.drawDashedLine(a,0,-d,c,d,this.strokeDashArray),b.util.drawDashedLine(a,c,d,-c,d,this.strokeDashArray),a.closePath()},_toSVG:function(){var a=this.width/2,b=this.height/2,c=[-a+" "+b,"0 "+-b,a+" "+b].join(",");return["<polygon ","COMMON_PARTS",'points="',c,'" />']}}),void(b.Triangle.fromObject=function(a,c){return b.Object._fromObject("Triangle",a,c)}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI;return b.Ellipse?void b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(a){this.callSuper("initialize",a),this.set("rx",a&&a.rx||0),this.set("ry",a&&a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(a){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(0,0,this.rx,0,c,!1),a.restore(),this._renderPaintInOrder(a)}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(a,c){var d=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);d.left=(d.left||0)-d.rx,d.top=(d.top||0)-d.ry,c(new b.Ellipse(d))},void(b.Ellipse.fromObject=function(a,c){return b.Object._fromObject("Ellipse",a,c)}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;return b.Rect?void b.warn("fabric.Rect is already defined"):(b.Rect=b.util.createClass(b.Object,{stateProperties:b.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(a){this.callSuper("initialize",a),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){if(1===this.width&&1===this.height)return void a.fillRect(-.5,-.5,1,1);var b=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,e=this.height,f=-this.width/2,g=-this.height/2,h=0!==b||0!==c,i=.4477152502;a.beginPath(),a.moveTo(f+b,g),a.lineTo(f+d-b,g),h&&a.bezierCurveTo(f+d-i*b,g,f+d,g+i*c,f+d,g+c),a.lineTo(f+d,g+e-c),h&&a.bezierCurveTo(f+d,g+e-i*c,f+d-i*b,g+e,f+d-b,g+e),a.lineTo(f+b,g+e),h&&a.bezierCurveTo(f+i*b,g+e,f,g+e-i*c,f,g+e-c),a.lineTo(f,g+c),h&&a.bezierCurveTo(f,g+i*c,f+i*b,g,f+b,g),a.closePath(),this._renderPaintInOrder(a)},_renderDashedStroke:function(a){var c=-this.width/2,d=-this.height/2,e=this.width,f=this.height;a.beginPath(),b.util.drawDashedLine(a,c,d,c+e,d,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d,c+e,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d+f,c,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c,d+f,c,d,this.strokeDashArray),a.closePath()},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},_toSVG:function(){var a=-this.width/2,b=-this.height/2;return["<rect ","COMMON_PARTS",'x="',a,'" y="',b,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d,e){if(!a)return d(null);e=e||{};var f=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);f.left=f.left||0,f.top=f.top||0;var g=new b.Rect(c(e?b.util.object.clone(e):{},f));g.visible=g.visible&&g.width>0&&g.height>0,d(g)},void(b.Rect.fromObject=function(a,c){return b.Object._fromObject("Rect",a,c)}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed;return b.Polyline?void b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,cacheProperties:b.Object.prototype.cacheProperties.concat("points"),initialize:function(a,b){b=b||{},this.points=a||[],this.callSuper("initialize",b);var c=this._calcDimensions();"undefined"==typeof b.left&&(this.left=c.left),"undefined"==typeof b.top&&(this.top=c.top),this.width=c.width,this.height=c.height,this.pathOffset={x:c.left+this.width/2,y:c.top+this.height/2}},_calcDimensions:function(){var a=this.points,b=d(a,"x")||0,c=d(a,"y")||0,f=e(a,"x")||0,g=e(a,"y")||0,h=f-b,i=g-c;return{left:b,top:c,width:h,height:i}},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},_toSVG:function(){for(var a=[],c=this.pathOffset.x,d=this.pathOffset.y,e=b.Object.NUM_FRACTION_DIGITS,g=0,h=this.points.length;h>g;g++)a.push(f(this.points[g].x-c,e),",",f(this.points[g].y-d,e)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',a.join(""),'" />\n']},commonRender:function(a){var b,c=this.points.length,d=this.pathOffset.x,e=this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-d,this.points[0].y-e);for(var f=0;c>f;f++)b=this.points[f],a.lineTo(b.x-d,b.y-e);return!0},_render:function(a){this.commonRender(a)&&this._renderPaintInOrder(a)},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;f>e;e++)c=this.points[e],d=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c,d){if(!a)return c(null);d||(d={});var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);c(new b.Polyline(e,b.util.object.extend(f,d)))},void(b.Polyline.fromObject=function(a,c){return b.Object._fromObject("Polyline",a,c,"points")}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(a){this.commonRender(a)&&(a.closePath(),this._renderPaintInOrder(a))},_renderDashedStroke:function(a){this.callSuper("_renderDashedStroke",a),a.closePath()}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d,e){if(!a)return d(null);e||(e={});var f=b.parsePointsAttribute(a.getAttribute("points")),g=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);d(new b.Polygon(f,c(g,e)))},void(b.Polygon.fromObject=function(a,c){return b.Object._fromObject("Polygon",a,c,"points")}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max,e=b.util.object.extend,f=Object.prototype.toString,g=b.util.drawArc,h=b.util.toFixed,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},j={m:"l",M:"L"};return b.Path?void b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,cacheProperties:b.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:b.Object.prototype.stateProperties.concat("path"),initialize:function(a,b){b=b||{},this.callSuper("initialize",b),a||(a=[]);var c="[object Array]"===f.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._setPositionDimensions(b))},_setPositionDimensions:function(a){var b=this._parseDimensions();this.width=b.width,this.height=b.height,"undefined"==typeof a.left&&(this.left=b.left),"undefined"==typeof a.top&&(this.top=b.top),this.pathOffset=this.pathOffset||{x:b.left+this.width/2,y:b.top+this.height/2}},_renderPathCommands:function(a){var b,c,d,e=null,f=0,h=0,i=0,j=0,k=0,l=0,m=-this.pathOffset.x,n=-this.pathOffset.y;a.beginPath();for(var o=0,p=this.path.length;p>o;++o){switch(b=this.path[o],b[0]){case"l":i+=b[1],j+=b[2],a.lineTo(i+m,j+n);break;case"L":i=b[1],j=b[2],a.lineTo(i+m,j+n);break;case"h":i+=b[1],a.lineTo(i+m,j+n);break;case"H":i=b[1],a.lineTo(i+m,j+n);break;case"v":j+=b[1],a.lineTo(i+m,j+n);break;case"V":j=b[1],a.lineTo(i+m,j+n);break;case"m":i+=b[1],j+=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"M":i=b[1],j=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"c":c=i+b[5],d=j+b[6],k=i+b[3],l=j+b[4],a.bezierCurveTo(i+b[1]+m,j+b[2]+n,k+m,l+n,c+m,d+n),i=c,j=d;break;case"C":i=b[5],j=b[6],k=b[3],l=b[4],a.bezierCurveTo(b[1]+m,b[2]+n,k+m,l+n,i+m,j+n);break;case"s":c=i+b[3],d=j+b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,i+b[1]+m,j+b[2]+n,c+m,d+n),k=i+b[1],l=j+b[2],i=c,j=d;break;case"S":c=b[3],d=b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"q":c=i+b[3],d=j+b[4],k=i+b[1],l=j+b[2],a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"Q":c=b[3],d=b[4],a.quadraticCurveTo(b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"t":c=i+b[1],d=j+b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"T":c=b[1],d=b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"a":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+i+m,b[7]+j+n]),i+=b[6],j+=b[7];break;case"A":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+m,b[7]+n]),i=b[6],j=b[7];break;case"z":case"Z":i=f,j=h,a.closePath()}e=b}},_render:function(a){this._renderPathCommands(a),this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=e(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),top:this.top,left:this.left});return b},toDatalessObject:function(a){var b=this.toObject(["sourcePath"].concat(a));return b.sourcePath&&delete b.path,b},_toSVG:function(){var a=this._getOffsetTransform(),b=this.path.map(function(a){return a.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',b,'" stroke-linecap="round" ','transform="'+a+'" ',"/>\n"]},_getOffsetTransform:function(){var a=b.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,a)+", "+h(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var b=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d,e,f=[],g=[],h=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,k=0,l=this.path.length;l>k;k++){for(a=this.path[k],d=a.slice(1).trim(),g.length=0;c=h.exec(d);)g.push(c[0]);e=[a.charAt(0)];for(var m=0,n=g.length;n>m;m++)b=parseFloat(g[m]),isNaN(b)||e.push(b);var o=e[0],p=i[o.toLowerCase()],q=j[o]||o;if(e.length-1>p)for(var r=1,s=e.length;s>r;r+=p)f.push([o].concat(e.slice(r,r+p))),o=q;else f.push(e)}return f},_parseDimensions:function(){for(var a,e,f,g,h=[],i=[],j=null,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=this.path.length;r>q;++q){switch(a=this.path[q],a[0]){case"l":m+=a[1],n+=a[2],g=[];break;case"L":m=a[1],n=a[2],g=[];break;case"h":m+=a[1],g=[];break;case"H":m=a[1],g=[];break;case"v":n+=a[1],g=[];break;case"V":n=a[1],g=[];break;case"m":m+=a[1],n+=a[2],k=m,l=n,g=[];break;case"M":m=a[1],n=a[2],k=m,l=n,g=[];break;case"c":e=m+a[5],f=n+a[6],o=m+a[3],p=n+a[4],g=b.util.getBoundsOfCurve(m,n,m+a[1],n+a[2],o,p,e,f),m=e,n=f;break;case"C":o=a[3],p=a[4],g=b.util.getBoundsOfCurve(m,n,a[1],a[2],o,p,a[5],a[6]),m=a[5],n=a[6];break;case"s":e=m+a[3],f=n+a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,m+a[1],n+a[2],e,f),o=m+a[1],p=n+a[2],m=e,n=f;break;case"S":e=a[3],f=a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,a[1],a[2],e,f),m=e,n=f,o=a[1],p=a[2];break;case"q":e=m+a[3],f=n+a[4],o=m+a[1],p=n+a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"Q":o=a[1],p=a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,a[3],a[4]),m=a[3],n=a[4];break;case"t":e=m+a[1],f=n+a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"T":e=a[1],f=a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"a":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6]+m,a[7]+n),m+=a[6],n+=a[7];break;case"A":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6],a[7]),m=a[6],n=a[7];break;case"z":case"Z":m=k,n=l}j=a,g.forEach(function(a){h.push(a.x),i.push(a.y)}),h.push(m),i.push(n)}var s=c(h)||0,t=c(i)||0,u=d(h)||0,v=d(i)||0,w=u-s,x=v-t,y={left:s,top:t,width:w,height:x};return y}}),b.Path.fromObject=function(a,c){if("string"==typeof a.sourcePath){var d=a.sourcePath;b.loadSVGFromURL(d,function(b){var d=b[0];d.setOptions(a),c&&c(d)})}else b.Object._fromObject("Path",a,c,"path")},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),void(b.Path.fromElement=function(a,c,d){var f=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);c(new b.Path(f.d,e(f,d)))}))}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max;b.Group||(b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,b,c){b=b||{},this._objects=[],c&&this.callSuper("initialize",b),this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(c)this._updateObjectsACoords();else{var e=b&&b.centerPoint;void 0!==b.originX&&(this.originX=b.originX),void 0!==b.originY&&(this.originY=b.originY),e||this._calcBounds(),this._updateObjectsCoords(e),delete b.centerPoint,this.callSuper("initialize",b)}this.setCoords()},_updateObjectsACoords:function(){for(var a=!0,b=!0,c=this._objects.length;c--;)this._objects[c].setCoords(a,b)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){var c=a.left,d=a.top,e=!0,f=!0;a.set({left:c-b.x,top:d-b.y}),a.group=this,a.setCoords(e,f)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this,a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0,delete a.group},_set:function(a,c){var d=this._objects.length;if(this.useSetOnGroup)for(;d--;)this._objects[d].setOnGroup(a,c);if("canvas"===a)for(;d--;)this._objects[d]._set(a,c);b.Object.prototype._set.call(this,a,c)},toObject:function(a){var c=this.includeDefaultValues,d=this._objects.map(function(b){var d=b.includeDefaultValues;b.includeDefaultValues=c;var e=b.toObject(a);return b.includeDefaultValues=d,e}),e=b.Object.prototype.toObject.call(this,a);return e.objects=d,e},toDatalessObject:function(a){var c,d=this.sourcePath;if(d)c=d;else{var e=this.includeDefaultValues;c=this._objects.map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=e;var d=b.toDatalessObject(a);return b.includeDefaultValues=c,d})}var f=b.Object.prototype.toDatalessObject.call(this,a);return f.objects=c,f},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},shouldCache:function(){var a=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=a,a)for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b].willDrawShadow())return this.ownCaching=!1,!1;return a},willDrawShadow:function(){if(this.shadow)return b.Object.prototype.willDrawShadow.call(this);for(var a=0,c=this._objects.length;c>a;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var b=0,c=this._objects.length;c>b;b++)this._objects[b].render(a);this._drawClipPath(a)},isCacheDirty:function(a){if(this.callSuper("isCacheDirty",a))return!0;if(!this.statefullCache)return!1;for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b].isCacheDirty(!0)){if(this._cacheCanvas){var d=this.cacheWidth/this.zoomX,e=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-e/2,d,e)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var c=a.calcTransformMatrix(),d=b.util.qrDecompose(c),e=new b.Point(d.translateX,d.translateY);return a.flipX=!1,a.flipY=!1,a.set("scaleX",d.scaleX),a.set("scaleY",d.scaleY),a.skewX=d.skewX,a.skewY=d.skewY,a.angle=d.angle,a.setPositionByOrigin(e,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),a.setCoords(),delete a.group,this},destroy:function(){return this._objects.forEach(function(a){a.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var a=this._objects,c=this.canvas;this._objects=[];var d=this.toObject();delete d.objects;var e=new b.ActiveSelection([]);return e.set(d),e.type="activeSelection",c.remove(this),a.forEach(function(a){a.group=e,a.dirty=!0,c.add(a)}),e.canvas=c,e._objects=a,c._activeObject=e,e.setCoords(),e}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var a=!0,b=!0;return this.forEachObject(function(c){c.setCoords(a,b)}),this},_calcBounds:function(a){for(var b,c,d,e=[],f=[],g=["tr","br","bl","tl"],h=0,i=this._objects.length,j=g.length,k=!0;i>h;++h)for(b=this._objects[h],b.setCoords(k),d=0;j>d;d++)c=g[d],e.push(b.oCoords[c].x),f.push(b.oCoords[c].y);this._getBounds(e,f,a)},_getBounds:function(a,e,f){var g=new b.Point(c(a),c(e)),h=new b.Point(d(a),d(e)),i=g.y||0,j=g.x||0,k=h.x-g.x||0,l=h.y-g.y||0;this.width=k,this.height=l,f||this.setPositionByOrigin({x:j,y:i},"left","top")},toSVG:function(a){for(var b=[],c=0,d=this._objects.length;d>c;c++)b.push("\t",this._objects[c].toSVG(a));return this._createBaseSVGMarkup(b,{reviver:a,noStyle:!0,withShadow:!0})},toClipPathSVG:function(a){for(var b=[],c=0,d=this._objects.length;d>c;c++)b.push("\t",this._objects[c].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(b,{reviver:a})}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){var e=b.util.object.clone(a,!0);delete e.objects,c&&c(new b.Group(d,e,(!0)))})})}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={});b.ActiveSelection||(b.ActiveSelection=b.util.createClass(b.Group,{type:"activeSelection",initialize:function(a,c){c=c||{},this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;c.originX&&(this.originX=c.originX),c.originY&&(this.originY=c.originY),this._calcBounds(),this._updateObjectsCoords(),b.Object.prototype.initialize.call(this,c),this.setCoords()},toGroup:function(){var a=this._objects.concat();this._objects=[];var c=b.Object.prototype.toObject.call(this),d=new b.Group([]);if(delete c.type,d.set(c),a.forEach(function(a){a.canvas.remove(a),a.group=d}),d._objects=a,!this.canvas)return d;var e=this.canvas;return e.add(d),e._activeObject=d,d.setCoords(),d},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(a,b,c){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,b),c=c||{},"undefined"==typeof c.hasControls&&(c.hasControls=!1),"undefined"==typeof c.hasRotatingPoint&&(c.hasRotatingPoint=!1),c.forActiveSelection=!0;for(var d=0,e=this._objects.length;e>d;d++)this._objects[d]._renderControls(a,c);a.restore()}}),b.ActiveSelection.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.ActiveSelection(d,a,(!0)))})})}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=fabric.util.object.extend;return a.fabric||(a.fabric={}),a.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(a,b){b||(b={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",b),this._initElement(a,b)},getElement:function(){return this._element||{}},setElement:function(a,b){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=a,this._originalElement=a,this._initConfig(b),this.resizeFilter&&this.applyResizeFilters(),0!==this.filters.length&&this.applyFilters(),this},removeTexture:function(a){var b=fabric.filterBackend;b&&b.evictCachesForKey&&b.evictCachesForKey(a)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(a){fabric.util.cleanUpJsdomNode(this[a]),this[a]=void 0}.bind(this))},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}},_stroke:function(a){if(this.stroke&&0!==this.strokeWidth){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,-c),a.lineTo(b,-c),a.lineTo(b,c),a.lineTo(-b,c),a.lineTo(-b,-c),a.closePath()}},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a,this),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){var c=[];this.filters.forEach(function(a){a&&c.push(a.toObject())});var d=b(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(a)),{src:this.getSrc(),filters:c});return this.resizeFilter&&(d.resizeFilter=this.resizeFilter.toObject()),d},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var a,b=[],c=[],d=-this.width/2,e=-this.height/2,f="";if(this.hasCrop()){var g=fabric.Object.__uid++;b.push('<clipPath id="imageCrop_'+g+'">\n','\t<rect x="'+d+'" y="'+e+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),f=' clip-path="url(#imageCrop_'+g+')" '}if(c.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',d-this.cropX,'" y="',e-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',f,"></image>\n"),
this.stroke||this.strokeDashArray){var h=this.fill;this.fill=null,a=["\t<rect ",'x="',d,'" y="',e,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=h}return b="fill"!==this.paintFirst?b.concat(a,c):b.concat(c,a)},getSrc:function(a){var b=a?this._element:this._originalElement;return b?b.toDataURL?b.toDataURL():b.src:this.src||""},setSrc:function(a,b,c){return fabric.util.loadImage(a,function(a){this.setElement(a,c),this._setWidthHeight(),b(this)},this,c&&c.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var a=this.resizeFilter,b=this.minimumScaleTrigger,c=this.getTotalObjectScaling(),d=c.scaleX,e=c.scaleY,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||d>b&&e>b)return this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=d,void(this._lastScaleY=e);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var g=fabric.util.createCanvasElement(),h=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,i=f.width,j=f.height;g.width=i,g.height=j,this._element=g,this._lastScaleX=a.scaleX=d,this._lastScaleY=a.scaleY=e,fabric.filterBackend.applyFilters([a],f,i,j,this._element,h),this._filterScalingX=g.width/this._originalElement.width,this._filterScalingY=g.height/this._originalElement.height},applyFilters:function(a){if(a=a||this.filters||[],a=a.filter(function(a){return a&&!a.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===a.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var b=this._originalElement,c=b.naturalWidth||b.width,d=b.naturalHeight||b.height;if(this._element===this._originalElement){var e=fabric.util.createCanvasElement();e.width=c,e.height=d,this._element=e,this._filteredEl=e}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,c,d),this._lastScaleX=1,this._lastScaleY=1;return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(a,this._originalElement,c,d,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(a){this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)},shouldCache:function(){return this.ownCaching=this.objectCaching&&this.needsItsOwnCache(),this.ownCaching},_renderFill:function(a){var b=this.width,c=this.height,d=b*this._filterScalingX,e=c*this._filterScalingY,f=-b/2,g=-c/2,h=this._element;h&&a.drawImage(h,this.cropX*this._filterScalingX,this.cropY*this._filterScalingY,d,e,f,g,b,c)},_needsResize:function(){var a=this.getTotalObjectScaling();return a.scaleX!==this._lastScaleX||a.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(a,b){this.setElement(fabric.util.getById(a),b),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a&&a.length?fabric.util.enlivenObjects(a,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){a||(a={});var b=this.getElement();this.width=a.width||b.naturalWidth||b.width||0,this.height=a.height||b.naturalHeight||b.height||0},parsePreserveAspectRatioAttribute:function(){var a,b=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),c=this._element.width,d=this._element.height,e=1,f=1,g=0,h=0,i=0,j=0,k=this.width,l=this.height,m={width:k,height:l};return!b||"none"===b.alignX&&"none"===b.alignY?(e=k/c,f=l/d):("meet"===b.meetOrSlice&&(e=f=fabric.util.findScaleToFit(this._element,m),a=(k-c*e)/2,"Min"===b.alignX&&(g=-a),"Max"===b.alignX&&(g=a),a=(l-d*f)/2,"Min"===b.alignY&&(h=-a),"Max"===b.alignY&&(h=a)),"slice"===b.meetOrSlice&&(e=f=fabric.util.findScaleToCover(this._element,m),a=c-k/e,"Mid"===b.alignX&&(i=a/2),"Max"===b.alignX&&(i=a),a=d-l/f,"Mid"===b.alignY&&(j=a/2),"Max"===b.alignY&&(j=a),c=k/e,d=l/f)),{width:c,height:d,scaleX:e,scaleY:f,offsetLeft:g,offsetTop:h,cropX:i,cropY:j}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){var c=fabric.util.object.clone(a);fabric.util.loadImage(c.src,function(a,d){return d?void(b&&b(null,d)):void fabric.Image.prototype._initFilters.call(c,c.filters,function(d){c.filters=d||[],fabric.Image.prototype._initFilters.call(c,[c.resizeFilter],function(d){c.resizeFilter=d[0],fabric.util.enlivenObjects([c.clipPath],function(d){c.clipPath=d[0];var e=new fabric.Image(a,c);b(e)})})})},null,c.crossOrigin)},fabric.Image.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b&&b(new fabric.Image(a,c))},null,c&&c.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),void(fabric.Image.fromElement=function(a,c,d){var e=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],c,b(d?fabric.util.object.clone(d):{},e))}))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,d=a.onChange||b,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){e.rotate(a),d()},onComplete:function(){e.setCoords(),c()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.requestRenderAllBound}),this}}),!function(){"use strict";function a(a,b){var c="precision "+b+" float;\nvoid main(){}",d=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(d,c),a.compileShader(d),!!a.getShaderParameter(d,a.COMPILE_STATUS)}function b(a){a&&a.tileSize&&(this.tileSize=a.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}fabric.isWebglSupported=function(b){if(fabric.isLikelyNode)return!1;b=b||fabric.WebglFilterBackend.prototype.tileSize;var c=document.createElement("canvas"),d=c.getContext("webgl")||c.getContext("experimental-webgl"),e=!1;if(d){fabric.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),e=fabric.maxTextureSize>=b;for(var f=["highp","mediump","lowp"],g=0;3>g;g++)if(a(d,f[g])){fabric.webGlPrecision=f[g];break}}return this.isSupported=e,e},fabric.WebglFilterBackend=b,b.prototype={tileSize:2048,resources:{},setupGLContext:function(a,b){this.dispose(),this.createWebGLCanvas(a,b),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(a,b)},chooseFastestCopyGLTo2DMethod:function(a,b){var c,d="undefined"!=typeof window.performance;try{new ImageData(1,1),c=!0}catch(e){c=!1}var f="undefined"!=typeof ArrayBuffer,g="undefined"!=typeof Uint8ClampedArray;if(d&&c&&f&&g){var h,i,j,k=fabric.util.createCanvasElement(),l=new ArrayBuffer(a*b*4),m={imageBuffer:l,destinationWidth:a,destinationHeight:b,targetCanvas:k};k.width=a,k.height=b,h=window.performance.now(),copyGLTo2DDrawImage.call(m,this.gl,m),i=window.performance.now()-h,h=window.performance.now(),copyGLTo2DPutImageData.call(m,this.gl,m),j=window.performance.now()-h,i>j?(this.imageBuffer=l,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(a,b){var c=fabric.util.createCanvasElement();c.width=a,c.height=b;var d={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},e=c.getContext("webgl",d);e||(e=c.getContext("experimental-webgl",d)),e&&(e.clearColor(0,0,0,0),this.canvas=c,this.gl=e)},applyFilters:function(a,b,c,d,e,f){var g,h=this.gl;f&&(g=this.getCachedTexture(f,b));var i={originalWidth:b.width||b.originalWidth,originalHeight:b.height||b.originalHeight,sourceWidth:c,sourceHeight:d,destinationWidth:c,destinationHeight:d,context:h,sourceTexture:this.createTexture(h,c,d,!g&&b),targetTexture:this.createTexture(h,c,d),originalTexture:g||this.createTexture(h,c,d,!g&&b),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:e},j=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,j),a.forEach(function(a){a&&a.applyTo(i)}),resizeCanvasIfNeeded(i),this.copyGLTo2D(h,i),h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(i.sourceTexture),h.deleteTexture(i.targetTexture),h.deleteFramebuffer(j),e.getContext("2d").setTransform(1,0,0,1,0,0),i},applyFiltersDebug:function(a,b,c,d,e,f){var g=this.gl,h=this.applyFilters(a,b,c,d,e,f),i=g.getError();if(i!==g.NO_ERROR){var j=this.glErrorToString(g,i),k=new Error("WebGL Error "+j);throw k.glErrorCode=i,k}return h},glErrorToString:function(a,b){if(!a)return"Context undefined for error code: "+b;if("number"!=typeof b)return"Error code is not a number";switch(b){case a.NO_ERROR:return"NO_ERROR";case a.INVALID_ENUM:return"INVALID_ENUM";case a.INVALID_VALUE:return"INVALID_VALUE";case a.INVALID_OPERATION:return"INVALID_OPERATION";case a.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case a.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case a.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(a,b,c,d){var e=a.createTexture();return a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),d?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),e},getCachedTexture:function(a,b){if(this.textureCache[a])return this.textureCache[a];var c=this.createTexture(this.gl,b.width,b.height,b);return this.textureCache[a]=c,c},evictCachesForKey:function(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var a=this.gl,b=a.getExtension("WEBGL_debug_renderer_info"),c={renderer:"",vendor:""};if(b){var d=a.getParameter(b.UNMASKED_RENDERER_WEBGL),e=a.getParameter(b.UNMASKED_VENDOR_WEBGL);d&&(c.renderer=d.toLowerCase()),e&&(c.vendor=e.toLowerCase())}return this.gpuInfo=c,c}}}(),!function(){"use strict";function a(){}var b=function(){};fabric.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:b,dispose:b,clearWebGLCaches:b,resources:{},applyFilters:function(a,b,c,d,e){var f=e.getContext("2d");f.drawImage(b,0,0,c,d);var g=f.getImageData(0,0,c,d),h=f.getImageData(0,0,c,d),i={sourceWidth:c,sourceHeight:d,imageData:g,originalEl:b,originalImageData:h,canvasEl:e,ctx:f,filterBackend:this};return a.forEach(function(a){a.applyTo(i)}),(i.imageData.width!==c||i.imageData.height!==d)&&(e.width=i.imageData.width,e.height=i.imageData.height),f.putImageData(i.imageData,0,0),i}}}(),fabric.Image=fabric.Image||{},fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},createProgram:function(a,b,c){b=b||this.fragmentSource,c=c||this.vertexSource,"highp"!==fabric.webGlPrecision&&(b=b.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var d=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+a.getShaderInfoLog(d));var e=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(e,b),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+a.getShaderInfoLog(e));var f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(f));var g=this.getAttributeLocations(a,f),h=this.getUniformLocations(a,f)||{};return h.uStepW=a.getUniformLocation(f,"uStepW"),h.uStepH=a.getUniformLocation(f,"uStepH"),{program:f,attributeLocations:g,uniformLocations:h}},getAttributeLocations:function(a,b){return{aPosition:a.getAttribLocation(b,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(a,b,c){var d=b.aPosition,e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e),a.enableVertexAttribArray(d),a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW)},_setupFrameBuffer:function(a){var b,c,d=a.context;a.passes>1?(b=a.destinationWidth,c=a.destinationHeight,(a.sourceWidth!==b||a.sourceHeight!==c)&&(d.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(d,b,c)),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a.targetTexture,0)):(d.bindFramebuffer(d.FRAMEBUFFER,null),d.finish())},_swapTextures:function(a){a.passes--,a.pass++;var b=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=b},isNeutralState:function(){var a=this.mainParameter,b=fabric.Image.filters[this.type].prototype;if(a){if(Array.isArray(b[a])){for(var c=b[a].length;c--;)if(this[a][c]!==b[a][c])return!1;return!0}return b[a]===this[a]}return!1},applyTo:function(a){a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var b=a.context,c=this.retrieveShader(a);0===a.pass&&a.originalTexture?b.bindTexture(b.TEXTURE_2D,a.originalTexture):b.bindTexture(b.TEXTURE_2D,a.sourceTexture),b.useProgram(c.program),this.sendAttributeData(b,c.attributeLocations,a.aPosition),b.uniform1f(c.uniformLocations.uStepW,1/a.sourceWidth),b.uniform1f(c.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(b,c.uniformLocations),b.viewport(0,0,a.destinationWidth,a.destinationHeight),b.drawArrays(b.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,b,c){a.activeTexture(c),a.bindTexture(a.TEXTURE_2D,b),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,b){a.activeTexture(b),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var b=document.createElement("canvas");b.width=a.sourceWidth,b.height=a.sourceHeight,a.helpLayer=b}},toObject:function(){var a={type:this.type},b=this.mainParameter;return b&&(a[b]=this[b]),a},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(a,b){var c=new fabric.Image.filters[a.type](a);return b&&b(c),c},!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.ColorMatrix=d(c.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(a){this.callSuper("initialize",a),this.matrix=this.matrix.slice(0)},applyTo2d:function(a){var b,c,d,e,f,g=a.imageData,h=g.data,i=h.length,j=this.matrix,k=this.colorsOnly;for(f=0;i>f;f+=4)b=h[f],c=h[f+1],d=h[f+2],k?(h[f]=b*j[0]+c*j[1]+d*j[2]+255*j[4],h[f+1]=b*j[5]+c*j[6]+d*j[7]+255*j[9],h[f+2]=b*j[10]+c*j[11]+d*j[12]+255*j[14]):(e=h[f+3],h[f]=b*j[0]+c*j[1]+d*j[2]+e*j[3]+255*j[4],h[f+1]=b*j[5]+c*j[6]+d*j[7]+e*j[8]+255*j[9],h[f+2]=b*j[10]+c*j[11]+d*j[12]+e*j[13]+255*j[14],h[f+3]=b*j[15]+c*j[16]+d*j[17]+e*j[18]+255*j[19])},getUniformLocations:function(a,b){return{uColorMatrix:a.getUniformLocation(b,"uColorMatrix"),uConstants:a.getUniformLocation(b,"uConstants")}},sendUniformData:function(a,b){var c=this.matrix,d=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],e=[c[4],c[9],c[14],c[19]];a.uniformMatrix4fv(b.uColorMatrix,!1,d),a.uniform4fv(b.uConstants,e)}}),b.Image.filters.ColorMatrix.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Brightness=d(c.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(a){if(0!==this.brightness){var b,c=a.imageData,d=c.data,e=d.length,f=Math.round(255*this.brightness);for(b=0;e>b;b+=4)d[b]=d[b]+f,d[b+1]=d[b+1]+f,d[b+2]=d[b+2]+f}},getUniformLocations:function(a,b){return{uBrightness:a.getUniformLocation(b,"uBrightness")}},sendUniformData:function(a,b){a.uniform1f(b.uBrightness,this.brightness)}}),b.Image.filters.Brightness.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Convolute=e(d.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(a){var b=Math.sqrt(this.matrix.length),c=this.type+"_"+b+"_"+(this.opaque?1:0),d=this.fragmentSource[c];return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,d)),a.programCache[c]},applyTo2d:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=a.imageData,p=o.data,q=this.matrix,r=Math.round(Math.sqrt(q.length)),s=Math.floor(r/2),t=o.width,u=o.height,v=a.ctx.createImageData(t,u),w=v.data,x=this.opaque?1:0;for(l=0;u>l;l++)for(k=0;t>k;k++){for(f=4*(l*t+k),b=0,c=0,d=0,e=0,n=0;r>n;n++)for(m=0;r>m;m++)h=l+n-s,g=k+m-s,0>h||h>u||0>g||g>t||(i=4*(h*t+g),j=q[n*r+m],b+=p[i]*j,c+=p[i+1]*j,d+=p[i+2]*j,x||(e+=p[i+3]*j));w[f]=b,w[f+1]=c,w[f+2]=d,w[f+3]=x?p[f+3]:e}a.imageData=v},getUniformLocations:function(a,b){return{uMatrix:a.getUniformLocation(b,"uMatrix"),uOpaque:a.getUniformLocation(b,"uOpaque"),uHalfSize:a.getUniformLocation(b,"uHalfSize"),uSize:a.getUniformLocation(b,"uSize")}},sendUniformData:function(a,b){a.uniform1fv(b.uMatrix,this.matrix)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Grayscale=d(c.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(a){var b,c,d=a.imageData,e=d.data,f=e.length,g=this.mode;for(b=0;f>b;b+=4)"average"===g?c=(e[b]+e[b+1]+e[b+2])/3:"lightness"===g?c=(Math.min(e[b],e[b+1],e[b+2])+Math.max(e[b],e[b+1],e[b+2]))/2:"luminosity"===g&&(c=.21*e[b]+.72*e[b+1]+.07*e[b+2]),e[b]=c,e[b+1]=c,e[b+2]=c},retrieveShader:function(a){var b=this.type+"_"+this.mode;if(!a.programCache.hasOwnProperty(b)){var c=this.fragmentSource[this.mode];a.programCache[b]=this.createProgram(a.context,c)}return a.programCache[b]},getUniformLocations:function(a,b){return{uMode:a.getUniformLocation(b,"uMode")}},sendUniformData:function(a,b){var c=1;a.uniform1i(b.uMode,c)},isNeutralState:function(){return!1}}),b.Image.filters.Grayscale.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Invert=d(c.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(a){var b,c=a.imageData,d=c.data,e=d.length;for(b=0;e>b;b+=4)d[b]=255-d[b],d[b+1]=255-d[b+1],d[b+2]=255-d[b+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(a,b){return{uInvert:a.getUniformLocation(b,"uInvert")}},sendUniformData:function(a,b){a.uniform1i(b.uInvert,this.invert)}}),b.Image.filters.Invert.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Noise=e(d.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(a){if(0!==this.noise){var b,c,d=a.imageData,e=d.data,f=e.length,g=this.noise;for(b=0,f=e.length;f>b;b+=4)c=(.5-Math.random())*g,e[b]+=c,e[b+1]+=c,e[b+2]+=c}},getUniformLocations:function(a,b){return{uNoise:a.getUniformLocation(b,"uNoise"),uSeed:a.getUniformLocation(b,"uSeed")}},sendUniformData:function(a,b){a.uniform1f(b.uNoise,this.noise/255),a.uniform1f(b.uSeed,Math.random())},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Pixelate=d(c.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=a.imageData,n=m.data,o=m.height,p=m.width;for(c=0;o>c;c+=this.blocksize)for(d=0;p>d;d+=this.blocksize)for(b=4*c*p+4*d,e=n[b],f=n[b+1],g=n[b+2],h=n[b+3],k=Math.min(c+this.blocksize,o),l=Math.min(d+this.blocksize,p),i=c;k>i;i++)for(j=d;l>j;j++)b=4*i*p+4*j,n[b]=e,n[b+1]=f,n[b+2]=g,n[b+3]=h},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(a,b){return{uBlocksize:a.getUniformLocation(b,"uBlocksize"),uStepW:a.getUniformLocation(b,"uStepW"),uStepH:a.getUniformLocation(b,"uStepH")}},sendUniformData:function(a,b){a.uniform1f(b.uBlocksize,this.blocksize)}}),b.Image.filters.Pixelate.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.RemoveColor=e(d.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(a){var c,d,e,f,g=a.imageData,h=g.data,i=255*this.distance,j=new b.Color(this.color).getSource(),k=[j[0]-i,j[1]-i,j[2]-i],l=[j[0]+i,j[1]+i,j[2]+i];for(c=0;c<h.length;c+=4)d=h[c],e=h[c+1],f=h[c+2],d>k[0]&&e>k[1]&&f>k[2]&&d<l[0]&&e<l[1]&&f<l[2]&&(h[c+3]=0)},getUniformLocations:function(a,b){return{uLow:a.getUniformLocation(b,"uLow"),uHigh:a.getUniformLocation(b,"uHigh")}},sendUniformData:function(a,c){var d=new b.Color(this.color).getSource(),e=parseFloat(this.distance),f=[0+d[0]/255-e,0+d[1]/255-e,0+d[2]/255-e,1],g=[d[0]/255+e,d[1]/255+e,d[2]/255+e,1];a.uniform4fv(c.uLow,f),a.uniform4fv(c.uHigh,g)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),b.Image.filters.RemoveColor.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass,e={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var f in e)c[f]=d(c.ColorMatrix,{type:f,matrix:e[f],mainParameter:!1,colorsOnly:!0}),b.Image.filters[f].fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric,c=b.Image.filters,d=b.util.createClass;c.BlendColor=d(c.BaseFilter,{
type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(a){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[a]+"}\n}"},retrieveShader:function(a){var b,c=this.type+"_"+this.mode;return a.programCache.hasOwnProperty(c)||(b=this.buildSource(this.mode),a.programCache[c]=this.createProgram(a.context,b)),a.programCache[c]},applyTo2d:function(a){var c,d,e,f,g,h,i,j=a.imageData,k=j.data,l=k.length,m=1-this.alpha;i=new b.Color(this.color).getSource(),c=i[0]*this.alpha,d=i[1]*this.alpha,e=i[2]*this.alpha;for(var n=0;l>n;n+=4)switch(f=k[n],g=k[n+1],h=k[n+2],this.mode){case"multiply":k[n]=f*c/255,k[n+1]=g*d/255,k[n+2]=h*e/255;break;case"screen":k[n]=255-(255-f)*(255-c)/255,k[n+1]=255-(255-g)*(255-d)/255,k[n+2]=255-(255-h)*(255-e)/255;break;case"add":k[n]=f+c,k[n+1]=g+d,k[n+2]=h+e;break;case"diff":case"difference":k[n]=Math.abs(f-c),k[n+1]=Math.abs(g-d),k[n+2]=Math.abs(h-e);break;case"subtract":k[n]=f-c,k[n+1]=g-d,k[n+2]=h-e;break;case"darken":k[n]=Math.min(f,c),k[n+1]=Math.min(g,d),k[n+2]=Math.min(h,e);break;case"lighten":k[n]=Math.max(f,c),k[n+1]=Math.max(g,d),k[n+2]=Math.max(h,e);break;case"overlay":k[n]=128>c?2*f*c/255:255-2*(255-f)*(255-c)/255,k[n+1]=128>d?2*g*d/255:255-2*(255-g)*(255-d)/255,k[n+2]=128>e?2*h*e/255:255-2*(255-h)*(255-e)/255;break;case"exclusion":k[n]=c+f-2*c*f/255,k[n+1]=d+g-2*d*g/255,k[n+2]=e+h-2*e*h/255;break;case"tint":k[n]=c+f*m,k[n+1]=d+g*m,k[n+2]=e+h*m}},getUniformLocations:function(a,b){return{uColor:a.getUniformLocation(b,"uColor")}},sendUniformData:function(a,c){var d=new b.Color(this.color).getSource();d[0]=this.alpha*d[0]/255,d[1]=this.alpha*d[1]/255,d[2]=this.alpha*d[2]/255,d[3]=this.alpha,a.uniform4fv(c.uColor,d)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.BlendColor.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric,c=b.Image.filters,d=b.util.createClass;c.BlendImage=d(c.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(a){var b=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(b)||(a.programCache[b]=this.createProgram(a.context,c)),a.programCache[b]},applyToWebGL:function(a){var b=a.context,c=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(b,c,b.TEXTURE1),this.callSuper("applyToWebGL",a),this.unbindAdditionalTexture(b,b.TEXTURE1)},createTexture:function(a,b){return a.getCachedTexture(b.cacheKey,b._element)},calculateMatrix:function(){var a=this.image,b=a._element.width,c=a._element.height;return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/b,-a.top/c,1]},applyTo2d:function(a){var c,d,e,f,g,h,i,j,k,l,m,n=a.imageData,o=a.filterBackend.resources,p=n.data,q=p.length,r=n.width,s=n.height,t=this.image;o.blendImage||(o.blendImage=b.util.createCanvasElement()),k=o.blendImage,l=k.getContext("2d"),k.width!==r||k.height!==s?(k.width=r,k.height=s):l.clearRect(0,0,r,s),l.setTransform(t.scaleX,0,0,t.scaleY,t.left,t.top),l.drawImage(t._element,0,0,r,s),m=l.getImageData(0,0,r,s).data;for(var u=0;q>u;u+=4)switch(g=p[u],h=p[u+1],i=p[u+2],j=p[u+3],c=m[u],d=m[u+1],e=m[u+2],f=m[u+3],this.mode){case"multiply":p[u]=g*c/255,p[u+1]=h*d/255,p[u+2]=i*e/255,p[u+3]=j*f/255;break;case"mask":p[u+3]=f}},getUniformLocations:function(a,b){return{uTransformMatrix:a.getUniformLocation(b,"uTransformMatrix"),uImage:a.getUniformLocation(b,"uImage")}},sendUniformData:function(a,b){var c=this.calculateMatrix();a.uniform1i(b.uImage,1),a.uniformMatrix3fv(b.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),b.Image.filters.BlendImage.fromObject=function(a,c){b.Image.fromObject(a.image,function(d){var e=b.util.object.clone(a);e.image=d,c(new b.Image.filters.BlendImage(e))})}}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=Math.pow,d=Math.floor,e=Math.sqrt,f=Math.abs,g=Math.round,h=Math.sin,i=Math.ceil,j=b.Image.filters,k=b.util.createClass;j.Resize=k(j.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(a,b){return{uDelta:a.getUniformLocation(b,"uDelta"),uTaps:a.getUniformLocation(b,"uTaps")}},sendUniformData:function(a,b){a.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),a.uniform1fv(b.uTaps,this.taps)},retrieveShader:function(a){var b=this.getFilterWindow(),c=this.type+"_"+b;if(!a.programCache.hasOwnProperty(c)){var d=this.generateShader(b);a.programCache[c]=this.createProgram(a.context,d)}return a.programCache[c]},getFilterWindow:function(){var a=this.tempScale;return Math.ceil(this.lanczosLobes/a)},getTaps:function(){for(var a=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,c=this.getFilterWindow(),d=new Array(c),e=1;c>=e;e++)d[e-1]=a(e*b);return d},generateShader:function(a){for(var a,b=new Array(a),c=this.fragmentSourceTOP,d=1;a>=d;d++)b[d-1]=d+".0 * uDelta";return c+="uniform float uTaps["+a+"];\n",c+="void main() {\n",c+="  vec4 color = texture2D(uTexture, vTexCoord);\n",c+="  float sum = 1.0;\n",b.forEach(function(a,b){c+="  color += texture2D(uTexture, vTexCoord + "+a+") * uTaps["+b+"];\n",c+="  color += texture2D(uTexture, vTexCoord - "+a+") * uTaps["+b+"];\n",c+="  sum += 2.0 * uTaps["+b+"];\n"}),c+="  gl_FragColor = color / sum;\n",c+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(a){a.webgl?(a.passes++,this.width=a.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=a.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),a.destinationWidth=this.dW,this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a),a.sourceWidth=a.destinationWidth,this.height=a.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),a.destinationHeight=this.dH,this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a),a.sourceHeight=a.destinationHeight):this.applyTo2d(a)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(a){return function(b){if(b>=a||-a>=b)return 0;if(1.1920929e-7>b&&b>-1.1920929e-7)return 1;b*=Math.PI;var c=b/a;return h(b)/b*h(c)/c}},applyTo2d:function(a){var b=a.imageData,c=this.scaleX,d=this.scaleY;this.rcpScaleX=1/c,this.rcpScaleY=1/d;var e,f=b.width,h=b.height,i=g(f*c),j=g(h*d);"sliceHack"===this.resizeType?e=this.sliceByTwo(a,f,h,i,j):"hermite"===this.resizeType?e=this.hermiteFastResize(a,f,h,i,j):"bilinear"===this.resizeType?e=this.bilinearFiltering(a,f,h,i,j):"lanczos"===this.resizeType&&(e=this.lanczosResize(a,f,h,i,j)),a.imageData=e},sliceByTwo:function(a,c,e,f,g){var h,i,j=a.imageData,k=.5,l=!1,m=!1,n=c*k,o=e*k,p=b.filterBackend.resources,q=0,r=0,s=c,t=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),h=p.sliceByTwo,(h.width<1.5*c||h.height<e)&&(h.width=1.5*c,h.height=e),i=h.getContext("2d"),i.clearRect(0,0,1.5*c,e),i.putImageData(j,0,0),f=d(f),g=d(g);!l||!m;)c=n,e=o,f<d(n*k)?n=d(n*k):(n=f,l=!0),g<d(o*k)?o=d(o*k):(o=g,m=!0),i.drawImage(h,q,r,c,e,s,t,n,o),q=s,r=t,t+=o;return i.getImageData(q,r,f,g)},lanczosResize:function(a,b,g,h,j){function k(a){var i,y,z,A,B,C,D,E,F,G,H;for(w.x=(a+.5)*p,x.x=d(w.x),i=0;j>i;i++){for(w.y=(i+.5)*q,x.y=d(w.y),B=0,C=0,D=0,E=0,F=0,y=x.x-t;y<=x.x+t;y++)if(!(0>y||y>=b)){G=d(1e3*f(y-w.x)),v[G]||(v[G]={});for(var I=x.y-u;I<=x.y+u;I++)0>I||I>=g||(H=d(1e3*f(I-w.y)),v[G][H]||(v[G][H]=o(e(c(G*r,2)+c(H*s,2))/1e3)),z=v[G][H],z>0&&(A=4*(I*b+y),B+=z,C+=z*l[A],D+=z*l[A+1],E+=z*l[A+2],F+=z*l[A+3]))}A=4*(i*h+a),n[A]=C/B,n[A+1]=D/B,n[A+2]=E/B,n[A+3]=F/B}return++a<h?k(a):m}var l=a.imageData.data,m=a.ctx.createImageData(h,j),n=m.data,o=this.lanczosCreate(this.lanczosLobes),p=this.rcpScaleX,q=this.rcpScaleY,r=2/this.rcpScaleX,s=2/this.rcpScaleY,t=i(p*this.lanczosLobes/2),u=i(q*this.lanczosLobes/2),v={},w={},x={};return k(0)},bilinearFiltering:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=0,u=this.rcpScaleX,v=this.rcpScaleY,w=4*(b-1),x=a.imageData,y=x.data,z=a.ctx.createImageData(e,f),A=z.data;for(m=0;f>m;m++)for(n=0;e>n;n++)for(k=d(u*n),l=d(v*m),o=u*n-k,p=v*m-l,s=4*(l*b+k),q=0;4>q;q++)g=y[s+q],h=y[s+4+q],i=y[s+w+q],j=y[s+w+4+q],r=g*(1-o)*(1-p)+h*o*(1-p)+i*p*(1-o)+j*o*p,A[t++]=r;return z},hermiteFastResize:function(a,b,c,g,h){for(var j=this.rcpScaleX,k=this.rcpScaleY,l=i(j/2),m=i(k/2),n=a.imageData,o=n.data,p=a.ctx.createImageData(g,h),q=p.data,r=0;h>r;r++)for(var s=0;g>s;s++){for(var t=4*(s+r*g),u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=(r+.5)*k,C=d(r*k);(r+1)*k>C;C++)for(var D=f(B-(C+.5))/m,E=(s+.5)*j,F=D*D,G=d(s*j);(s+1)*j>G;G++){var H=f(E-(G+.5))/l,I=e(F+H*H);I>1&&-1>I||(u=2*I*I*I-3*I*I+1,u>0&&(H=4*(G+C*b),A+=u*o[H+3],w+=u,o[H+3]<255&&(u=u*o[H+3]/250),x+=u*o[H],y+=u*o[H+1],z+=u*o[H+2],v+=u))}q[t]=x/v,q[t+1]=y/v,q[t+2]=z/v,q[t+3]=A/w}return p},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Contrast=d(c.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(0!==this.contrast){var b,c,d=a.imageData,e=d.data,c=e.length,f=Math.floor(255*this.contrast),g=259*(f+255)/(255*(259-f));for(b=0;c>b;b+=4)e[b]=g*(e[b]-128)+128,e[b+1]=g*(e[b+1]-128)+128,e[b+2]=g*(e[b+2]-128)+128}},getUniformLocations:function(a,b){return{uContrast:a.getUniformLocation(b,"uContrast")}},sendUniformData:function(a,b){a.uniform1f(b.uContrast,this.contrast)}}),b.Image.filters.Contrast.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Saturation=d(c.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(0!==this.saturation){var b,c,d=a.imageData,e=d.data,f=e.length,g=-this.saturation;for(b=0;f>b;b+=4)c=Math.max(e[b],e[b+1],e[b+2]),e[b]+=c!==e[b]?(c-e[b])*g:0,e[b+1]+=c!==e[b+1]?(c-e[b+1])*g:0,e[b+2]+=c!==e[b+2]?(c-e[b+2])*g:0}},getUniformLocations:function(a,b){return{uSaturation:a.getUniformLocation(b,"uSaturation")}},sendUniformData:function(a,b){a.uniform1f(b.uSaturation,-this.saturation)}}),b.Image.filters.Saturation.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Blur=d(c.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(a){a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},applyTo2d:function(a){a.imageData=this.simpleBlur(a)},simpleBlur:function(a){var c,d,e=a.filterBackend.resources,f=a.imageData.width,g=a.imageData.height;e.blurLayer1||(e.blurLayer1=b.util.createCanvasElement(),e.blurLayer2=b.util.createCanvasElement()),c=e.blurLayer1,d=e.blurLayer2,(c.width!==f||c.height!==g)&&(d.width=c.width=f,d.height=c.height=g);var h,i,j,k,l=c.getContext("2d"),m=d.getContext("2d"),n=15,o=.06*this.blur*.5;for(l.putImageData(a.imageData,0,0),m.clearRect(0,0,f,g),k=-n;n>=k;k++)h=(Math.random()-.5)/4,i=k/n,j=o*i*f+h,m.globalAlpha=1-Math.abs(i),m.drawImage(c,j,h),l.drawImage(d,0,0),m.globalAlpha=1,m.clearRect(0,0,d.width,d.height);for(k=-n;n>=k;k++)h=(Math.random()-.5)/4,i=k/n,j=o*i*g+h,m.globalAlpha=1-Math.abs(i),m.drawImage(c,h,j),l.drawImage(d,0,0),m.globalAlpha=1,m.clearRect(0,0,d.width,d.height);a.ctx.drawImage(c,0,0);var p=a.ctx.getImageData(0,0,c.width,c.height);return l.globalAlpha=1,l.clearRect(0,0,c.width,c.height),p},getUniformLocations:function(a,b){return{delta:a.getUniformLocation(b,"uDelta")}},sendUniformData:function(a,b){var c=this.chooseRightDelta();a.uniform2fv(b.delta,c)},chooseRightDelta:function(){var a,b=1,c=[0,0];return this.horizontal?this.aspectRatio>1&&(b=1/this.aspectRatio):this.aspectRatio<1&&(b=this.aspectRatio),a=b*this.blur*.12,this.horizontal?c[0]=a:c[1]=a,c}}),c.Blur.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Gamma=d(c.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(a){this.gamma=[1,1,1],c.BaseFilter.prototype.initialize.call(this,a)},applyTo2d:function(a){var b,c=a.imageData,d=c.data,e=this.gamma,f=d.length,g=1/e[0],h=1/e[1],i=1/e[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),b=0,f=256;f>b;b++)this.rVals[b]=255*Math.pow(b/255,g),this.gVals[b]=255*Math.pow(b/255,h),this.bVals[b]=255*Math.pow(b/255,i);for(b=0,f=d.length;f>b;b+=4)d[b]=this.rVals[d[b]],d[b+1]=this.gVals[d[b+1]],d[b+2]=this.bVals[d[b+2]]},getUniformLocations:function(a,b){return{uGamma:a.getUniformLocation(b,"uGamma")}},sendUniformData:function(a,b){a.uniform3fv(b.uGamma,this.gamma)}}),b.Image.filters.Gamma.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Composed=d(c.BaseFilter,{type:"Composed",subFilters:[],initialize:function(a){this.callSuper("initialize",a),this.subFilters=this.subFilters.slice(0)},applyTo:function(a){a.passes+=this.subFilters.length-1,this.subFilters.forEach(function(b){b.applyTo(a)})},toObject:function(){return b.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(a){return a.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(a){return!a.isNeutralState()})}}),b.Image.filters.Composed.fromObject=function(a,c){var d=a.subFilters||[],e=d.map(function(a){return new b.Image.filters[a.type](a)}),f=new b.Image.filters.Composed({subFilters:e});return c&&c(f),f}}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.HueRotation=d(c.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,c=b.util.cos(a),d=b.util.sin(a),e=1/3,f=Math.sqrt(e)*d,g=1-c;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=c+g/3,this.matrix[1]=e*g-f,this.matrix[2]=e*g+f,this.matrix[5]=e*g+f,this.matrix[6]=c+e*g,this.matrix[7]=e*g-f,this.matrix[10]=e*g-f,this.matrix[11]=e*g+f,this.matrix[12]=c+e*g},isNeutralState:function(a){return this.calculateMatrix(),c.BaseFilter.prototype.isNeutralState.call(this,a)},applyTo:function(a){this.calculateMatrix(),c.BaseFilter.prototype.applyTo.call(this,a)}}),b.Image.filters.HueRotation.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.clone;return b.Text?void b.warn("fabric.Text is already defined"):(b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:b.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:b.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(a,b){this.styles=b?b.styles||{}:{},this.text=a,this.__skipDimension=!0,this.callSuper("initialize",b),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return b._measuringContext||(b._measuringContext=this.canvas&&this.canvas.contextCache||b.util.createCanvasElement().getContext("2d")),b._measuringContext},_splitText:function(){var a=this._splitTextIntoLines(this.text);return this.textLines=a.lines,this._textLines=a.graphemeLines,this._unwrappedTextLines=a._unwrappedLines,this._text=a.graphemeText,a},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var a,b,c,d,e,f,g,h=0,i=this._textLines.length;i>h;h++)if(("justify"===this.textAlign||h!==i-1&&!this.isEndOfWrapping(h))&&(d=0,e=this._textLines[h],b=this.getLineWidth(h),b<this.width&&(g=this.textLines[h].match(this._reSpacesAndTabs)))){c=g.length,a=(this.width-b)/c;for(var j=0,k=e.length;k>=j;j++)f=this.__charBounds[h][j],this._reSpaceAndTab.test(e[j])?(f.width+=a,f.kernedWidth+=a,f.left+=d,d+=a):f.left+=d}},isEndOfWrapping:function(a){return a===this._textLines.length-1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),b=this.fontSize;return a.width+=b*a.zoomX,a.height+=b*a.zoomY,a},_render:function(a){this._setTextStyles(a),this._renderTextLinesBackground(a),this._renderTextDecoration(a,"underline"),this._renderText(a),this._renderTextDecoration(a,"overline"),this._renderTextDecoration(a,"linethrough")},_renderText:function(a){"stroke"===this.paintFirst?(this._renderTextStroke(a),this._renderTextFill(a)):(this._renderTextFill(a),this._renderTextStroke(a))},_setTextStyles:function(a,b,c){a.textBaseline="alphabetic",a.font=this._getFontDeclaration(b,c)},calcTextWidth:function(){for(var a=this.getLineWidth(0),b=1,c=this._textLines.length;c>b;b++){var d=this.getLineWidth(b);d>a&&(a=d)}return a},_renderTextLine:function(a,b,c,d,e,f){this._renderChars(a,b,c,d,e,f)},_renderTextLinesBackground:function(a){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var b,c,d,e,f,g,h=0,i=a.fillStyle,j=this._getLeftOffset(),k=this._getTopOffset(),l=0,m=0,n=0,o=this._textLines.length;o>n;n++)if(b=this.getHeightOfLine(n),this.textBackgroundColor||this.styleHas("textBackgroundColor",n)){d=this._textLines[n],c=this._getLineLeftOffset(n),m=0,l=0,e=this.getValueOfPropertyAt(n,0,"textBackgroundColor");for(var p=0,q=d.length;q>p;p++)f=this.__charBounds[n][p],g=this.getValueOfPropertyAt(n,p,"textBackgroundColor"),g!==e?(a.fillStyle=e,e&&a.fillRect(j+c+l,k+h,m,b/this.lineHeight),l=f.left,m=f.width,e=g):m+=f.kernedWidth;g&&(a.fillStyle=g,a.fillRect(j+c+l,k+h,m,b/this.lineHeight)),h+=b}else h+=b;a.fillStyle=i,this._removeShadow(a)}},getFontCache:function(a){var c=a.fontFamily.toLowerCase();b.charWidthsCache[c]||(b.charWidthsCache[c]={});var d=b.charWidthsCache[c],e=a.fontStyle.toLowerCase()+"_"+(a.fontWeight+"").toLowerCase();return d[e]||(d[e]={}),d[e]},_applyCharStyles:function(a,b,c,d,e){this._setFillStyles(b,e),this._setStrokeStyles(b,e),b.font=this._getFontDeclaration(e)},_measureChar:function(a,b,c,d){var e,f,g,h,i=this.getFontCache(b),j=this._getFontDeclaration(b),k=this._getFontDeclaration(d),l=c+a,m=j===k,n=b.fontSize/this.CACHE_FONT_SIZE;if(c&&void 0!==i[c]&&(g=i[c]),void 0!==i[a]&&(h=e=i[a]),m&&void 0!==i[l]&&(f=i[l],h=f-g),void 0===e||void 0===g||void 0===f){var o=this.getMeasuringContext();this._setTextStyles(o,b,!0)}return void 0===e&&(h=e=o.measureText(a).width,i[a]=e),void 0===g&&m&&c&&(g=o.measureText(c).width,i[c]=g),m&&void 0===f&&(f=o.measureText(l).width,i[l]=f,h=f-g),{width:e*n,kernedWidth:h*n}},getHeightOfChar:function(a,b){return this.getValueOfPropertyAt(a,b,"fontSize")},measureLine:function(a){var b=this._measureLine(a);return 0!==this.charSpacing&&(b.width-=this._getWidthOfCharSpacing()),b.width<0&&(b.width=0),b},_measureLine:function(a){var b,c,d,e,f=0,g=this._textLines[a],h=0,i=new Array(g.length);for(this.__charBounds[a]=i,b=0;b<g.length;b++)c=g[b],e=this._getGraphemeBox(c,a,b,d),i[b]=e,f+=e.kernedWidth,d=c;return i[b]={left:e?e.left+e.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:f,numOfSpaces:h}},_getGraphemeBox:function(a,b,c,d,e){var f,g=this.getCompleteStyleDeclaration(b,c),h=d?this.getCompleteStyleDeclaration(b,c-1):{},i=this._measureChar(a,g,d,h),j=i.kernedWidth,k=i.width;0!==this.charSpacing&&(f=this._getWidthOfCharSpacing(),k+=f,j+=f);var l={width:k,left:0,height:g.fontSize,kernedWidth:j,deltaY:g.deltaY};if(c>0&&!e){var m=this.__charBounds[b][c-1];l.left=m.left+m.width+i.kernedWidth-i.width}return l},getHeightOfLine:function(a){if(this.__lineHeights[a])return this.__lineHeights[a];for(var b=this._textLines[a],c=this.getHeightOfChar(a,0),d=1,e=b.length;e>d;d++)c=Math.max(this.getHeightOfChar(a,d),c);return this.__lineHeights[a]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var a,b=0,c=0,d=this._textLines.length;d>c;c++)a=this.getHeightOfLine(c),b+=c===d-1?a/this.lineHeight:a;return b},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(a,b){a.save();for(var c=0,d=this._getLeftOffset(),e=this._getTopOffset(),f=this._applyPatternGradientTransform(a,"fillText"===b?this.fill:this.stroke),g=0,h=this._textLines.length;h>g;g++){var i=this.getHeightOfLine(g),j=i/this.lineHeight,k=this._getLineLeftOffset(g);this._renderTextLine(b,a,this._textLines[g],d+k-f.offsetX,e+c+j-f.offsetY,g),c+=i}a.restore()},_renderTextFill:function(a){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())},_renderChars:function(a,b,c,d,e,f){var g,h,i,j,k=this.getHeightOfLine(f),l=-1!==this.textAlign.indexOf("justify"),m="",n=0,o=!l&&0===this.charSpacing&&this.isEmptyStyles(f);if(b.save(),e-=k*this._fontSizeFraction/this.lineHeight,o)return this._renderChar(a,b,f,0,this.textLines[f],d,e,k),void b.restore();for(var p=0,q=c.length-1;q>=p;p++)j=p===q||this.charSpacing,m+=c[p],i=this.__charBounds[f][p],0===n?(d+=i.kernedWidth-i.width,n+=i.width):n+=i.kernedWidth,l&&!j&&this._reSpaceAndTab.test(c[p])&&(j=!0),j||(g=g||this.getCompleteStyleDeclaration(f,p),h=this.getCompleteStyleDeclaration(f,p+1),j=this._hasStyleChanged(g,h)),j&&(this._renderChar(a,b,f,p,m,d,e,k),m="",g=h,d+=n,n=0);b.restore()},_renderChar:function(a,b,c,d,e,f,g){var h=this._getStyleDeclaration(c,d),i=this.getCompleteStyleDeclaration(c,d),j="fillText"===a&&i.fill,k="strokeText"===a&&i.stroke&&i.strokeWidth;(k||j)&&(h&&b.save(),this._applyCharStyles(a,b,c,d,i),h&&h.textBackgroundColor&&this._removeShadow(b),h&&h.deltaY&&(g+=h.deltaY),j&&b.fillText(e,f,g),k&&b.strokeText(e,f,g),h&&b.restore())},setSuperscript:function(a,b){return this._setScript(a,b,this.superscript)},setSubscript:function(a,b){return this._setScript(a,b,this.subscript)},_setScript:function(a,b,c){var d=this.get2DCursorLocation(a,!0),e=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),f=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),g={fontSize:e*c.size,deltaY:f+e*c.baseline};return this.setSelectionStyles(g,a,b),this},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth||a.fontSize!==b.fontSize||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.deltaY!==b.deltaY},_hasStyleChangedForSvg:function(a,b){return this._hasStyleChanged(a,b)||a.overline!==b.overline||a.underline!==b.underline||a.linethrough!==b.linethrough},_getLineLeftOffset:function(a){var b=this.getLineWidth(a);return"center"===this.textAlign?(this.width-b)/2:"right"===this.textAlign?this.width-b:"justify-center"===this.textAlign&&this.isEndOfWrapping(a)?(this.width-b)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(a)?this.width-b:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;return a||(a=this.hasStateChanged("_dimensionAffectingProps")),a&&(this.dirty=!0,this._forceClearCache=!1),a},getLineWidth:function(a){if(this.__lineWidths[a])return this.__lineWidths[a];var b,c,d=this._textLines[a];return""===d?b=0:(c=this.measureLine(a),b=c.width),this.__lineWidths[a]=b,b},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(a,b,c){var d=this._getStyleDeclaration(a,b);return d&&"undefined"!=typeof d[c]?d[c]:this[c]},_renderTextDecoration:function(a,b){if(this[b]||this.styleHas(b)){for(var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this._getLeftOffset(),t=this._getTopOffset(),u=this._getWidthOfCharSpacing(),v=0,w=this._textLines.length;w>v;v++)if(c=this.getHeightOfLine(v),this[b]||this.styleHas(b,v)){i=this._textLines[v],p=c/this.lineHeight,f=this._getLineLeftOffset(v),l=0,m=0,j=this.getValueOfPropertyAt(v,0,b),r=this.getValueOfPropertyAt(v,0,"fill"),k=t+p*(1-this._fontSizeFraction),d=this.getHeightOfChar(v,0),g=this.getValueOfPropertyAt(v,0,"deltaY");for(var x=0,y=i.length;y>x;x++)n=this.__charBounds[v][x],o=this.getValueOfPropertyAt(v,x,b),q=this.getValueOfPropertyAt(v,x,"fill"),e=this.getHeightOfChar(v,x),h=this.getValueOfPropertyAt(v,x,"deltaY"),(o!==j||q!==r||e!==d||h!==g)&&m>0?(a.fillStyle=r,j&&r&&a.fillRect(s+f+l,k+this.offsets[b]*d+g,m,this.fontSize/15),l=n.left,m=n.width,j=o,r=q,d=e,g=h):m+=n.kernedWidth;a.fillStyle=q,o&&q&&a.fillRect(s+f+l,k+this.offsets[b]*d+g,m-u,this.fontSize/15),t+=c}else t+=c;this._removeShadow(a)}},_getFontDeclaration:function(a,c){var d=a||this,e=this.fontFamily,f=b.Text.genericFonts.indexOf(e.toLowerCase())>-1,g=void 0===e||e.indexOf("'")>-1||e.indexOf('"')>-1||f?d.fontFamily:'"'+d.fontFamily+'"';return[b.isLikelyNode?d.fontWeight:d.fontStyle,b.isLikelyNode?d.fontStyle:d.fontWeight,c?this.CACHE_FONT_SIZE+"px":d.fontSize+"px",g].join(" ")},render:function(a){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",a))},_splitTextIntoLines:function(a){for(var c=a.split(this._reNewline),d=new Array(c.length),e=["\n"],f=[],g=0;g<c.length;g++)d[g]=b.util.string.graphemeSplit(c[g]),f=f.concat(d[g],e);return f.pop(),{_unwrappedLines:d,lines:c,graphemeText:f,graphemeLines:d}},toObject:function(a){var b=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(a),d=this.callSuper("toObject",b);return d.styles=c(this.styles,!0),d;
},set:function(a,b){this.callSuper("set",a,b);var c=!1;if("object"==typeof a)for(var d in a)c=c||-1!==this._dimensionAffectingProps.indexOf(d);else c=-1!==this._dimensionAffectingProps.indexOf(a);return c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,d,e){if(!a)return d(null);var f=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES),g=f.textAnchor||"left";if(e=b.util.object.extend(e?c(e):{},f),e.top=e.top||0,e.left=e.left||0,f.textDecoration){var h=f.textDecoration;-1!==h.indexOf("underline")&&(e.underline=!0),-1!==h.indexOf("overline")&&(e.overline=!0),-1!==h.indexOf("line-through")&&(e.linethrough=!0),delete e.textDecoration}"dx"in f&&(e.left+=f.dx),"dy"in f&&(e.top+=f.dy),"fontSize"in e||(e.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE);var i="";"textContent"in a?i=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(i=a.firstChild.data),i=i.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var j=e.strokeWidth;e.strokeWidth=0;var k=new b.Text(i,e),l=k.getScaledHeight()/k.height,m=(k.height+k.strokeWidth)*k.lineHeight-k.height,n=m*l,o=k.getScaledHeight()+n,p=0;"center"===g&&(p=k.getScaledWidth()/2),"right"===g&&(p=k.getScaledWidth()),k.set({left:k.left-p,top:k.top-(o-k.fontSize*(.07+k._fontSizeFraction))/k.lineHeight,strokeWidth:"undefined"!=typeof j?j:1}),d(k)},b.Text.fromObject=function(a,c){return b.Object._fromObject("Text",a,c,"text")},b.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],void(b.util.createAccessors&&b.util.createAccessors(b.Text)))}("undefined"!=typeof exports?exports:this),!function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(a){if(!this.styles)return!0;if("undefined"!=typeof a&&!this.styles[a])return!0;var b="undefined"==typeof a?this.styles:{line:this.styles[a]};for(var c in b)for(var d in b[c])for(var e in b[c][d])return!1;return!0},styleHas:function(a,b){if(!this.styles||!a||""===a)return!1;if("undefined"!=typeof b&&!this.styles[b])return!1;var c="undefined"==typeof b?this.styles:{line:this.styles[b]};for(var d in c)for(var e in c[d])if("undefined"!=typeof c[d][e][a])return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||""===a)return!1;var b,c,d,e=this.styles,f=0,g=!0,h=0;for(var i in e){b=0;for(var j in e[i]){var d=e[i][j],k=d.hasOwnProperty(a);f++,k?(c?d[a]!==c&&(g=!1):c=d[a],d[a]===this[a]&&delete d[a]):g=!1,0!==Object.keys(d).length?b++:delete e[i][j]}0===b&&delete e[i]}for(var l=0;l<this._textLines.length;l++)h+=this._textLines[l].length;g&&f===h&&(this[a]=c,this.removeStyle(a))},removeStyle:function(a){if(this.styles&&a&&""!==a){var b,c,d,e=this.styles;for(c in e){b=e[c];for(d in b)delete b[d][a],0===Object.keys(b[d]).length&&delete b[d];0===Object.keys(b).length&&delete e[c]}}},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex,{}),this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),b)},get2DCursorLocation:function(a,b){"undefined"==typeof a&&(a=this.selectionStart);for(var c=b?this._unwrappedTextLines:this._textLines,d=c.length,e=0;d>e;e++){if(a<=c[e].length)return{lineIndex:e,charIndex:a};a-=c[e].length+1}return{lineIndex:e-1,charIndex:c[e-1].length<a?c[e-1].length:a}},getSelectionStyles:function(a,b,c){"undefined"==typeof a&&(a=this.selectionStart||0),"undefined"==typeof b&&(b=this.selectionEnd||a);for(var d=[],e=a;b>e;e++)d.push(this.getStyleAtPosition(e,c));return d},getStyleAtPosition:function(a,b){var c=this.get2DCursorLocation(a),d=b?this.getCompleteStyleDeclaration(c.lineIndex,c.charIndex):this._getStyleDeclaration(c.lineIndex,c.charIndex);return d||{}},setSelectionStyles:function(a,b,c){"undefined"==typeof b&&(b=this.selectionStart||0),"undefined"==typeof c&&(c=this.selectionEnd||b);for(var d=b;c>d;d++)this._extendStyles(d,a);return this._forceClearCache=!0,this},_getStyleDeclaration:function(a,b){var c=this.styles&&this.styles[a];return c?c[b]:null},getCompleteStyleDeclaration:function(a,b){for(var c,d=this._getStyleDeclaration(a,b)||{},e={},f=0;f<this._styleProperties.length;f++)c=this._styleProperties[f],e[c]="undefined"==typeof d[c]?this[c]:d[c];return e},_setStyleDeclaration:function(a,b,c){this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[a]},_setLineStyle:function(a,b){this.styles[a]=b},_deleteLineStyle:function(a){delete this.styles[a]}})}(),!function(){function a(a){a.textDecoration&&(a.textDecoration.indexOf("underline")>-1&&(a.underline=!0),a.textDecoration.indexOf("line-through")>-1&&(a.linethrough=!0),a.textDecoration.indexOf("overline")>-1&&(a.overline=!0),delete a.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(a,b){this.callSuper("initialize",a,b),this.initBehavior()},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,b){this[a]!==b&&(this._fireSelectionChanged(),this[a]=b),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(a){this.clearContextTop(),this.callSuper("render",a),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a)},clearContextTop:function(a){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save(),b.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._clearTextArea(b),a||b.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas){var a,b=this._getCursorBoundaries();this.canvas&&this.canvas.contextTop?(a=this.canvas.contextTop,this.clearContextTop(!0)):(a=this.canvas.contextContainer,a.save()),this.selectionStart===this.selectionEnd?this.renderCursor(b,a):this.renderSelection(b,a),a.restore()}},_clearTextArea:function(a){var b=this.width+4,c=this.height+4;a.clearRect(-b/2,-c/2,b,c)},_getCursorBoundaries:function(a){"undefined"==typeof a&&(a=this.selectionStart);var b=this._getLeftOffset(),c=this._getTopOffset(),d=this._getCursorBoundariesOffsets(a);return{left:b,top:c,leftOffset:d.left,topOffset:d.top}},_getCursorBoundariesOffsets:function(a){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var b,c,d,e,f=0,g=0,h=this.get2DCursorLocation(a);d=h.charIndex,c=h.lineIndex;for(var i=0;c>i;i++)f+=this.getHeightOfLine(i);b=this._getLineLeftOffset(c);var j=this.__charBounds[c][d];return j&&(g=j.left),0!==this.charSpacing&&d===this._textLines[c].length&&(g-=this._getWidthOfCharSpacing()),e={top:f,left:b+(g>0?g:0)},this.cursorOffsetCache=e,this.cursorOffsetCache},renderCursor:function(a,b){var c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex>0?c.charIndex-1:0,f=this.getValueOfPropertyAt(d,e,"fontSize"),g=this.scaleX*this.canvas.getZoom(),h=this.cursorWidth/g,i=a.topOffset,j=this.getValueOfPropertyAt(d,e,"deltaY");i+=(1-this._fontSizeFraction)*this.getHeightOfLine(d)/this.lineHeight-f*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(a,b),b.fillStyle=this.getValueOfPropertyAt(d,e,"fill"),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(a.left+a.leftOffset-h/2,i+a.top+j,h,f)},renderSelection:function(a,b){for(var c=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,d=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,e=-1!==this.textAlign.indexOf("justify"),f=this.get2DCursorLocation(c),g=this.get2DCursorLocation(d),h=f.lineIndex,i=g.lineIndex,j=f.charIndex<0?0:f.charIndex,k=g.charIndex<0?0:g.charIndex,l=h;i>=l;l++){var m=this._getLineLeftOffset(l)||0,n=this.getHeightOfLine(l),o=0,p=0,q=0;if(l===h&&(p=this.__charBounds[h][j].left),l>=h&&i>l)q=e&&!this.isEndOfWrapping(l)?this.width:this.getLineWidth(l)||5;else if(l===i)if(0===k)q=this.__charBounds[i][k].left;else{var r=this._getWidthOfCharSpacing();q=this.__charBounds[i][k-1].left+this.__charBounds[i][k-1].width-r}o=n,(this.lineHeight<1||l===i&&this.lineHeight>1)&&(n/=this.lineHeight),this.inCompositionMode?(b.fillStyle=this.compositionColor||"black",b.fillRect(a.left+m+p,a.top+a.topOffset+n,q-p,1)):(b.fillStyle=this.selectionColor,b.fillRect(a.left+m+p,a.top+a.topOffset,q-p,n)),a.topOffset+=o}},getCurrentCharFontSize:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")},getCurrentCharColor:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fill")},_getCurrentCharIndex:function(){var a=this.get2DCursorLocation(this.selectionStart,!0),b=a.charIndex>0?a.charIndex-1:0;return{l:a.lineIndex,c:b}}}),fabric.IText.fromObject=function(b,c){if(a(b),b.styles)for(var d in b.styles)for(var e in b.styles[d])a(b.styles[d][e]);fabric.Object._fromObject("IText",b,c,"text")}}(),!function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var a=this;this.on("added",function(){var b=a.canvas;b&&(b._hasITextHandlers||(b._hasITextHandlers=!0,a._initCanvasHandlers(b)),b._iTextInstances=b._iTextInstances||[],b._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){var b=a.canvas;b&&(b._iTextInstances=b._iTextInstances||[],fabric.util.removeFromArray(b._iTextInstances,a),0===b._iTextInstances.length&&(b._hasITextHandlers=!1,a._removeCanvasHandlers(b)))})},_initCanvasHandlers:function(a){a._mouseUpITextHandler=function(){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.__isMousedown=!1})},a.on("mouse:up",a._mouseUpITextHandler)},_removeCanvasHandlers:function(a){a.off("mouse:up",a._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,b,c,d){var e;return e={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",b,{duration:c,onComplete:function(){e.isAborted||a[d]()},onChange:function(){a.canvas&&a.selectionStart===a.selectionEnd&&a.renderCursorOrSelection()},abort:function(){return e.isAborted}}),e},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var b=this,c=a?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){b._tick()},c)},abortCursorAnimation:function(){var a=this._currentTickState||this._currentTickCompleteState,b=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,a&&b&&b.clearContext(b.contextTop||b.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(a){var b=0,c=a-1;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)b++,c--;for(;/\S/.test(this._text[c])&&c>-1;)b++,c--;return a-b},findWordBoundaryRight:function(a){var b=0,c=a;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)b++,c++;for(;/\S/.test(this._text[c])&&c<this.text.length;)b++,c++;return a+b},findLineBoundaryLeft:function(a){for(var b=0,c=a-1;!/\n/.test(this._text[c])&&c>-1;)b++,c--;return a-b},findLineBoundaryRight:function(a){for(var b=0,c=a;!/\n/.test(this._text[c])&&c<this.text.length;)b++,c++;return a+b},searchWordBoundary:function(a,b){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,d=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(d)&&c>0&&c<this.text.length;)c+=b,d=this.text.charAt(c);return e.test(d)&&"\n"!==d&&(c+=1===b?0:1),c},selectWord:function(a){a=a||this.selectionStart;var b=this.searchWordBoundary(a,-1),c=this.searchWordBoundary(a,1);this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(a){a=a||this.selectionStart;var b=this.findLineBoundaryLeft(a),c=this.findLineBoundaryRight(a);return this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(a){return!this.isEditing&&this.editable?(this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(a),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this):void 0},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(a){if(this.__isMousedown&&this.isEditing){var b=this.getSelectionStartFromPointer(a.e),c=this.selectionStart,d=this.selectionEnd;(b===this.__selectionStartOnMouseDown&&c!==d||c!==b&&d!==b)&&(b>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=b):(this.selectionStart=b,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==c||this.selectionEnd!==d)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(a,b,c){var d=c.slice(0,a),e=fabric.util.string.graphemeSplit(d).length;if(a===b)return{selectionStart:e,selectionEnd:e};var f=c.slice(a,b),g=fabric.util.string.graphemeSplit(f).length;return{selectionStart:e,selectionEnd:e+g}},fromGraphemeToStringSelection:function(a,b,c){var d=c.slice(0,a),e=d.join("").length;if(a===b)return{selectionStart:e,selectionEnd:e};var f=c.slice(a,b),g=f.join("").length;return{selectionStart:e,selectionEnd:e+g}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var a=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=a.selectionStart,this.hiddenTextarea.selectionEnd=a.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var a=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=a.selectionEnd,this.inCompositionMode||(this.selectionStart=a.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var a=this.inCompositionMode?this.compositionStart:this.selectionStart,b=this._getCursorBoundaries(a),c=this.get2DCursorLocation(a),d=c.lineIndex,e=c.charIndex,f=this.getValueOfPropertyAt(d,e,"fontSize")*this.lineHeight,g=b.leftOffset,h=this.calcTransformMatrix(),i={x:b.left+g,y:b.top+b.topOffset+f},j=this.canvas.upperCanvasEl,k=j.width,l=j.height,m=k-f,n=l-f,o=j.clientWidth/k,p=j.clientHeight/l;return i=fabric.util.transformPoint(i,h),i=fabric.util.transformPoint(i,this.canvas.viewportTransform),i.x*=o,i.y*=p,i.x<0&&(i.x=0),i.x>m&&(i.x=m),i.y<0&&(i.y=0),i.y>n&&(i.y=n),i.x+=this.canvas._offset.left,i.y+=this.canvas._offset.top,{left:i.x+"px",top:i.y+"px",fontSize:f+"px",charHeight:f}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var a=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),a&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},removeStyleFromTo:function(a,b){var c,d,e=this.get2DCursorLocation(a,!0),f=this.get2DCursorLocation(b,!0),g=e.lineIndex,h=e.charIndex,i=f.lineIndex,j=f.charIndex;if(g!==i){if(this.styles[g])for(c=h;c<this._unwrappedTextLines[g].length;c++)delete this.styles[g][c];if(this.styles[i])for(c=j;c<this._unwrappedTextLines[i].length;c++)d=this.styles[i][c],d&&(this.styles[g]||(this.styles[g]={}),this.styles[g][h+c-j]=d);for(c=g+1;i>=c;c++)delete this.styles[c];this.shiftLineStyles(i,g-i)}else if(this.styles[g]){d=this.styles[g];var k,l,m=j-h;for(c=h;j>c;c++)delete d[c];for(l in this.styles[g])k=parseInt(l,10),k>=j&&(d[k-m]=d[l],delete d[l])}},shiftLineStyles:function(b,c){var d=a(this.styles);for(var e in this.styles){var f=parseInt(e,10);f>b&&(this.styles[f+c]=d[f],d[f-c]||delete this.styles[f])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(b,c,d,e){var f,g={},h=!1;d||(d=1),this.shiftLineStyles(b,d),this.styles[b]&&(f=this.styles[b][0===c?c:c-1]);for(var i in this.styles[b]){var j=parseInt(i,10);j>=c&&(h=!0,g[j-c]=this.styles[b][i],delete this.styles[b][i])}for(h?this.styles[b+d]=g:delete this.styles[b+d];d>1;)d--,e&&e[d]?this.styles[b+d]={0:a(e[d])}:f?this.styles[b+d]={0:a(f)}:delete this.styles[b+d];this._forceClearCache=!0},insertCharStyleObject:function(b,c,d,e){this.styles||(this.styles={});var f=this.styles[b],g=f?a(f):{};d||(d=1);for(var h in g){var i=parseInt(h,10);i>=c&&(f[i+d]=g[i],g[i-d]||delete f[i])}if(this._forceClearCache=!0,e)for(;d--;)Object.keys(e[d]).length&&(this.styles[b]||(this.styles[b]={}),this.styles[b][c+d]=a(e[d]));else if(f)for(var j=f[c?c-1:1];j&&d--;)this.styles[b][c+d]=a(j)},insertNewStyleBlock:function(a,b,c){for(var d=this.get2DCursorLocation(b,!0),e=[0],f=0,g=0;g<a.length;g++)"\n"===a[g]?(f++,e[f]=0):e[f]++;e[0]>0&&(this.insertCharStyleObject(d.lineIndex,d.charIndex,e[0],c),c=c&&c.slice(e[0]+1)),f&&this.insertNewlineStyleObject(d.lineIndex,d.charIndex+e[0],f);for(var g=1;f>g;g++)e[g]>0?this.insertCharStyleObject(d.lineIndex+g,0,e[g],c):c&&(this.styles[d.lineIndex+g][0]=c[0]),c=c&&c.slice(e[g]+1);e[g]>0&&this.insertCharStyleObject(d.lineIndex+g,0,e[g],c)},setSelectionStartEndWithShift:function(a,b,c){a>=c?(b===a?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=a),this.selectionStart=c):c>a&&b>c?"right"===this._selectionDirection?this.selectionEnd=c:this.selectionStart=c:(b===a?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=b),this.selectionEnd=c)},setSelectionInBoundaries:function(){var a=this.text.length;this.selectionStart>a?this.selectionStart=a:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>a?this.selectionEnd=a:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(this.canvas){this.__newClickTime=+new Date;var b=a.pointer;this.isTripleClick(b)&&(this.fire("tripleclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=b,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("mousedblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},_mouseDownHandler:function(a){!this.canvas||!this.editable||a.e.button&&1!==a.e.button||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(a.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(a){!this.canvas||!this.editable||a.e.button&&1!==a.e.button||this===this.canvas._activeObject&&(this.selected=!0)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){if(this.__isMousedown=!1,!(!this.editable||this.group||a.transform&&a.transform.actionPerformed||a.e.button&&1!==a.e.button)){if(this.canvas){var b=this.canvas._activeObject;if(b&&b!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(a){var b=this.getSelectionStartFromPointer(a),c=this.selectionStart,d=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(c,d,b):(this.selectionStart=b,this.selectionEnd=b),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var b,c,d=this.getLocalPointer(a),e=0,f=0,g=0,h=0,i=0,j=0,k=this._textLines.length;k>j&&g<=d.y;j++)g+=this.getHeightOfLine(j)*this.scaleY,i=j,j>0&&(h+=this._textLines[j-1].length+1);b=this._getLineLeftOffset(i),f=b*this.scaleX,c=this._textLines[i];for(var l=0,m=c.length;m>l&&(e=f,f+=this.__charBounds[i][l].kernedWidth*this.scaleX,f<=d.x);l++)h++;return this._getNewSelectionStartFromOffset(d,e,f,h,m)},_getNewSelectionStartFromOffset:function(a,b,c,d,e){var f=a.x-b,g=c-a.x,h=g>f||0>g?0:1,i=d+h;return this.flipX&&(i=e-i),i>this._text.length&&(i=this._text.length),i}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+a.fontSize+";",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing&&!this.inCompositionMode){if(a.keyCode in this.keysMap)this[this.keysMap[a.keyCode]](a);else{if(!(a.keyCode in this.ctrlKeysMapDown&&(a.ctrlKey||a.metaKey)))return;this[this.ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){return!this.isEditing||this._copyDone||this.inCompositionMode?void(this._copyDone=!1):void(a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this.ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll()))},onInput:function(a){var b=this.fromPaste;if(this.fromPaste=!1,a&&a.stopPropagation(),this.isEditing){var c,d,e=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,g=e.length,h=g-f;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var i=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),j=this.selectionStart>i.selectionStart;this.selectionStart!==this.selectionEnd?(c=this._text.slice(this.selectionStart,this.selectionEnd),h+=this.selectionEnd-this.selectionStart):f>g&&(c=j?this._text.slice(this.selectionEnd+h,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-h)),d=e.slice(i.selectionEnd-h,i.selectionEnd),c&&c.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):j?this.removeStyleFromTo(this.selectionEnd-c.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+c.length)),d.length&&(b&&d.join("")===fabric.copiedText?this.insertNewStyleBlock(d,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(d,this.selectionStart)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart,this.compositionEnd=a.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(a){return a&&a.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(a,b){var c,d=this._getLineLeftOffset(a);return b>0&&(c=this.__charBounds[a][b-1],d+=c.left+c.width),d},getDownCursorOffset:function(a,b){var c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(e===this._textLines.length-1||a.metaKey||34===a.keyCode)return this._text.length-c;var f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e+1,g),i=this._textLines[e].slice(f);return i.length+h+2},_getSelectionForOffset:function(a,b){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,b){var c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(0===e||a.metaKey||33===a.keyCode)return-c;var f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e-1,g),i=this._textLines[e].slice(0,f);return-this._textLines[e-1].length+h-i.length},_getIndexOnLine:function(a,b){for(var c,d,e=this._textLines[a],f=this._getLineLeftOffset(a),g=f,h=0,i=0,j=e.length;j>i;i++)if(c=this.__charBounds[a][i].width,g+=c,g>b){d=!0;var k=g-c,l=g,m=Math.abs(k-b),n=Math.abs(l-b);h=m>n?i:i-1;break}return d||(h=e.length-1),h},moveCursorDown:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,b){var c="get"+a+"CursorOffset",d=this[c](b,"right"===this._selectionDirection);b.shiftKey?this.moveCursorWithShift(d):this.moveCursorWithoutShift(d),0!==d&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){
var b="left"===this._selectionDirection?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,b),0!==a},moveCursorWithoutShift:function(a){return 0>a?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),0!==a},moveCursorLeft:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorLeftOrRight("Left",a)},_move:function(a,b,c){var d;if(a.altKey)d=this["findWordBoundary"+c](this[b]);else{if(!a.metaKey&&35!==a.keyCode&&36!==a.keyCode)return this[b]+="Left"===c?-1:1,!0;d=this["findLineBoundary"+c](this[b])}return void 0!==typeof d&&this[b]!==d?(this[b]=d,!0):void 0},_moveLeft:function(a,b){return this._move(a,b,"Left")},_moveRight:function(a,b){return this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){var b=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,b},moveCursorLeftWithShift:function(a){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(a,"selectionStart")):void 0},moveCursorRight:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,b){var c="moveCursor"+a+"With";this._currentCursorOpacity=1,c+=b.shiftKey?"Shift":"outShift",this[c](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(a,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(a){var b=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(b=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,b},removeChars:function(a,b){"undefined"==typeof b&&(b=a+1),this.removeStyleFromTo(a,b),this._text.splice(a,b-a),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(a,b,c,d){"undefined"==typeof d&&(d=c),d>c&&this.removeStyleFromTo(c,d);var e=fabric.util.string.graphemeSplit(a);this.insertNewStyleBlock(e,c,b),this._text=[].concat(this._text.slice(0,c),e,this._text.slice(d)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),!function(){var a=fabric.util.toFixed,b=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{toSVG:function(a){var b=this._getSVGLeftTopOffsets(),c=this._getSVGTextAndBg(b.textTop,b.textLeft),d=this._wrapSVGTextAndBg(c);return this._createBaseSVGMarkup(d,{reviver:a,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var b=!0,c=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",c?'text-decoration="'+c+'" ':"",'style="',this.getSvgStyles(b),'"',this.addPaintOrder()," >",a.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(a,b){var c,d=[],e=[],f=a;this._setSVGBg(e);for(var g=0,h=this._textLines.length;h>g;g++)c=this._getLineLeftOffset(g),(this.textBackgroundColor||this.styleHas("textBackgroundColor",g))&&this._setSVGTextLineBg(e,g,b+c,f),this._setSVGTextLineText(d,g,b+c,f),f+=this.getHeightOfLine(g);return{textSpans:d,textBgRects:e}},_createTextCharSpan:function(c,d,e,f){var g=c!==c.trim()||c.match(b),h=this.getSvgSpanStyles(d,g),i=h?'style="'+h+'"':"",j=d.deltaY,k="",l=fabric.Object.NUM_FRACTION_DIGITS;return j&&(k=' dy="'+a(j,l)+'" '),['<tspan x="',a(e,l),'" y="',a(f,l),'" ',k,i,">",fabric.util.string.escapeXml(c),"</tspan>"].join("")},_setSVGTextLineText:function(a,b,c,d){var e,f,g,h,i,j=this.getHeightOfLine(b),k=-1!==this.textAlign.indexOf("justify"),l="",m=0,n=this._textLines[b];d+=j*(1-this._fontSizeFraction)/this.lineHeight;for(var o=0,p=n.length-1;p>=o;o++)i=o===p||this.charSpacing,l+=n[o],g=this.__charBounds[b][o],0===m?(c+=g.kernedWidth-g.width,m+=g.width):m+=g.kernedWidth,k&&!i&&this._reSpaceAndTab.test(n[o])&&(i=!0),i||(e=e||this.getCompleteStyleDeclaration(b,o),f=this.getCompleteStyleDeclaration(b,o+1),i=this._hasStyleChangedForSvg(e,f)),i&&(h=this._getStyleDeclaration(b,o)||{},a.push(this._createTextCharSpan(l,h,c,d)),l="",e=f,c+=m,m=0)},_pushTextBgRect:function(b,c,d,e,f,g){var h=fabric.Object.NUM_FRACTION_DIGITS;b.push("\t\t<rect ",this._getFillAttributes(c),' x="',a(d,h),'" y="',a(e,h),'" width="',a(f,h),'" height="',a(g,h),'"></rect>\n')},_setSVGTextLineBg:function(a,b,c,d){for(var e,f,g=this._textLines[b],h=this.getHeightOfLine(b)/this.lineHeight,i=0,j=0,k=this.getValueOfPropertyAt(b,0,"textBackgroundColor"),l=0,m=g.length;m>l;l++)e=this.__charBounds[b][l],f=this.getValueOfPropertyAt(b,l,"textBackgroundColor"),f!==k?(k&&this._pushTextBgRect(a,k,c+j,d,i,h),j=e.left,i=e.width,k=f):i+=e.kernedWidth;f&&this._pushTextBgRect(a,f,c+j,d,i,h)},_getFillAttributes:function(a){var b=a&&"string"==typeof a?new fabric.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_getSVGLineTopOffset:function(a){for(var b=0,c=0,d=0;a>d;d++)b+=this.getHeightOfLine(d);return c=this.getHeightOfLine(d),{lineTop:b,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){var b=fabric.Object.prototype.getSvgStyles.call(this,a);return b+" white-space: pre;"}})}(),!function(a){"use strict";var b=a.fabric||(a.fabric={});b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:b.Text.prototype._dimensionAffectingProps.concat("width"),initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(a){for(var b=0,c=0,d=0,e={},f=0;f<a.graphemeLines.length;f++)"\n"===a.graphemeText[d]&&f>0?(c=0,d++,b++):this._reSpaceAndTab.test(a.graphemeText[d])&&f>0&&(c++,d++),e[f]={line:b,offset:c},d+=a.graphemeLines[f].length,c+=a.graphemeLines[f].length;return e},styleHas:function(a,c){if(this._styleMap&&!this.isWrapping){var d=this._styleMap[c];d&&(c=d.line)}return b.Text.prototype.styleHas.call(this,a,c)},isEmptyStyles:function(a){var b,c,d=0,e=a+1,f=!1,g=this._styleMap[a],h=this._styleMap[a+1];g&&(a=g.line,d=g.offset),h&&(e=h.line,f=e===a,b=h.offset),c="undefined"==typeof a?this.styles:{line:this.styles[a]};for(var i in c)for(var j in c[i])if(j>=d&&(!f||b>j))for(var k in c[i][j])return!1;return!0},_getStyleDeclaration:function(a,b){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[a];if(!c)return null;a=c.line,b=c.offset+b}return this.callSuper("_getStyleDeclaration",a,b)},_setStyleDeclaration:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){var c=this._styleMap[a];a=c.line,b=c.offset+b,delete this.styles[a][b]},_getLineStyle:function(a){var b=this._styleMap[a];return this.styles[b.line]},_setLineStyle:function(a,b){var c=this._styleMap[a];this.styles[c.line]=b},_deleteLineStyle:function(a){var b=this._styleMap[a];delete this.styles[b.line]},_wrapText:function(a,b){var c,d=[];for(this.isWrapping=!0,c=0;c<a.length;c++)d=d.concat(this._wrapLine(a[c],c,b));return this.isWrapping=!1,d},_measureWord:function(a,b,c){var d,e=0,f=!0;c=c||0;for(var g=0,h=a.length;h>g;g++){var i=this._getGraphemeBox(a[g],b,g+c,d,f);e+=i.kernedWidth,d=a[g]}return e},_wrapLine:function(a,c,d,e){var f=0,g=[],h=[],i=a.split(this._reSpaceAndTab),j="",k=0,l=" ",m=0,n=0,o=0,p=!0,q=this._getWidthOfCharSpacing(),e=e||0;d-=e;for(var r=0;r<i.length;r++)j=b.util.string.graphemeSplit(i[r]),m=this._measureWord(j,c,k),k+=j.length,f+=n+m-q,f>=d&&!p?(g.push(h),h=[],f=m,p=!0):f+=q,p||h.push(l),h=h.concat(j),n=this._measureWord([l],c,k),k++,p=!1,m>o&&(o=m);return r&&g.push(h),o+e>this.dynamicMinWidth&&(this.dynamicMinWidth=o-q+e),g},isEndOfWrapping:function(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line},_splitTextIntoLines:function(a){for(var c=b.Text.prototype._splitTextIntoLines.call(this,a),d=this._wrapText(c.lines,this.width),e=new Array(d.length),f=0;f<d.length;f++)e[f]=d[f].join("");return c.lines=e,c.graphemeLines=d,c},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(a){return this.callSuper("toObject",["minWidth"].concat(a))}}),b.Textbox.fromObject=function(a,c){return b.Object._fromObject("Textbox",a,c,"text")}}("undefined"!=typeof exports?exports:this),!function(){var a=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,c,d,e,f,g,h){var i=c.target;if(!("x"===f&&i instanceof fabric.Textbox))return a.call(fabric.Canvas.prototype,b,c,d,e,f,g,h);var j=i._getTransformedDimensions().x,k=i.width*(b.x/j);return k>=i.getMinWidth()?(i.set("width",k),!0):void 0},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var a in this._styleMap)this._textLines[a]||delete this.styles[this._styleMap[a].line]}})}();